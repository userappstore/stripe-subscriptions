

  index
    STRIPE_JS
      Use client-side stripe.js in browser
        ✓ default unset
        ✓ Integer
    MAXIMUM_STRIPE_RETRIES
      Retry Stripe web requests
        ✓ default 0
        ✓ Integer
    SUBSCRIPTION_WEBHOOK_ENDPOINT_SECRET
      Secret provided by Stripe to sign webhooks
        ✓ String
    STRIPE_KEY
      The `sk_test_xxx` key from Stripe
        ✓ String
    STRIPE_PUBLISHABLE_KEY
      The `pk_test_xxx` key from Stripe
        ✓ String
    REQUIRE_SUBSCRIPTION
      Users must create subscription to access application
        ✓ default unset
        ✓ Boolean
    REQUIRE_PAYMENT
      Users must resolve unpaid invoices to access application
        ✓ default unset
        ✓ Boolean
    REQUIRE_PAYMENT_CONFIRMATION
      Users must resolve payment confirmations to access application
        ✓ default unset
        ✓ Boolean
    OVERDUE_INVOICE_THRESHOLD
      Duration in days to allow open invoices before enforcing payment
        ✓ default 1
        ✓ Integer
    START_SUBSCRIPTION_PATH
      Alternate URL path to your start subscription flow
        ✓ default /account/subscriptions/start-subscription
        ✓ String

  server/bind-stripekey
    after
      ✓ should bind data to req (50ms)

  server/require-payment-confirmation
    after
      ✓ should ignore guests
      ✓ should ignore user with pending confirmations requesting account pages (6443ms)
      ✓ should ignore administrators with pending confirmations requesting administration pages (6693ms)
      ✓ should ignore user without pending confirmation (8778ms)
      ✓ should require user confirm payment (6711ms)

  server/require-payment
    after
      ✓ should ignore guests
      ✓ should ignore user with amount owed requesting account pages (2587ms)
      ✓ should ignore administrator with amount owed requesting administration pages (2112ms)
      ✓ should ignore user without amount owed
      ✓ should ignore user with open but not overdue invoice (5963ms)
      ✓ should require user pay overdue invoice (4946ms)

  server/require-subscription
    after
      ✓ should ignore guests
      ✓ should ignore user without subscription requesting account pages
      ✓ should ignore administrator without subscription requesting administration pages
      ✓ should ignore user with active subscription (7052ms)
      ✓ should require user create subscription (55ms)

  /account/subscriptions/add-payment-method
    view
      ✓ should present the form for no stripe.js (973ms)
      ✓ should present the form for stripe.js v3 (1600ms)
    submit
      ✓ should require name for no stripe.js (6114ms)
      ✓ should require CVC for no stripe.js (6163ms)
      ✓ should require card number for no stripe.js (5814ms)
      ✓ should require expiration month for no stripe.js (6124ms)
      ✓ should require expiration year for no stripe.js (6122ms)
      ✓ should add payment information no stripe.js (screenshots) (131916ms)
      ✓ should add payment information stripe.js v3 (21062ms)

  /account/subscriptions/billing-profile
    before
      ✓ should reject invalid customer (236ms)
      ✓ should reject other account's customer (263ms)
      ✓ should bind data to req (236ms)
    view
      ✓ should have row for customer (screenshots) (38508ms)

  /account/subscriptions/billing-profiles
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /account/subscriptions/cancel-subscription
    exceptions
      ✓ should reject missing subscription
      ✓ should reject invalid subscription
      ✓ should reject canceled subscription
      ✓ should reject other account's subscription
    before
      ✓ should bind data to req
    view
      ✓ should present the form
      ✓ should show fields for free plan cancelations
      ✓ should show fields for free trial cancelations
      ✓ should show fields for cancelation with credit or refund
    submit
      ✓ should cancel free subscription immediately (screenshots)
      ✓ should cancel free subscription at period end
      ✓ should cancel free trial immediately
      ✓ should cancel free trial at period end
      ✓ should cancel paid subscription and credit account
      ✓ should cancel paid subscription and show refund

  /account/subscriptions/change-plan
    before
      ✓ should bind data to req
    view
      ✓ should present the form
      ✓ should remove the form if there are no plans
    submit
      ✓ should apply plan update (screenshots)
    errors
      ✓ should reject paid plan without payment information

  /account/subscriptions/confirm-payment
    before
      ✓ should bind data to req (7571ms)
    view
      ✓ should display stripe.js confirmation

  /account/subscriptions/confirm-subscription
    exceptions
      ✓ invalid-planid (182ms)
      ✓ invalid-plan
    before
      ✓ should bind data to req
    view
      ✓ should present the form
    submit
      ✓ should start subscription (screenshots)
    errors
      ✓ invalid-paymentmethodid

  /account/subscriptions/create-billing-profile
    view
      ✓ should present the form for no stripe.js (623ms)
      ✓ should present the form for stripe.js v3 (1327ms)
    submit
      ✓ should require description for no stripe.js (6739ms)
      ✓ should require email for no stripe.js (6581ms)
      ✓ should require name for no stripe.js (6845ms)
      ✓ should require CVC for no stripe.js (7265ms)
      ✓ should require card number for no stripe.js (6625ms)
      ✓ should require expiration month for no stripe.js (7169ms)
      ✓ should require expiration year for no stripe.js (6975ms)
      ✓ should require description for stripe.js v3 (19013ms)
      ✓ should require email for stripe.js v3 (18661ms)
      ✓ should create billing profile for no stripe.js (8776ms)
      ✓ should create billing profile for stripe.js v3 (screenshots) (217009ms)

  /account/subscriptions/delete-billing-profile
    exceptions
      ✓ invalid-customerid
      ✓ invalid-account
    before
      ✓ should bind data to req
    view
      ✓ should present the form
    submit
      ✓ should delete billing profile (screenshots)

  /account/subscriptions
    before
      ✓ should bind data to req
    view
      ✓ should have row for each invoice
      ✓ should have row for each customer
      ✓ should have row for each subscription

  /account/subscriptions/invoice
    exceptions
      ✓ invalid-invoiceid
      ✓ invalid-account
    before
      ✓ should bind data to req
    view
      ✓ should have row for invoice (screenshots)

  /account/subscriptions/invoices
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /account/subscriptions/pay-invoice
    exceptions
      ✓ should reject invalid invoice
      ✓ invalid-account
      ✓ should reject paid invoice
    before
      ✓ should bind data to req
    view
      ✓ should present the form
    submit
      ✓ should pay invoice (screenshots)

  /account/subscriptions/plan
    before
      ✓ should reject invalid plan (152ms)
      ✓ should reject never published plan (686ms)
      ✓ should reject unpublished plan (1202ms)
      ✓ should bind data to req (691ms)
    view
      ✓ should have row for plan (screenshots) (37408ms)

  /account/subscriptions/plans
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /account/subscriptions/refund-invoice
    exceptions
      ✓ invalid-invoiceid
      ✓ invalid-account
    before
      ✓ should bind data to req
    view
      ✓ should present the form
    submit
      ✓ should cancel subscription (screenshots)

  /account/subscriptions/refunds
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /account/subscriptions/request-refund
    exceptions
      ✓ invalid-invoice
      ✓ invalid-account
    before
      ✓ should bind data to req
    view
      ✓ should present the form
    submit
      ✓ should create refund request (screenshots)

  /account/subscriptions/subscription
    exceptions
      ✓ invalid-subscriptionid (671ms)
      ✓ invalid-account
    before
      ✓ should bind data to req
    view
      ✓ should present the subscription table (screenshots)

  /account/subscriptions/subscriptions
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /administrator/subscriptions/apply-customer-coupon
    exceptions
      ✓ should reject invalid customer (152ms)
      ✓ should reject customer with coupon (2184ms)
    before
      ✓ should bind data to req (834ms)
    view
      ✓ should present the form (1544ms)
    submit
      ✓ should apply coupon (screenshots) (69363ms)

  /administrator/subscriptions/apply-subscription-coupon
    exceptions
      ✓ should reject invalid subscription (147ms)
      ✓ should reject canceling subscription (9623ms)
      ✓ should reject free subscription (5629ms)
      ✓ should reject subscription with coupon (8921ms)
    before
      ✓ should bind data to req (8114ms)
    view
      ✓ should present the form (9053ms)
    submit
      ✓ should apply coupon (screenshots) (76478ms)

  /administrator/subscriptions/charge
    before
      ✓ should reject invalid charge (1517ms)
      ✓ should bind data to req (9626ms)
    view
      ✓ should present the charge table (screenshots) (52070ms)

  /administrator/subscriptions/charges
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /administrator/subscriptions/coupon
    before
      ✓ should reject invalid coupon (145ms)
      ✓ should bind data to req (327ms)
    view
      ✓ should present the coupon table (screenshots) (44969ms)

  /administrator/subscriptions/coupons
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /administrator/subscriptions/create-coupon
    view
      ✓ should present the form (547ms)
    submit
      ✓ should reject missing couponid (1259ms)
      ✓ should enforce couponid length (2194ms)
      ✓ should reject duplicate couponid (2025ms)
      ✓ should reject missing duration (1749ms)
      ✓ should enforce invalid duration (1701ms)
      ✓ should require valid amount off (1794ms)
      ✓ should require valid percent off (1688ms)
      ✓ should require valid max redemptions (1815ms)
      ✓ should require amount or percent off (1545ms)
      ✓ should require valid duration in months if repeating (1837ms)
      ✓ should require valid redeem_by if provided (2053ms)
      ✓ should create coupon (screenshots) (57230ms)

  /administrator/subscriptions/create-plan
    view
      ✓ should present the form (807ms)
    submit
      ✓ should reject missing planid (1722ms)
      ✓ should enforce planid length (2588ms)
      ✓ should reject missing productid (1695ms)
      ✓ should reject never published product (2070ms)
      ✓ should reject unpublished product (2136ms)
      ✓ should reject missing currency (2074ms)
      ✓ should reject invalid currency (2104ms)
      ✓ should reject missing usage_type (2094ms)
      ✓ should reject missing amount (1975ms)
      ✓ should reject invalid amount (2049ms)
      ✓ should reject missing interval (2054ms)
      ✓ should reject invalid interval (2046ms)
      ✓ should reject invalid interval_count (2087ms)
      ✓ should reject invalid trial_period_days (2201ms)
      ✓ should create plan (screenshots) (57323ms)

  /administrator/subscriptions/create-product
    view
      ✓ should present the form (472ms)
    submit
      ✓ should reject missing name (1294ms)
      ✓ should enforce name length (2229ms)
      ✓ should reject missing statement_descriptor (1199ms)
      ✓ should create product (screenshots) (56454ms)

  /administrator/subscriptions/customer
    before
      ✓ should reject invalid customer (397ms)
      ✓ should bind data to req (240ms)
    view
      ✓ should present the customer table (screenshots) (36856ms)

  /administrator/subscriptions/customers
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /administrator/subscriptions/delete-coupon
    exceptions
      ✓ should reject invalid couponid (158ms)
    before
      ✓ should bind data to req (323ms)
    view
      ✓ should present the form (763ms)
    submit
      ✓ should delete coupon (screenshots) (67428ms)

  /administrator/subscriptions/delete-plan
    exceptions
      ✓ should reject invalid planid (170ms)
    before
      ✓ should bind data to req (708ms)
    view
      ✓ should present the form (1457ms)
    submit
      ✓ should delete plan (screenshots) (68353ms)

  /administrator/subscriptions/delete-product
    exceptions
      ✓ should reject invalid productid (159ms)
    before
      ✓ should bind data to req (378ms)
    view
      ✓ should present the form (1090ms)
    submit
      ✓ should delete product (screenshots) (64942ms)

  /administrator/subscriptions/delete-subscription
    exceptions
      ✓ should reject missing subscription
      ✓ should reject invalid subscription
      ✓ should reject canceled subscription
    before
      ✓ should bind data to req
    view
      ✓ should present the form
      ✓ should show fields for free plan cancelations
      ✓ should show fields for free trial cancelations
      ✓ should show fields for cancelation with credit or refund
    submit
      ✓ should cancel free subscription immediately (screenshots) (6329ms)
      ✓ should cancel free subscription at period end
      ✓ should cancel free trial immediately
      ✓ should cancel free trial at period end
      ✓ should cancel paid subscription and credit account
      ✓ should cancel paid subscription and show refund

  /administrator/subscriptions/deny-refund
    exceptions
      ✓ should reject invalid chargeid (332ms)
      ✓ should reject charge without refund request (8021ms)
      ✓ should reject denied refund (8442ms)
    before
      ✓ should bind data to req (9050ms)
    view
      ✓ should present the form (10508ms)
    submit
      ✓ should deny refund (screenshots) (86752ms)

  /administrator/subscriptions/edit-coupon
    before
      ✓ should reject invalid couponid
      ✓ should reject unpublished coupon (562ms)
      ✓ should bind data to req (332ms)
    view
      ✓ should present the form (767ms)
    submit
      ✓ should reject missing name (1272ms)
      ✓ should update coupon (screenshots) (68462ms)

  /administrator/subscriptions/edit-plan
    before
      ✓ should reject invalid planid (159ms)
      ✓ should reject unpublished plan (905ms)
      ✓ should bind data to req (870ms)
    view
      ✓ should present the form (1216ms)
    submit
      ✓ should reject missing productid (1962ms)
      ✓ should reject invalid trial period (2549ms)
      ✓ should update plan (screenshots) (70930ms)

  /administrator/subscriptions/edit-product
    before
      ✓ should reject invalid productid (147ms)
      ✓ should reject unpublished product (492ms)
      ✓ should bind data to req (278ms)
    view
      ✓ should present the form (742ms)
    submit
      ✓ should reject missing name (1507ms)
      ✓ should enforce name length (2434ms)
      ✓ should reject missing statement_descriptor (1425ms)
      ✓ should reject invalid unit_label (1824ms)
      ✓ should update product (screenshots) (73910ms)

  /administrator/subscriptions/flag-charge
    exceptions
      ✓ should reject invalid chargeid (145ms)
      ✓ should reject flagged charge
    before
      ✓ should bind data to req
    view
      ✓ should present the form
    submit
      ✓ should flag charge (screenshots)

  /administrator/subscriptions/forgive-invoice
    exceptions
      ✓ should reject invalid invoiceid (139ms)
      ✓ should reject paid invoice (9774ms)
      ✓ should reject uncollectible invoice (3460ms)
    before
      ✓ should bind data to req (2358ms)
    view
      ✓ should present the form (2822ms)
    submit
      ✓ should forgive invoice (screenshots) (66574ms)

  /administrator/subscriptions
    before
      ✓ should bind data to req (8291ms)
    view
      ✓ should have row for each plan (1613ms)
      ✓ should have row for each coupon (1115ms)
      ✓ should have row for each subscription (screenshots) (34132ms)

  /administrator/subscriptions/invoice
    before
      ✓ should reject invalid invoiceid (178ms)
      ✓ should bind data to req (9111ms)
    view
      ✓ should present the invoice table (screenshots) (51474ms)

  /administrator/subscriptions/invoices
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /administrator/subscriptions/payment-intent
    before
      ✓ should reject invalid paymentintentid
      ✓ should bind data to req (1728ms)
    view
      ✓ should have row for payment intent (screenshots) (46441ms)

  /administrator/subscriptions/payment-intents
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /administrator/subscriptions/payment-method
    before
      ✓ should reject invalid paymentmethodid
      ✓ should bind data to req (1597ms)
    view
      ✓ should have row for payment method (screenshots) (46133ms)

  /administrator/subscriptions/payment-methods
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /administrator/subscriptions/payout
    before
      ✓ should reject invalid payoutid (169ms)

  /administrator/subscriptions/plan
    before
      ✓ should reject invalid planid (146ms)
      ✓ should bind data to req (686ms)
    view
      ✓ should present the plan table (screenshots) (44921ms)

  /administrator/subscriptions/plans
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /administrator/subscriptions/product
    before
      ✓ should reject invalid productid (155ms)
      ✓ should bind data to req (518ms)
    view
      ✓ should have row for product (screenshots) (42654ms)

  /administrator/subscriptions/products
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /administrator/subscriptions/publish-coupon
    exceptions
      ✓ should reject invalid couponid (137ms)
      ✓ should reject published coupon (311ms)
    before
      ✓ should bind data to req (312ms)
    view
      ✓ should present the form (770ms)
    submit
      ✓ should publish coupon (screenshots) (67568ms)

  /administrator/subscriptions/publish-plan
    exceptions
      ✓ should reject invalid planid (149ms)
      ✓ should reject published plan (648ms)
    before
      ✓ should bind data to req (680ms)
    view
      ✓ should present the form (1127ms)
    submit
      ✓ should publish plan (screenshots) (68743ms)

  /administrator/subscriptions/publish-product
    exceptions
      ✓ should reject invalid productid (210ms)
      ✓ should reject published product (373ms)
    before
      ✓ should bind data to req (378ms)
    view
      ✓ should present the form (755ms)
    submit
      ✓ should publish product (screenshots) (65790ms)

  /administrator/subscriptions/refund-charge
    exceptions
      ✓ should reject invalid chargeid (172ms)
      ✓ should reject refunded charge
    before
      ✓ should bind data to req
    view
      ✓ should present the form
    submit
      ✓ should refund charge (screenshots)

  /administrator/subscriptions/refund-requests
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /administrator/subscriptions/refund
    before
      ✓ should reject invalid refundid (161ms)
      ✓ should bind data to req (9364ms)
    view
      ✓ should have row for refund (screenshots) (54716ms)

  /administrator/subscriptions/refunds
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /administrator/subscriptions/revoke-customer-coupon
    exceptions
      ✓ should reject invalid customer (139ms)
      ✓ should reject customer without discount (959ms)
    before
      ✓ should bind data to req (1358ms)
    view
      ✓ should present the form (1916ms)
    submit
      ✓ should remove coupon (screenshots) (63884ms)

  /administrator/subscriptions/revoke-subscription-coupon
    exceptions
      ✓ should reject invalid subscription (328ms)
      ✓ should reject subscription without discount (8918ms)
    before
      ✓ should bind data to req (9402ms)
    view
      ✓ should present the form (9108ms)
    submit
      ✓ should remove coupon (screenshots) (75935ms)

  /administrator/subscriptions/setup-intent
    before
      ✓ should reject invalid setupintentid
      ✓ should bind data to req (3606ms)
    view
      ✓ should have row for setup intent (screenshots) (48178ms)

  /administrator/subscriptions/setup-intents
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /administrator/subscriptions/subscription
    before
      ✓ should reject invalid subscriptionid (147ms)
      ✓ should bind data to req (8722ms)
    view
      ✓ should present the subscription table (screenshots) (50716ms)

  /administrator/subscriptions/subscriptions
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /administrator/subscriptions/unpublish-coupon
    exceptions
      ✓ should reject invalid couponid (152ms)
      ✓ should reject never published coupon (304ms)
      ✓ should reject unpublished coupon (722ms)
    before
      ✓ should bind data to req (316ms)
    view
      ✓ should present the form (770ms)
    submit
      ✓ should unpublish coupon (screenshots) (67129ms)

  /administrator/subscriptions/unpublish-plan
    exceptions
      ✓ should reject invalid planid (248ms)
      ✓ should never published plan (836ms)
      ✓ should reject unpublished plan (869ms)
    before
      ✓ should bind data to req (810ms)
    view
      ✓ should present the form (1120ms)
    submit
      ✓ should unpublish plan (screenshots) (68250ms)

  /administrator/subscriptions/unpublish-product
    exceptions
      ✓ should reject invalid productid (147ms)
      ✓ should never published product (548ms)
      ✓ should reject unpublished product (470ms)
    before
      ✓ should bind data to req (296ms)
    view
      ✓ should present the form (759ms)
    submit
      ✓ should unpublish product (screenshots) (65743ms)

  /api/administrator/subscriptions/charge
    exceptions
      invalid-chargeid
        ✓ missing querystring chargeid
        ✓ invalid querystring chargeid (148ms)
    returns
      ✓ object (8564ms)

  /api/administrator/subscriptions/charges-count
    returns
      ✓ integer (35219ms)

  /api/administrator/subscriptions/charges
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/administrator/subscriptions/coupon
    exceptions
      invalid-couponid
        ✓ missing querystring couponid
        ✓ invalid querystring couponid (164ms)
    returns
      ✓ object (334ms)

  /api/administrator/subscriptions/coupons-count
    returns
      ✓ integer (548ms)

  /api/administrator/subscriptions/coupons
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/administrator/subscriptions/create-cancelation-refund
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid (149ms)
      invalid-subscription
        ✓ ineligible querystring subscription is not active (8446ms)
    returns
      ✓ object (8404ms)

  /api/administrator/subscriptions/create-coupon
    exceptions
      invalid-couponid
        ✓ missing posted couponid
        ✓ invalid posted couponid is not alphanumeric_
      invalid-amount_off
        ✓ missing posted amount_off
        ✓ invalid posted amount_off
      invalid-currency
        ✓ missing posted currency
        ✓ invalid posted currency
      invalid-percent_off
        ✓ invalid posted percent_off
      invalid-duration
        ✓ invalid posted duration
      invalid-duration_in_months
        ✓ missing posted duration_in_months
        ✓ invalid posted duration_in_months
      invalid-redeem_by_meridiem
        ✓ invalid posted redeem_by_meridiem
      invalid-redeem_by
        ✓ invalid posted redeem_by
    receives
      ✓ required posted duration
      ✓ optionally-required posted amount_off (integer, or percent_off)
      ✓ optionally-required posted currency (string, if amount_off)
      ✓ optionally-required posted percent_off (integer, or amount_off)
      ✓ optionally-required posted expire date 
      ✓ optionally-required posted duration_in_months
    returns
      ✓ object (200ms)

  /api/administrator/subscriptions/create-plan
    exceptions
      invalid-planid
        ✓ invalid posted planid is not alphanumeric_ (171ms)
      invalid-planid-length
        ✓ posted planid is too short (198ms)
        ✓ posted planid is too long (178ms)
      invalid-productid
        ✓ missing posted productid (187ms)
        ✓ invalid posted productid (309ms)
      invalid-product
        ✓ ineligible posted product is not published (314ms)
      invalid-amount
        ✓ missing posted amount (324ms)
        ✓ invalid posted amount (337ms)
      invalid-currency
        ✓ missing posted currency (181ms)
        ✓ invalid posted currency (194ms)
      invalid-interval
        ✓ missing posted interval (329ms)
        ✓ invalid posted interval (317ms)
      invalid-interval-count
        ✓ missing posted interval_count (306ms)
        ✓ invalid posted interval_count (308ms)
      invalid-trial_period
        ✓ invalid posted trial_period (310ms)
      invalid-usage_type
        ✓ invalid posted usage_type (306ms)
    receives
      ✓ optional posted published (boolean) (512ms)
      ✓ optional posted trial_period_days (integer) (549ms)
      ✓ optional posted usage_type (licensed|metered) (547ms)
    returns
      ✓ object (814ms)
    configuration
      ✓ environment MINIMUM_PLANID_LENGTH (172ms)
      ✓ environment MAXIMUM_PLANID_LENGTH (207ms)

  /api/administrator/subscriptions/create-product
    exceptions
      invalid-name
        ✓ missing posted name
      invalid-product-name-length
        ✓ posted name too short
        ✓ posted name too long
      invalid-statement_descriptor
        ✓ missing posted statement_descriptor
    receives
      ✓ optional posted published (boolean) (364ms)
    returns
      ✓ object (376ms)
    configuration
      ✓ environment MINIMUM_PRODUCT_NAME_LENGTH
      ✓ environment MAXIMUM_PRODUCT_NAME_LENGTH

  /api/administrator/subscriptions/create-refund
    exceptions
      invalid-chargeid
        ✓ missing querystring chargeid
        ✓ invalid querystring chargeid (187ms)
      invalid-amount
        ✓ missing posted amount
        ✓ invalid posted amount
        ✓ invalid posted amount is negative
        ✓ invalid posted amount exceeds charge
    returns
      ✓ object

  /api/administrator/subscriptions/customer
    exceptions
      invalid-customerid
        ✓ missing querystring customerid
        ✓ invalid querystring customerid (139ms)
    returns
      ✓ object (2845ms)

  /api/administrator/subscriptions/customers-count
    returns
      ✓ integer (471ms)

  /api/administrator/subscriptions/customers
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/administrator/subscriptions/delete-coupon
    exceptions
      invalid-couponid
        ✓ missing querystring couponid
        ✓ invalid querystring couponid (141ms)
    returns
      ✓ boolean (500ms)

  /api/administrator/subscriptions/delete-plan
    exceptions
      invalid-planid
        ✓ missing querystring planid
        ✓ invalid querystring planid (146ms)
    returns
      ✓ boolean (857ms)

  /api/administrator/subscriptions/delete-product
    exceptions
      invalid-productid
        ✓ missing querystring productid
        ✓ invalid querystring productid (135ms)
    returns
      ✓ boolean (477ms)

  /api/administrator/subscriptions/delete-subscription
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid (163ms)
      invalid-subscription
        ✓ ineligible querystring subscription is not active (11766ms)
    returns
      ✓ boolean (8433ms)

  /api/administrator/subscriptions/invoice
    exceptions
      invalid-invoiceid
        ✓ missing querystring invoiceid
        ✓ invalid querystring invoiceid (158ms)
    returns
      ✓ object (8085ms)

  /api/administrator/subscriptions/invoices-count
    returns
      ✓ integer (35393ms)

  /api/administrator/subscriptions/invoices
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/administrator/subscriptions/payment-intent
    exceptions
      invalid-paymentintentid
        ✓ missing querystring paymentintentid
        ✓ invalid querystring paymentintentid
    returns
      ✓ object (2048ms)

  /api/administrator/subscriptions/payment-intents-count
    returns
      ✓ integer (6448ms)

  /api/administrator/subscriptions/payment-intents
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/administrator/subscriptions/payment-method
    exceptions
      invalid-paymentmethodid
        ✓ missing querystring paymentmethodid
        ✓ invalid querystring paymentmethodid
    returns
      ✓ object (1730ms)

  /api/administrator/subscriptions/payment-methods-count
    returns
      ✓ integer (4779ms)

  /api/administrator/subscriptions/payment-methods
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/administrator/subscriptions/plan
    exceptions
      invalid-planid
        ✓ missing querystring planid
        ✓ invalid querystring planid (151ms)
    returns
      ✓ object (690ms)

  /api/administrator/subscriptions/plans-count
    returns
      ✓ integer (1687ms)

  /api/administrator/subscriptions/plans
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/administrator/subscriptions/product
    exceptions
      invalid-productid
        ✓ missing querystring productid
        ✓ invalid querystring productid (138ms)
    returns
      ✓ object (468ms)

  /api/administrator/subscriptions/products-count
    returns
      ✓ integer (563ms)

  /api/administrator/subscriptions/products
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/administrator/subscriptions/refund-requests-count
    returns
      ✓ integer (29277ms)

  /api/administrator/subscriptions/refund-requests
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/administrator/subscriptions/refund
    exceptions
      ✓ invalid querystring refundid
      ✓ missing querystring refundid (168ms)
    returns
      ✓ object (11057ms)

  /api/administrator/subscriptions/refunds-count
    returns
      ✓ integer (32189ms)

  /api/administrator/subscriptions/refunds
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/administrator/subscriptions/reset-customer-coupon
    exceptions
      invalid-customerid
        ✓ missing querystring customerid
        ✓ invalid querystring customerid (164ms)
      invalid-customeir
        ✓ invalid querystring customer has no discount (237ms)
    receives
      ✓ object (1055ms)

  /api/administrator/subscriptions/reset-subscription-coupon
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid (155ms)
      invalid-subscription
        ✓ ineligible querystring subscription has no discount (8629ms)
    returns
      ✓ object (10812ms)

  /api/administrator/subscriptions/set-charge-flagged
    exceptions
      invalid-chargeid
        ✓ missing querystring charge
        ✓ invalid querystring charge (158ms)
      invalid-charge
        ✓ ineligible querystring charge is already flagged (8922ms)
    returns
      ✓ object (8217ms)

  /api/administrator/subscriptions/set-coupon-published
    exceptions
      invalid-couponid
        ✓ missing querystring couponid
        ✓ invalid querystring couponid (170ms)
      invalid-coupon
        ✓ ineligible querystring coupon is published (318ms)
        ✓ ineligible querystring coupon is unpublished (339ms)
    returns
      ✓ object (500ms)

  /api/administrator/subscriptions/set-coupon-unpublished
    exceptions
      invalid-couponid
        ✓ missing querystring couponid
        ✓ invalid querystring couponid (148ms)
      invalid-coupon
        ✓ ineligible querystring coupon is not published (309ms)
        ✓ ineligible querystring coupon is already unpublished (487ms)
    returns
      ✓ object (496ms)

  /api/administrator/subscriptions/set-invoice-uncollectible
    exceptions
      invalid-invoiceid
        ✓ missing querystring invoiceid (142ms)
        ✓ invalid querystring invoiceid (151ms)
      invalid-invoice
        ✓ invalid querystring invoice is paid (8448ms)
        ✓ invalid querystring invoice is marked uncollectable (5007ms)
    returns
      ✓ object (5075ms)

  /api/administrator/subscriptions/set-plan-published
    exceptions
      invalid-planid
        ✓ missing querystring planid
        ✓ invalid querystring planid (169ms)
      invalid-plan
        ✓ ineligible querystring plan is published (698ms)
    returns
      ✓ object (906ms)

  /api/administrator/subscriptions/set-plan-unpublished
    exceptions
      invalid-planid
        ✓ missing querystring planid
        ✓ invalid querystring planid (163ms)
      invalid-plan
        ✓ ineligible querystring plan is not published (690ms)
        ✓ ineligible querystring plan is already unpublished (914ms)
    returns
      ✓ object (898ms)

  /api/administrator/subscriptions/set-product-published
    exceptions
      invalid-productid
        ✓ missing querystring productid (323ms)
        ✓ invalid querystring productid (312ms)
      invalid-product
        ✓ invalid querystring product is already published (295ms)
    returns
      ✓ object (528ms)

  /api/administrator/subscriptions/set-product-unpublished
    exceptions
      invalid-productid
        ✓ missing querystring productid (182ms)
        ✓ invalid querystring productid (309ms)
      invalid-product
        ✓ ineligible querystring product is not published (517ms)
        ✓ ineligible querystring product is already unpublished (494ms)
    returns
      ✓ object (487ms)

  /api/administrator/subscriptions/set-refund-request-denied
    exceptions
      invalid-chargeid
        ✓ missing querystring chargeid
        ✓ invalid querystring chargeid (164ms)
      invalid-charge
        ✓ ineligible querystring charge has no refund request (9199ms)
        ✓ ineligible querystring charge has denied request already (12289ms)
    returns
      ✓ object (8594ms)

  /api/administrator/subscriptions/set-subscription-canceled
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid (146ms)
      invalid-subscription
        ✓ ineligible querystring subscription is not active (8485ms)
    returns
      ✓ object (7959ms)

  /api/administrator/subscriptions/set-subscription-coupon
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid
      invalid-subscription
        ✓ ineligible subscription is canceling (8828ms)
        ✓ ineligible subscription has coupon (8758ms)
      invalid-couponid
        ✓ missing posted couponid (7235ms)
        ✓ invalid posted couponid (7928ms)
      invalid-coupon
        ✓ ineligible posted coupon is not published (8162ms)
        ✓ ineligible posted coupon is unpublished (19850ms)
    returns
      ✓ object (8942ms)

  /api/administrator/subscriptions/setup-intent
    exceptions
      invalid-setupintentid
        ✓ missing querystring setupintentid
        ✓ invalid querystring setupintentid
    returns
      ✓ object (2899ms)

  /api/administrator/subscriptions/setup-intents-count
    returns
      ✓ integer (4625ms)

  /api/administrator/subscriptions/setup-intents
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/administrator/subscriptions/subscription
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid (148ms)
    returns
      ✓ object (7719ms)

  /api/administrator/subscriptions/subscriptions-count
    returns
      ✓ integer (23634ms)

  /api/administrator/subscriptions/subscriptions
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/administrator/subscriptions/update-coupon
    exceptions
      invalid-couponid
        ✓ missing querystring couponid
        ✓ invalid querystring couponid (145ms)
      invalid-coupon
        ✓ ineligible querystring coupon is unpublished (521ms)
      invalid-name
        ✓ missing posted name (336ms)
        ✓ invalid posted name (515ms)
    receives
      ✓ required posted name (699ms)
    returns
      ✓ object (490ms)

  /api/administrator/subscriptions/update-plan
    exceptions
      invalid-planid
        ✓ missing querystring planid
        ✓ invalid querystring planid (154ms)
      invalid-plan
        ✓ ineligible querystring plan is unpublished (1043ms)
      invalid-productid
        ✓ invalid posted productid (842ms)
      invalid-product
        ✓ ineligible posted product is not published (990ms)
        ✓ ineligible posted product is unpublished (1148ms)
      invalid-trial_period_days
        ✓ invalid posted trial_period_days (987ms)
        ✓ ineligible posted trial_period_days is negative (1339ms)
        ✓ ineligible posted trial_period_days greater than 365 (1127ms)
    receives
      ✓ optional posted trial_period_days (integer) (1020ms)
    returns
      ✓ object (1193ms)

  /api/administrator/subscriptions/update-product
    exceptions
      invalid-productid
        ✓ missing querystring productid (250ms)
        ✓ invalid querystring productid (314ms)
      invalid-product
        ✓ ineligible querystring product is unpublished (508ms)
      invalid-name
        ✓ invalid posted name (306ms)
      invalid-name-length
        ✓ posted name too short (334ms)
        ✓ posted name too long (307ms)
      invalid-statement_descriptor
        ✓ invalid posted statement_descriptor (309ms)
      invalid-statement_descriptor-length
        ✓ posted statement_descriptor too short (315ms)
        ✓ posted statement_descriptor too long (470ms)
      invalid-unit_label
        ✓ missing posted unit_label (343ms)
    receives
      ✓ optional posted name (502ms)
      ✓ optional posted statement_descriptor (499ms)
      ✓ optional posted unit_label (476ms)
    returns
      ✓ object (515ms)
    configuration
      ✓ environment MINIMUM_PRODUCT_NAME_LENGTH (310ms)
      ✓ environment MAXIMUM_PRODUCT_NAME_LENGTH (304ms)

  /api/administrator/subscriptions/usage-record-summaries
    exceptions
      invalid-subscriptionitemid
        ✓ missing querystring subscriptionitemid
        ✓ invalid querystring subscriptionitemid
    receives
      ✓ optional querystring starting_after (string)
      ✓ optional querystring ending_before (string)
      ✓ optional querystring limit (integer)
    returns
      ✓ stripe list response
    configuration
      ✓ environment PAGE_SIZE

  /api/user/subscriptions/charge
    exceptions
      invalid-chargeid
        ✓ missing querystring chargeid
        ✓ invalid querystring chargeid
      invalid-account
        ✓ ineligible accessing account (13566ms)
    returns
      ✓ object (7176ms)

  /api/user/subscriptions/charges-count
    returns
      ✓ integer (17451ms)

  /api/user/subscriptions/charges
    exceptions
      invalid-accountid
        ✓ missing querystring accountid
        ✓ invalid querystring accountid
      invalid-account
        ✓ ineligible accessing account
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/user/subscriptions/create-cancelation-refund
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid
      invalid-account
        ✓ ineligible accessing account (9165ms)
      invalid-subscription
        ✓ ineligible querystring subscription is not active (8873ms)
        ✓ ineligible querystring subscription is free (7604ms)
        ✓ ineligible querystring subscription is in free trial (6741ms)
    returns
      ✓ object (11002ms)

  /api/user/subscriptions/create-customer
    exceptions
      invalid-accountid
        ✓ missing querystring accountid
        ✓ invalid querystring accountid
      invalid-account
        ✓ ineligible accessing account (40ms)
    returns
      ✓ object (214ms)

  /api/user/subscriptions/create-payment-intent
    exceptions
      invalid-customerid
        ✓ missing querystring customerid
        ✓ invalid querystring customerid
      invalid-account
        ✓ ineligible accessing account (1482ms)
        ✓ ineligible posted payment method (1821ms)
      invalid-paymentmethodid
        ✓ missing posted paymentmethodid (236ms)
        ✓ invalid posted paymentmethodid (223ms)
    object
      ✓ object (2012ms)

  /api/user/subscriptions/create-payment-method
    exceptions
      invalid-customerid
        ✓ missing querystring customerid
        ✓ invalid querystring customerid
      invalid-account
        ✓ ineligible accessing account (304ms)
    receives
      ✓ optionally-required posted name (228ms)
      ✓ optionally-required posted cvc (240ms)
      ✓ optionally-required posted number (270ms)
      ✓ optionally-required posted exp_month (245ms)
      ✓ optionally-required posted exp_year (227ms)
      ✓ optionally-required posted token (231ms)
    returns
      ✓ object (1674ms)
    configuration
      ✓ environment STRIPE_JS (230ms)

  /api/user/subscriptions/create-refund-request
    exceptions
      invalid-chargeid
        ✓ missing querystring chargeid
        ✓ invalid querystring chargeid
      invalid-charge
        ✓ ineligible querystring charge is refunded (9090ms)
        ✓ ineligible querystring charge has refund request (8389ms)
      invalid-account
        ✓ ineligible accessing account (9640ms)
    returns
      ✓ object (8410ms)

  /api/user/subscriptions/create-refund
    exceptions
      invalid-chargeid
        ✓ missing querystring chargeid
        ✓ invalid querystring chargeid
      invalid-charge
        ✓ ineligible querystring charge is refunded (11053ms)
        ✓ ineligible querystring charge is out of refund period (7698ms)
      invalid-account
        ✓ ineligible accessing account (8468ms)
    returns
      ✓ object (8018ms)
    configuration
      ✓ environment SUBSCRIPTION_REFUND_PERIOD (9207ms)

  /api/user/subscriptions/create-setup-intent
    exceptions
      invalid-customerid
        ✓ missing querystring customerid
        ✓ invalid querystring customerid
      invalid-account
        ✓ ineligible accessing account (1492ms)
      invalid-paymentmethodid
        ✓ missing posted paymentmethodid (239ms)
        ✓ invalid posted paymentmethodid (223ms)
    returns
      ✓ object (1943ms)

  /api/user/subscriptions/create-subscription
    exceptions
      invalid-customerid
        ✓ missing querystring customerid (517ms)
        ✓ invalid querystring customerid (883ms)
      invalid-customer
        ✓ ineligible querystring customer requires payment method (892ms)
      invalid-account
        ✓ ineligible accessing account (917ms)
      invalid-planid
        ✓ missing posted planid (1814ms)
        ✓ invalid posted planid (1693ms)
      invalid-plan
        ✓ ineligible posted plan is not published (2202ms)
        ✓ ineligible posted plan is unpublished (2524ms)
    returns
      ✓ object (4107ms)

  /api/user/subscriptions/create-usage-record
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid
      invalid-subscription
        ✓ invalid querystring subscription is not "metered" (9504ms)
      invalid-account
        ✓ ineligible accessing account (5176ms)
      invalid-quantity
        ✓ invalid posted quantity is not integer (5807ms)
        ✓ invalid posted quantity is negative (5700ms)
      invalid-action
        ✓ missing posted action (6003ms)
        ✓ invalid posted action (6582ms)
      invalid-subscriptionitemid
        ✓ missing posted subscriptionitemid (5731ms)
        ✓ invalid posted subscriptionitemid (5161ms)
    receives
      ✓ required posted quantity (6752ms)
      ✓ required posted action (6155ms)
      ✓ required posted subscriptionitemid (7441ms)
    returns
      ✓ object (6650ms)

  /api/user/subscriptions/customer
    exceptions
      invalid-customerid
        ✓ missing querystring customerid
        ✓ invalid querystring customerid
      invalid-account
        ✓ ineligible accessing account (2674ms)
    returns
      ✓ object (1889ms)

  /api/user/subscriptions/customers
    exceptions
      invalid-accountid
        ✓ missing querystring accountid
        ✓ invalid querystring accountid
      invalid-account
        ✓ ineligible accessing account
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/user/subscriptions/delete-customer
    exceptions
      invalid-customerid
        ✓ missing querystring customerid
        ✓ invalid querystring customerid
      invalid-account
        ✓ ineligible accessing account (282ms)
    returns
      ✓ boolean (468ms)

  /api/user/subscriptions/delete-subscription
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid
      invalid-account
        ✓ ineligible accessing account (10026ms)
      invalid-subscription
        ✓ ineligible querystring subscription is not active (9416ms)
    returns
      ✓ boolean (7916ms)

  /api/user/subscriptions/invoice
    exceptions
      invalid-invoiceid
        ✓ missing querystring invoiceid
        ✓ invalid querystring invoiceid
      invalid-account
        ✓ ineligible accessing account (10698ms)
    returns
      ✓ object (8495ms)

  /api/user/subscriptions/invoices-count
    returns
      ✓ integer (19537ms)

  /api/user/subscriptions/invoices
    exceptions
      invalid-accountid
        ✓ missing querystring accountid
        ✓ invalid querystring accountid
      invalid-account
        ✓ ineligible accessing account
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/user/subscriptions/payment-intent
    exceptions
      invalid-paymentintentid
        ✓ missing querystring invalid
        ✓ invalid querystring invalid
      invalid-account
        ✓ ineligible accessing account (1751ms)
    returns
      ✓ object (1856ms)

  /api/user/subscriptions/payment-intents-count
    returns
      ✓ integer (5945ms)

  /api/user/subscriptions/payment-intents
    exceptions
      invalid-accountid
        ✓ missing querystring accountid
        ✓ invalid querystring accountid
      invalid-account
        ✓ ineligible accessing account
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/user/subscriptions/payment-method
    exceptions
      invalid-paymentmethodid
        ✓ missing querystring paymentmethodid
        ✓ invalid querystring paymentmethodid
      invalid-account
        ✓ ineligible accessing account (1803ms)
    returns
      ✓ object (1648ms)

  /api/user/subscriptions/payment-methods-count
    returns
      ✓ integer (4658ms)

  /api/user/subscriptions/payment-methods
    exceptions
      invalid-accountid
        ✓ missing querystring accountid
        ✓ invalid querystring accountid
      invalid-account
        ✓ ineligible accessing account
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/user/subscriptions/published-plan
    exceptions
      invalid-planid
        ✓ missing querystring planid
        ✓ invalid querystring planid (138ms)
      invalid-plan
        ✓ ineligible querystring plan is not published (678ms)
    returns
      ✓ object (672ms)

  /api/user/subscriptions/published-plans-count
    returns
      ✓ integer (1232ms)

  /api/user/subscriptions/published-plans
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/user/subscriptions/published-product
    exceptions
      invalid-productid
        ✓ missing querystring productid
        ✓ invalid querystring productid (123ms)
      invalid-product
        ✓ ineligible querystring product is not published (352ms)
    returns
      ✓ object (330ms)

  /api/user/subscriptions/published-products-count
    returns
      ✓ integer (592ms)

  /api/user/subscriptions/published-products
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/user/subscriptions/refund
    exceptions
      invalid-refundid
        ✓ missing querystring refundid (981ms)
        ✓ invalid querystring refundid (668ms)
      invalid-account
        ✓ ineligible accessing account (10198ms)
    returns
      ✓ object (9570ms)

  /api/user/subscriptions/refunds-count
    returns
      ✓ integer (25309ms)

  /api/user/subscriptions/refunds
    exceptions
      invalid-accountid
        ✓ missing querystring accountid
        ✓ invalid querystring accountid
      invalid-account
        ✓ ineligible accessing account
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/user/subscriptions/reset-subscription-canceling
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid
      invalid-subscription
        ✓ invalid querystring subscription is active (8991ms)
      invalid-account
        ✓ ineligible accessing account (8487ms)
    returns
      ✓ object (10184ms)

  /api/user/subscriptions/set-customer-coupon
    exceptions
      invalid-customerid
        ✓ missing querystring customerid (216ms)
        ✓ invalid querystring customerid (219ms)
      invalid-customer
        ✓ invalid querystring customer has coupon (1020ms)
      invalid-account
        ✓ ineligible account accessing (609ms)
      invalid-couponid
        ✓ missing posted couponid (239ms)
        ✓ invalid posted couponid (247ms)
      invalid-coupon
        ✓ invalid posted coupon is not published (550ms)
        ✓ invalid posted coupon is unpublished (733ms)
    returns
      ✓ object (838ms)

  /api/user/subscriptions/set-invoice-paid
    exceptions
      invalid-invoiceid
        ✓ missing querystring invoiceid
        ✓ invalid querystring invoiceid
      invalid-account
        ✓ ineligible accessing account (2157ms)
        ✓ ineligible posted payment method (7599ms)
      invalid-invoice
        ✓ invalid querystring invoice is paid (7868ms)
        ✓ invalid querystring invoice is marked uncollectable (5596ms)
      invalid-paymentmethodid
        ✓ missing posted paymentmethodid (2480ms)
        ✓ invalid posted paymentmethodid (2388ms)
    returns
      ✓ object (6263ms)

  /api/user/subscriptions/set-payment-intent-canceled
    exceptions
      invalid-paymentintentid
        ✓ missing querystring paymentintentid
        ✓ invalid querystring paymentintentid
      invalid-account
        ✓ ineligible accessing account (1856ms)
    returns
      ✓ object (1867ms)

  /api/user/subscriptions/set-payment-method-detached
    exceptions
      invalid-paymentmethodid
        ✓ missing querystring paymentmethodid
        ✓ invalid querystring paymentmethodid
      invalid-account
        ✓ ineligible accessing account (1677ms)
      invalid-paymentmethod
        ✓ invalid querystring payment method is default (2155ms)
    returns
      ✓ object (3007ms)

  /api/user/subscriptions/set-setup-intent-canceled
    exceptions
      invalid-setupintentid
        ✓ missing querystring setupintentid
        ✓ invalid querystring setupintentid
      invalid-account
        ✓ ineligible accessing account (3181ms)
    returns
      ✓ object (3192ms)

  /api/user/subscriptions/set-subscription-canceled
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid
      invalid-account
        ✓ ineligible accessing account (7183ms)
      invalid-subscription
        ✓ ineligible querystring subscription is not active (8917ms)
    returns
      ✓ object (8207ms)

  /api/user/subscriptions/set-subscription-coupon
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid
      invalid-subscription
        ✓ invalid querystring subscription has coupon (8602ms)
        ✓ invalid querystring subscription is canceling (9272ms)
      invalid-account
        ✓ ineligible accessing account (7670ms)
      invalid-couponid
        ✓ missing posted couponid (7850ms)
        ✓ invalid posted couponid (8033ms)
      invalid-coupon
        ✓ invalid posted coupon is not published (7917ms)
        ✓ invalid posted coupon is unpublished (8068ms)
        ✓ invalid posted coupon is other currency (7806ms)
    returns
      ✓ object (7807ms)

  /api/user/subscriptions/set-subscription-plan
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid
      invalid-account
        ✓ ineligible accessing account (15269ms)
      invalid-planid
        ✓ missing posted planid (7082ms)
        ✓ invalid posted planid (8334ms)
      invalid-plan
        ✓ invalid posted plan is not published (11030ms)
        ✓ invalid posted plan is unpublished (8592ms)
        ✓ invalid posted plan is unchanged (7525ms)
    invalid-paymentmethodid
      ✓ invalid customer requires payments method (6424ms)
    returns
      ✓ object (9139ms)

  /api/user/subscriptions/set-subscription-quantity
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid
      invalid-account
        ✓ ineligible accessing account (7392ms)
      invalid-quantity
        ✓ invalid posted quantity (7881ms)
        ✓ invalid posted quantity is unchanged (7682ms)
        ✓ invalid posted quantity is negative (8049ms)
        ✓ invalid posted quantity is zero (9714ms)
    returns
      ✓ object (8548ms)

  /api/user/subscriptions/set-subscription-tax-percent
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid
      invalid-account
        ✓ ineligible accessing account (8095ms)
      invalid-tax_percent
        ✓ invalid posted tax_percent (7175ms)
        ✓ invalid posted tax_percent is unchanged (7576ms)
        ✓ invalid posted tax_percent is negative (7943ms)
    returns
      ✓ object (8141ms)

  /api/user/subscriptions/setup-intent
    exceptions
      invalid-setupintentid
        ✓ missing querystring setupintentid
        ✓ invalid querystring setupintentid
      invalid-account
        ✓ ineligible accessing account (4034ms)
    returns
      ✓ object (2572ms)

  /api/user/subscriptions/setup-intents-count
    returns
      ✓ integer (4196ms)

  /api/user/subscriptions/setup-intents
    exceptions
      invalid-accountid
        ✓ missing querystring accountid
        ✓ invalid querystring accountid
      invalid-account
        ✓ ineligible accessing account
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    configuration
      ✓ environment PAGE_SIZE

  /api/user/subscriptions/subscription
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid
      invalid-account
        ✓ ineligible accessing account (14834ms)
    returns
      ✓ object (7232ms)

  /api/user/subscriptions/subscriptions-count
    exceptions
      invalid-accountid
        ✓ missing querystring accountid
        ✓ invalid querystring accountid
      invalid-account
        ✓ ineligible accessing account
    returns
      ✓ integer (13574ms)

  /api/user/subscriptions/subscriptions
    exceptions
      invalid-accountid
        ✓ missing querystring accountid
        ✓ invalid querystring accountid
      invalid-account
        ✓ ineligible accessing account
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/user/subscriptions/upcoming-invoice
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid
      invalid-account
        ✓ ineligible accessing account (14852ms)
      invalid-subscription
        ✓ ineligible querystring subscription (14471ms)
    returns
      ✓ object (7981ms)

  /api/user/subscriptions/usage-record-summaries
    exceptions
      invalid-subscriptionitemid
        ✓ missing querystring subscriptionitemid
        ✓ invalid querystring subscriptionitemid
    receives
      ✓ optional querystring starting_after (string)
      ✓ optional querystring ending_before (string)
      ✓ optional querystring limit (integer)
    returns
      ✓ stripe list response
    configuration
      ✓ environment PAGE_SIZE


  966 passing (2h)

