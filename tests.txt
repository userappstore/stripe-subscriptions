
> @userappstore/stripe-subscriptions@1.0.1058 test /root/workspace/stripe-subscriptions
> NODE_ENV=testing mocha --recursive --timeout 1800000 --slow 1 "src"



  proxy/x-customer-header
    Customer#AFTER
before....
 - 1 - 
      ✓ should set customer data in header (2168ms)

  proxy/x-invoices-header
    Invoices#AFTER
before....
 - 2 - 
      ✓ should set invoice data in header (15510ms)

  proxy/x-subscriptions-header
    Subscriptions#AFTER
before....
 - 3 - 
      ✓ should set invoice data in header (12328ms)

  server/bind-customer
    BindCustomer#AFTER
before....
 - 4 - 
      ✓ should bind existing customer data to req (2630ms)

  server/bind-stripekey
    BindStripeKey#AFTER
before....
 - 5 - 
      ✓ should bind stripekey data to req (1611ms)

  server/require-payment
    RequirePayment#AFTER
before....
 - 6 - 
      ✓ should allow non-customer through (1605ms)
before....
 - 7 - 
      ✓ should allow non-owing customer through (2046ms)
before....
 - 8 - 
      ✓ should allow owing customer access to /account/* (22298ms)
before....
 - 9 - 
      ✓ should allow owing administrator access to /administrator/ (15971ms)
before....
 - 10 - 
      ✓ should redirect owing customer to the payment form (14098ms)

  server/require-subscription
    RequireSubscription#AFTER
before....
 - 11 - 
      ✓ should allow non-customer (1609ms)
before....
 - 12 - 
      ✓ should allow customer without subscription access to /account/* (2076ms)
before....
 - 13 - 
      ✓ should allow administrator without subscription access to /administrator/ (3598ms)
before....
 - 14 - 
      ✓ should redirect unsubscribed customer to the plans list (2009ms)
before....
 - 15 - 
      ✓ should allow customer with subscription to pass (16132ms)

  /account/subscriptions/cancel-subscription
    CancelSubscription#BEFORE
before....
 - 16 - 
      ✓ should bind subscription to req (46678ms)
    CancelSubscription#GET
before....
 - 17 - 
      ✓ should present the form (14679ms)
before....
 - 18 - 
      ✓ should present the subscription table (11923ms)
    CancelSubscription#POST
before....
 - 19 - 
      ✓ should apply after authorization (13841ms)

  /account/subscriptions/card
    Card#BEFORE
before....
 - 20 - 
      ✓ should reject invalid card (1988ms)
before....
 - 21 - 
      ✓ should reject other account's card (9786ms)
before....
 - 22 - 
      ✓ should bind card to req (7994ms)
    Card#GET
before....
 - 23 - 
      ✓ should have row for card (8089ms)

  /account/subscriptions/cards
    Cards#BEFORE
before....
 - 24 - 
      ✓ should bind cards to req (11923ms)
    Cards#GET
before....
 - 25 - 
      ✓ should enforce page size (10384ms)
before....
 - 26 - 
      ✓ should enforce specified offset (9837ms)

  /account/subscriptions/change-plan
    ChangePlan#BEFORE
before....
 - 27 - 
      ✓ should bind subscription to req (13640ms)
    ChangePlan#GET
before....
 - 28 - 
      ✓ should present the form (17355ms)
before....
 - 29 - 
      ✓ should present the subscription table (14782ms)
    ChangePlan#POST
before....
 - 30 - 
      ✓ should reject same plan (15568ms)
before....
 - 31 - 
      ✓ should reject never published plan (17698ms)
before....
 - 32 - 
      ✓ should reject unpublished plan (17478ms)
before....
 - 33 - 
      ✓ should reject paid plan without payment information (13524ms)
before....
 - 34 - 
      ✓ should apply after authorization (17801ms)

  /account/subscriptions/delete-card
    DeleteCard#BEFORE
before....
 - 35 - 
      ✓ should reject invalid cardid (5953ms)
before....
 - 36 - 
      ✓ should reject other account's card (9820ms)
before....
 - 37 - 
      ✓ should reject default payment source (8091ms)
before....
 - 38 - 
      ✓ should bind card to req (5587ms)
    DeleteCard#GET
before....
 - 39 - 
      ✓ should present the form (7308ms)
before....
 - 40 - 
      ✓ should present the card table (5695ms)
    DeleteCard#POST
before....
 - 41 - 
      ✓ should apply after authorization (7437ms)

  /account/subscriptions/edit-payment-information
    EditPaymentInformation#GET
before....
 - 42 - 
      ✓ should present the form (2281ms)
    EditPaymentInformation#POST
before....
 - 43 - 
      ✓ should require name (2372ms)
before....
 - 44 - 
      ✓ should require CVC (2362ms)
before....
 - 45 - 
      ✓ should require card number (2235ms)
before....
 - 46 - 
      ✓ should require expiration month (2296ms)
before....
 - 47 - 
      ✓ should require expiration year (2361ms)
before....
 - 48 - 
      ✓ should apply after authorization (4090ms)

  /account/subscriptions
    Index#BEFORE
before....
 - 49 - 
      ✓ should bind cards to req (15002ms)
before....
 - 50 - 
      ✓ should bind invoices to req (18136ms)
before....
 - 51 - 
      ✓ should bind subscriptions to req (18049ms)
    Index#GET
before....
 - 52 - 
      ✓ should have row for each invoice (22403ms)
before....
 - 53 - 
      ✓ should have row for each card (20613ms)
before....
 - 54 - 
      ✓ should have row for each subscription (23321ms)

  /account/subscriptions/invoice
    Invoice#BEFORE
before....
 - 55 - 
      ✓ should reject invalid invoice (3719ms)
before....
 - 56 - 
      ✓ should reject other account's invoice (16942ms)
before....
 - 57 - 
      ✓ should bind invoice to req (16779ms)
    Invoice#GET
before....
 - 58 - 
      ✓ should have row for invoice (14668ms)

  /account/subscriptions/invoices
    Invoices#BEFORE
before....
 - 59 - 
      ✓ should bind invoices to req (32870ms)
    Invoices#GET
before....
 - 60 - 
      ✓ should enforce page size (44263ms)
before....
 - 61 - 
      ✓ should enforce specified offset (38903ms)

  /account/subscriptions/pay-invoice
    PayInvoice#BEFORE
before....
 - 62 - 
      ✓ should reject invalid invoice (2213ms)
before....
 - 63 - 
      ✓ should reject other account's invoice (22788ms)
before....
 - 64 - 
      ✓ should reject paid invoice (15082ms)
before....
 - 65 - 
      ✓ should bind invoice to req (24135ms)
    PayInvoice#GET
before....
 - 66 - 
      ✓ should present the form (23922ms)
before....
 - 67 - 
      ✓ should present the invoice table (19170ms)
    PayInvoice#POST
before....
 - 68 - 
      ✓ should apply after authorization (21172ms)

  /account/subscriptions/plan
    Plan#BEFORE
before....
 - 69 - 
      ✓ should reject invalid plan (2273ms)
before....
 - 70 - 
      ✓ should reject never published plan (6382ms)
before....
 - 71 - 
      ✓ should reject unpublished plan (7628ms)
before....
 - 72 - 
      ✓ should bind plan to req (6334ms)
    Plan#GET
before....
 - 73 - 
      ✓ should have row for plan (6343ms)

  /account/subscriptions/plans
    Plans#BEFORE
before....
 - 74 - 
      ✓ should bind plans to req (10135ms)
    Plans#GET
before....
 - 75 - 
      ✓ should enforce page size (11597ms)
before....
 - 76 - 
      ✓ should enforce specified offset (11565ms)

  /account/subscriptions/refund-invoice
    RefundInvoice#BEFORE
before....
 - 77 - 
      ✓ should reject invalid invoice (4065ms)
before....
 - 78 - 
      ✓ should reject other account's invoice (16229ms)
before....
 - 79 - 
      ✓ should bind invoice to req (16766ms)
before....
 - 80 - 
      ✓ should bind charge to req (16372ms)
    RefundInvoice#GET
before....
 - 81 - 
      ✓ should present the form (13251ms)
before....
 - 82 - 
      ✓ should present the invoice table (17847ms)
    RefundInvoice#PATCH
before....
 - 83 - 
      ✓ should apply after authorization (19026ms)

  /account/subscriptions/start-subscription
    StartSubscription#BEFORE
before....
 - 84 - 
      ✓ should reject invalid plan (2029ms)
before....
 - 85 - 
      ✓ should reject never published plan (7860ms)
before....
 - 86 - 
      ✓ should reject unpublished plan (7764ms)
before....
 - 87 - 
      ✓ should bind plan to req (8073ms)
    StartSubscription#GET
before....
 - 88 - 
      ✓ should present the form (7861ms)
before....
 - 89 - 
      ✓ should present the plan table (7789ms)
    StartSubscription#POST
before....
 - 90 - 
      ✓ should reject customer without card (6672ms)
before....
 - 91 - 
      ✓ should reject duplicate subscription (17493ms)
before....
 - 92 - 
      ✓ should apply after authorization (10302ms)

  /account/subscriptions/subscription
    Subscription#BEFORE
before....
 - 93 - 
      ✓ should reject invalid subscription (2051ms)
before....
 - 94 - 
      ✓ should reject other account's subscription (13942ms)
before....
 - 95 - 
      ✓ should bind subscription to req (11931ms)
    Subscription#GET
before....
 - 96 - 
      ✓ should present the subscription table (14667ms)

  /account/subscriptions/subscriptions
    Subscriptions#BEFORE
before....
 - 97 - 
      ✓ should bind subscriptions to req (20046ms)
    Subscriptions#GET
before....
 - 98 - 
      ✓ should enforce page size (44327ms)
before....
 - 99 - 
      ✓ should enforce specified offset (40023ms)

  /administrator/subscriptions/charge
    Charge#BEFORE
before....
 - 100 - 
      ✓ should reject invalid charge (4382ms)
before....
 - 101 - 
      ✓ should bind charge to req (16581ms)
    Charge#GET
before....
 - 102 - 
      ✓ should present the charge table (12851ms)

  /administrator/subscriptions/charges
    Charges#BEFORE
before....
 - 103 - 
      ✓ should bind charges to req (16433ms)
    Charges#GET
before....
 - 104 - 
      ✓ should enforce page size (26844ms)
before....
 - 105 - 
      1) should enforce specified offset

  /administrator/subscriptions/coupon
    Coupon#BEFORE
before....
 - 106 - 
      ✓ should reject invalid coupon (2086ms)
before....
 - 107 - 
      ✓ should bind coupon to req (2722ms)
    Coupon#GET
before....
 - 108 - 
      ✓ should present the coupon table (2779ms)

  /administrator/subscriptions/coupons
    Coupons#BEFORE
before....
 - 109 - 
      ✓ should bind coupons to req (2779ms)
    Coupons#GET
before....
 - 110 - 
      ✓ should enforce page size (5927ms)
before....
 - 111 - 
      ✓ should enforce specified offset (5875ms)

  /administrator/subscriptions/create-coupon
    CreateCoupon#GET
before....
 - 112 - 
      ✓ should present the form (1746ms)
    CreateCoupon#POST
before....
 - 113 - 
      ✓ should reject missing couponid (1706ms)
before....
 - 114 - 
      ✓ should enforce couponid length (1730ms)
before....
 - 115 - 
      ✓ should reject duplicate couponid (2537ms)
before....
 - 116 - 
      ✓ should reject missing duration (1738ms)
before....
 - 117 - 
      ✓ should enforce invalid duration (1711ms)
before....
 - 118 - 
      ✓ should require valid amount off (1694ms)
before....
 - 119 - 
      ✓ should require valid percent off (1689ms)
before....
 - 120 - 
      ✓ should require valid max redemptions (1726ms)
before....
 - 121 - 
      ✓ should require amount or percent off (1707ms)
before....
 - 122 - 
      ✓ should require valid duration in months if repeating (1698ms)
before....
 - 123 - 
      ✓ should require valid expires if provided (1694ms)
before....
 - 124 - 
      ✓ should create after authorization (2973ms)

  /administrator/subscriptions/create-plan
    CreatePlan#GET
before....
 - 125 - 
      ✓ should present the form (1637ms)
    CreatePlan#POST
before....
 - 126 - 
      ✓ should reject missing planid (1638ms)
before....
 - 127 - 
      ✓ should enforce planid length (2842ms)
before....
 - 128 - 
      ✓ should reject missing productid (1804ms)
before....
 - 129 - 
      ✓ should reject never published product (3329ms)
before....
 - 130 - 
      ✓ should reject unpublished product (4118ms)
before....
 - 131 - 
      ✓ should reject missing currency (2813ms)
before....
 - 132 - 
      ✓ should reject invalid currency (2782ms)
before....
 - 133 - 
      ✓ should reject missing amount (2781ms)
before....
 - 134 - 
      ✓ should reject invalid amount (2768ms)
before....
 - 135 - 
      ✓ should reject missing interval (2927ms)
before....
 - 136 - 
      ✓ should reject invalid interval (2887ms)
before....
 - 137 - 
      ✓ should reject invalid interval_count (2845ms)
before....
 - 138 - 
      ✓ should reject invalid trial_period_days (3086ms)
before....
 - 139 - 
      ✓ should create after authorization (4237ms)

  /administrator/subscriptions/create-product
    CreateProduct#GET
before....
 - 140 - 
      ✓ should present the form (1621ms)
    CreateProduct#POST
before....
 - 141 - 
      ✓ should reject missing name (1614ms)
before....
 - 142 - 
      ✓ should enforce name length (1633ms)
before....
 - 143 - 
      ✓ should reject missing statement_descriptor (1622ms)
before....
 - 144 - 
      ✓ should create after authorization (2416ms)

  /administrator/subscriptions/customer
    Customer#BEFORE
before....
 - 145 - 
      ✓ should reject invalid customer (4220ms)
before....
 - 146 - 
      ✓ should bind customer to req (3996ms)
    Customer#GET
before....
 - 147 - 
      ✓ should present the customer table (4081ms)

  /administrator/subscriptions/customers
    Customers#BEFORE
before....
 - 148 - 
      ✓ should bind customers to req (6226ms)
    Customers#GET
before....
 - 149 - 
      ✓ should enforce page size (10673ms)
before....
 - 150 - 
      ✓ should enforce specified offset (10700ms)

  /administrator/subscriptions/delete-coupon
    DeleteCoupon#BEFORE
before....
 - 151 - 
      ✓ should reject invalid couponid (1965ms)
before....
 - 152 - 
      ✓ should bind coupon to req (2846ms)
    DeleteCoupon#GET
before....
 - 153 - 
      ✓ should present the form (2724ms)
before....
 - 154 - 
      ✓ should present the coupon table (2758ms)
    DeleteCoupon#POST
before....
 - 155 - 
      ✓ should apply after authorization (4214ms)

  /administrator/subscriptions/delete-plan
    DeletePlan#BEFORE
before....
 - 156 - 
      ✓ should reject invalid planid (1996ms)
before....
 - 157 - 
      ✓ should bind plan to req (4229ms)
    DeletePlan#GET
before....
 - 158 - 
      ✓ should present the form (4381ms)
before....
 - 159 - 
      ✓ should present the plan table (4254ms)
    DeletePlan#POST
before....
 - 160 - 
      ✓ should apply after authorization (6044ms)

  /administrator/subscriptions/delete-product
    DeleteProduct#BEFORE
before....
 - 161 - 
      ✓ should reject invalid productid (1996ms)
before....
 - 162 - 
      ✓ should bind product to req (2724ms)
    DeleteProduct#GET
before....
 - 163 - 
      ✓ should present the form (2734ms)
before....
 - 164 - 
      ✓ should present the product table (2718ms)
    DeleteProduct#POST
before....
 - 165 - 
      ✓ should apply after authorization (4233ms)

  /administrator/subscriptions/delete-subscription
    DeleteSubscription#BEFORE
before....
 - 166 - 
      ✓ should reject invalid subscriptionid (2026ms)
before....
 - 167 - 
      ✓ should bind subscription to req (13784ms)
    DeleteSubscription#GET
before....
 - 168 - 
      ✓ should present the form (16099ms)
before....
 - 169 - 
      ✓ should present the subscription table (12602ms)
    DeleteSubscription#POST
before....
 - 170 - 
      ✓ should apply after authorization (15099ms)

  /administrator/subscriptions/edit-plan
    EditPlan#BEFORE
before....
 - 171 - 
      ✓ should reject invalid planid (1921ms)
before....
 - 172 - 
      ✓ should reject unpublished plan (5487ms)
before....
 - 173 - 
      ✓ should bind plan to req (4562ms)
    EditPlan#GET
before....
 - 174 - 
      ✓ should present the form (4558ms)
    EditPlan#POST
before....
 - 175 - 
      ✓ should reject missing productid (4986ms)
before....
 - 176 - 
      ✓ should reject never published product (6384ms)
before....
 - 177 - 
      ✓ should reject unpublished product (7671ms)
before....
 - 178 - 
      ✓ should reject invalid trial period (5775ms)
before....
 - 179 - 
      ✓ should update after authorization (7219ms)

  /administrator/subscriptions/edit-product
    EditProduct#BEFORE
before....
 - 180 - 
      ✓ should reject invalid productid (1941ms)
before....
 - 181 - 
      ✓ should reject unpublished product (4055ms)
before....
 - 182 - 
      ✓ should bind product to req (3016ms)
    EditProduct#GET
before....
 - 183 - 
      ✓ should present the form (2918ms)
    EditProduct#POST
before....
 - 184 - 
      ✓ should reject missing name (2729ms)
before....
 - 185 - 
      ✓ should enforce name length (2701ms)
before....
 - 186 - 
      ✓ should reject missing statement_descriptor (2784ms)
before....
 - 187 - 
      ✓ should reject invalid unit_label (2813ms)
before....
 - 188 - 
      ✓ should update after authorization (3952ms)

  /administrator/subscriptions/flag-charge
    FlagCharge#BEFORE
before....
 - 189 - 
      ✓ should reject invalid chargeid (2064ms)
before....
 - 190 - 
      ✓ should reject unrefunded charge (15756ms)
before....
 - 191 - 
      ✓ should bind charge to req (17715ms)
    FlagCharge#GET
before....
 - 192 - 
      ✓ should present the form (19164ms)
before....
 - 193 - 
      ✓ should present the charge table (18880ms)
    FlagCharge#POST
before....
 - 194 - 
      ✓ should apply after authorization (19154ms)

  /administrator/subscriptions/forgive-invoice
    ForgiveInvoice#BEFORE
before....
 - 195 - 
      ✓ should reject invalid invoiceid (1908ms)
before....
 - 196 - 
      ✓ should reject paid invoice (15364ms)
before....
 - 197 - 
      ✓ should reject forgiven invoice (25924ms)
before....
 - 198 - 
      ✓ should bind invoice to req (22552ms)
    ForgiveInvoice#GET
before....
 - 199 - 
      ✓ should present the form (22854ms)
before....
 - 200 - 
      ✓ should present the invoice table (24063ms)
    ForgiveInvoice#POST
before....
 - 201 - 
      ✓ should apply after authorization (19537ms)

  /administrator/subscriptions
    Index#BEFORE
before....
 - 202 - 
      ✓ should bind plans to req (4393ms)
before....
 - 203 - 
      ✓ should bind subscriptions to req (13112ms)
before....
 - 204 - 
      ✓ should bind coupons to req (2721ms)
    Index#GET
before....
 - 205 - 
      ✓ should have row for each plan (6158ms)
before....
 - 206 - 
      ✓ should have row for each coupon (3922ms)
before....
 - 207 - 
      ✓ should have row for each subscription (31147ms)

  /administrator/subscriptions/invoice
    Invoice#BEFORE
before....
 - 208 - 
      ✓ should reject invalid invoiceid (1910ms)
before....
 - 209 - 
      ✓ should bind invoice to req (15732ms)
    Invoice#GET
before....
 - 210 - 
