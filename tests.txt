
> @userappstore/stripe-subscriptions@1.0.1036 test /home/ubuntu/workspace
> NODE_ENV=testing mocha src/www/api --recursive --timeout 1800000 --slow 1



  /api/administrator/subscriptions/card-charges-count
    CardChargesCount#GET
      ✓ should count all charges on card (22960ms)

  /api/administrator/subscriptions/card-charges
    CardCharges#GET
      ✓ should limit charges on card to one page (52613ms)

  /api/administrator/subscriptions/card-invoices-count
    CardInvoicesCount#GET
      ✓ should count all invoices on card (20856ms)

  /api/administrator/subscriptions/card-invoices
    CardInvoices#GET
      ✓ should limit invoices on card to one page (26141ms)

  /api/administrator/subscriptions/card-refunds-count
    CardRefundsCount#GET
      ✓ should count all refunds on card (33658ms)

  /api/administrator/subscriptions/card-refunds
    CardRefunds#GET
      ✓ should limit refunds on card to one page (51659ms)

  /api/administrator/subscriptions/card
    Card#GET
      ✓ should reject invalid card (4855ms)
      ✓ should return card data (4978ms)

  /api/administrator/subscriptions/charge
    Charge#GET
      ✓ should reject invalid charge (1802ms)
      ✓ should return charge data (15266ms)

  /api/administrator/subscriptions/charges-count
    ChargesCount#GET
      ✓ should count charges (37087ms)

  /api/administrator/subscriptions/charges
    Charges#GET
      ✓ should limit charges to one page (29417ms)

  /api/administrator/subscriptions/coupon-customers-count
    CouponCustomersCount#GET
      ✓ should count all customers on coupon (11724ms)

  /api/administrator/subscriptions/coupon-customers
    CouponCustomers#GET
      ✓ should limit customers on coupon to one page (17575ms)

  /api/administrator/subscriptions/coupon-subscriptions-count
    CouponSubscriptionsCount#GET
      ✓ should count all subscriptions on coupon (51988ms)

  /api/administrator/subscriptions/coupon-subscriptions
    CouponSubscriptions#GET
      ✓ should limit subscriptions on coupon to one page (37196ms)

  /api/administrator/subscriptions/coupon
    Coupon#GET
      ✓ should reject invalid coupon (1770ms)
      ✓ should return coupon data (2476ms)

  /api/administrator/subscriptions/coupons-count
    CouponsCount#GET
      ✓ should count coupons (5018ms)

  /api/administrator/subscriptions/coupons
    Coupons#GET
      ✓ should limit coupons to one page (4145ms)

  /api/administrator/subscriptions/create-coupon
    CreateCoupon#POST
      ✓ should require alphanumeric id (1574ms)
      ✓ should require percent or amount off (1544ms)
      ✓ should require currency with amount off (1548ms)
      ✓ should require valid percent off (1541ms)
      ✓ should require valid duration (1546ms)
      ✓ should require valid repeating duration (1544ms)
      ✓ should require valid expire_meridien (1558ms)
      ✓ should require valid expire (1574ms)
      ✓ should create coupon (2337ms)
      ✓ should create published coupon (2280ms)

  /api/administrator/subscriptions/create-plan
    CreatePlan#POST
      ✓ should require alphanumeric id (2361ms)
      ✓ should require product (2327ms)
      ✓ should require valid product (1813ms)
      ✓ should require amount (2584ms)
      ✓ should require currency (2377ms)
      ✓ should require valid interval (2674ms)
      ✓ should require valid interval count (2734ms)
      ✓ should require valid trial period (2644ms)
      ✓ should create plan (3650ms)
      ✓ should create published plan (3554ms)

  /api/administrator/subscriptions/create-product
    CreateProduct#POST
      ✓ should require name (1546ms)
      ✓ should require statement_descriptor (1538ms)
      ✓ should create product (3049ms)
      ✓ should create published product (2953ms)

  /api/administrator/subscriptions/create-refund
    CreateRefund#POST
      ✓ should reject invalid charge (1773ms)
      ✓ should require amount (13977ms)
      ✓ should reject negative amount (10598ms)
      ✓ should reject amount higher than charge (13334ms)
      ✓ should create authorized refund (15883ms)

  /api/administrator/subscriptions/customer-cards-count
    CustomerCardsCount#GET
      ✓ should count all cards on customer (10955ms)

  /api/administrator/subscriptions/customer-cards
    CustomerCards#GET
      ✓ should limit cards on customer to one page (8330ms)

  /api/administrator/subscriptions/customer-charges-count
    CustomerChargesCount#GET
      ✓ should count all charges on customer (19394ms)

  /api/administrator/subscriptions/customer-charges
    CustomerCharges#GET
      ✓ should limit charges on customer to one page (31979ms)

  /api/administrator/subscriptions/customer-invoices-count
    CustomerInvoicesCount#GET
      ✓ should count all invoices on customer (20119ms)

  /api/administrator/subscriptions/customer-invoices
    CustomerInvoices#GET
      ✓ should limit invoices on customer to one page (27638ms)

  /api/administrator/subscriptions/customer-refunds-count
    CustomerRefundsCount#GET
      ✓ should count all refunds on customer (27312ms)

  /api/administrator/subscriptions/customer-refunds
    CustomerRefunds#GET
      ✓ should limit refunds on customer to one page (57415ms)

  /api/administrator/subscriptions/customer-subscriptions-count
    CustomerSubscriptionsCount#GET
      ✓ should count all subscriptions on customer (20045ms)

  /api/administrator/subscriptions/customer-subscriptions
    CustomerSubscriptions#GET
      ✓ should limit subscriptions on customer to one page (31524ms)

  /api/administrator/subscriptions/customer
    Customer#GET
      ✓ should reject invalid customer (1840ms)
      ✓ should return customer data (5743ms)

  /api/administrator/subscriptions/customers-count
    CustomersCount#GET
      ✓ should count customers (5231ms)

  /api/administrator/subscriptions/customers
    Customers#GET
      ✓ should limit customers to one page (7596ms)

  /api/administrator/subscriptions/delete-coupon
    DeleteCoupon#DELETE
      ✓ should reject invalid couponid (1755ms)
      ✓ should delete coupon (3192ms)

  /api/administrator/subscriptions/delete-plan
    DeletePlan#DELETE
      ✓ should reject invalid planid (1781ms)
      ✓ should delete plan (4461ms)

  /api/administrator/subscriptions/delete-product
    DeleteProduct#DELETE
      ✓ should reject invalid productid (1759ms)
      ✓ should delete product (3251ms)

  /api/administrator/subscriptions/delete-subscription
    DeleteSubscription#DELETE
      ✓ should reject invalid subscriptionid (1771ms)
      ✓ should require active subscription (15134ms)
      ✓ should delete subscription at period end (12922ms)
      ✓ should delete subscription immediately (14407ms)

  /api/administrator/subscriptions/invoice
    Invoice#GET
      ✓ should reject invalid invoice (1861ms)
      ✓ should return invoice data (13540ms)

  /api/administrator/subscriptions/invoices-count
    InvoicesCount#GET
      ✓ should count invoices (20067ms)

  /api/administrator/subscriptions/invoices
    Invoices#GET
      ✓ should limit invoices to one page (35180ms)

  /api/administrator/subscriptions/payout
    Payout#GET
      ✓ should reject invalid payoutid (1785ms)
      ✓ should return payout data (8429ms)

  /api/administrator/subscriptions/payouts-count
    PayoutsCount#GET
      ✓ should count payouts (13647ms)

  /api/administrator/subscriptions/payouts
    Payouts#GET
      ✓ should return limit payouts to one page (21209ms)

  /api/administrator/subscriptions/plan-charges-count
    PlanChargesCount#GET
      ✓ should count all charges on plan (22318ms)

  /api/administrator/subscriptions/plan-charges
    PlanCharges#GET
      ✓ should limit charges on plan to one page (62643ms)

  /api/administrator/subscriptions/plan-customers-count
    PlanCustomersCount#GET
      ✓ should count all customers on plan (20803ms)

  /api/administrator/subscriptions/plan-customers
    PlanCustomers#GET
      ✓ should limit customers on plan to one page (31516ms)

  /api/administrator/subscriptions/plan-invoices-count
    PlanInvoicesCount#GET
      ✓ should count all invoices on plan (20626ms)

  /api/administrator/subscriptions/plan-invoices
    PlanInvoices#GET
      ✓ should limit invoices on plan to one page (37495ms)

  /api/administrator/subscriptions/plan-refunds-count
    PlanRefundsCount#GET
      ✓ should count all refunds on plan (34747ms)

  /api/administrator/subscriptions/plan-refunds
    PlanRefunds#GET
      ✓ should limit refunds on plan to one page (49121ms)

  /api/administrator/subscriptions/plan-subscriptions-count
    PlanSubscriptionsCount#GET
      ✓ should count all subscriptions on plan (25335ms)

  /api/administrator/subscriptions/plan-subscriptions
    PlanSubscriptions#GET
      ✓ should limit subscriptions on plan to one page (30618ms)

  /api/administrator/subscriptions/plan
    Plan#GET
      ✓ should return plan data (3994ms)

  /api/administrator/subscriptions/plans-count
    PlansCount#GET
      ✓ should count plans (6026ms)

  /api/administrator/subscriptions/plans
    Plans#GET
      ✓ should limit plans to one page (8509ms)

  /api/administrator/subscriptions/product-charges-count
    ProductChargesCount#GET
      ✓ should count all charges on product (25111ms)

  /api/administrator/subscriptions/product-charges
    ProductCharges#GET
      ✓ should limit charges on product to one page (28009ms)

  /api/administrator/subscriptions/product-customers-count
    ProductCustomersCount#GET
      ✓ should count all customers on product (23615ms)

  /api/administrator/subscriptions/product-customers
    ProductCustomers#GET
      ✓ should limit customers on product to one page (32855ms)

  /api/administrator/subscriptions/product-invoices-count
    ProductInvoicesCount#GET
      ✓ should count all invoices on product (22857ms)

  /api/administrator/subscriptions/product-invoices
    ProductInvoices#GET
      ✓ should limit invoices on product to one page (34505ms)

  /api/administrator/subscriptions/product-refunds-count
    ProductRefundsCount#GET
      ✓ should count all refunds on product (32971ms)

  /api/administrator/subscriptions/product-refunds
    ProductRefunds#GET
      ✓ should limit refunds on product to one page (57964ms)

  /api/administrator/subscriptions/product-subscriptions-count
    ProductSubscriptionsCount#GET
      ✓ should count all subscriptions on product (24038ms)

  /api/administrator/subscriptions/product-subscriptions
    ProductSubscriptions#GET
      ✓ should limit subscriptions on product to one page (34999ms)

  /api/administrator/subscriptions/product
    Product#GET
      ✓ should return product data (2649ms)

  /api/administrator/subscriptions/products-count
    ProductsCount#GET
      ✓ should count products (3725ms)

  /api/administrator/subscriptions/products
    Products#GET
      ✓ should limit products to one page (5062ms)

  /api/administrator/subscriptions/published-coupons-count
    PublishedCouponsCount#GET
      ✓ should count all published coupons (5391ms)

  /api/administrator/subscriptions/published-coupons
    PublishedCoupons#GET
      ✓ should limit published coupons to one page (4067ms)

  /api/administrator/subscriptions/published-plans-count
    PublishedPlansCount#GET
      ✓ should count all published plans (8161ms)

  /api/administrator/subscriptions/published-plans
    PublishedPlans#GET
      ✓ should limit published plans to one page (6563ms)

  /api/administrator/subscriptions/published-products-count
    PublishedProductsCount#GET
      ✓ should count all published products (5377ms)

  /api/administrator/subscriptions/published-products
    PublishedProducts#GET
      ✓ should limit published products to one page (4463ms)

  /api/administrator/subscriptions/refund
    Refund#GET
      ✓ should reject invalid refund (1765ms)
      ✓ should return refund data (28840ms)

  /api/administrator/subscriptions/refunds-count
    RefundsCount#GET
      ✓ should count all refunds (34848ms)

  /api/administrator/subscriptions/refunds
    Refunds#GET
      ✓ should limit refunds to one page (59537ms)

  /api/administrator/subscriptions/reset-customer-coupon
    ResetCustomerCoupon#PATCH
      ✓ should reject invalid customerid (1793ms)
      ✓ should reject undiscounted customer (3695ms)
      ✓ should remove customer coupon (6416ms)

  /api/administrator/subscriptions/reset-subscription-coupon
    ResetSubscriptionCoupon#PATCH
      ✓ should reject invalid subscriptionid (1778ms)
      ✓ should reject undiscounted subscription (14023ms)
      ✓ should remove subscription coupon (17014ms)

  /api/administrator/subscriptions/set-charge-flagged
    SetChargeRefunded#PATCH
      ✓ should reject invalid charge (1805ms)
      ✓ should reject flagged charge (17935ms)
      ✓ should require refunded charge (11256ms)
      ✓ should update charge flagged as fraud (23118ms)

  /api/administrator/subscriptions/set-coupon-published
    SetCouponPublished#PATCH
      ✓ should reject invalid couponid (1832ms)
      ✓ should reject published coupon (2476ms)
      ✓ should publish coupon (3256ms)

  /api/administrator/subscriptions/set-coupon-unpublished
    SetCouponUnpublished#PATCH
      ✓ should reject invalid couponid (1778ms)
      ✓ should reject never published coupon (2493ms)
      ✓ should reject unpublished coupon (3466ms)
      ✓ should unpublish coupon (3219ms)

  /api/administrator/subscriptions/set-invoice-forgiven
    SetInvoiceForgiven#PATCH
      ✓ should reject invalid invoiceid (1765ms)
      ✓ should reject paid invoice (13636ms)
      ✓ should reject forgiven invoice (18191ms)
      ✓ should forgive invoice (21660ms)

  /api/administrator/subscriptions/set-plan-published
    SetPlanPublished#PATCH
      ✓ should reject invalid planid (1787ms)
      ✓ should reject published plan (3728ms)
      ✓ should publish plan (4476ms)

  /api/administrator/subscriptions/set-plan-unpublished
    SetPlanUnpublished#PATCH
      ✓ should reject invalid planid (1771ms)
      ✓ should reject never published plan (3839ms)
      ✓ should reject unpublished plan (4830ms)
      ✓ should unpublish plan (4560ms)

  /api/administrator/subscriptions/set-product-published
    SetProductPublished#PATCH
      ✓ should reject invalid productid (2488ms)
      ✓ should reject published product (2458ms)
      ✓ should publish product (3243ms)

  /api/administrator/subscriptions/set-product-unpublished
    SetProductUnpublished#PATCH
      ✓ should reject invalid productid (2479ms)
      ✓ should reject never published product (2476ms)
      ✓ should reject unpublished product (3477ms)
      ✓ should unpublish product (3384ms)

  /api/administrator/subscriptions/subscription-charges-count
    SubscriptionChargesCount#GET
      ✓ should count all charges on subscription (19778ms)

  /api/administrator/subscriptions/subscription-charges
    SubscriptionCharges#GET
      ✓ should limit charges on subscription to one page (26705ms)

  /api/administrator/subscriptions/subscription-invoices-count
    SubscriptionInvoicesCount#GET
      ✓ should count all invoices on subscription (20461ms)

  /api/administrator/subscriptions/subscription-invoices
    SubscriptionInvoices#GET
      ✓ should limit invoices on subscription to one page (27808ms)

  /api/administrator/subscriptions/subscription-refunds-count
    SubscriptionRefundsCount#GET
      ✓ should count all refunds on subscription (33878ms)

  /api/administrator/subscriptions/subscription-refunds
    SubscriptionRefunds#GET
      ✓ should limit refunds on subscription to one page (48220ms)

  /api/administrator/subscriptions/subscription
    Subscription#GET
      ✓ should reject invalid subscriptionid (1771ms)
      ✓ should return subscription data (13181ms)

  /api/administrator/subscriptions/subscriptions-count
    SubscriptionsCount#GET
      ✓ should count all subscriptions (20350ms)

  /api/administrator/subscriptions/subscriptions
    Subscriptions#GET
      ✓ should limit subscriptions to one page (22829ms)

  /api/administrator/subscriptions/unpublished-coupons-count
    UnpublishedCouponsCount#GET
      ✓ should count all unpublished coupons (7441ms)

  /api/administrator/subscriptions/unpublished-coupons
    UnpublishedCoupons#GET
      ✓ should limit unpublished coupons to one page (7027ms)

  /api/administrator/subscriptions/unpublished-plans-count
    UnpublishedPlansCount#GET
      ✓ should count all unpublished plans (10404ms)

  /api/administrator/subscriptions/unpublished-plans
    UnpublishedPlans#GET
      ✓ should limit unpublished plans to one page (9711ms)

  /api/administrator/subscriptions/unpublished-products-count
    UnpublishedProductsCount#GET
      ✓ should count all unpublished products (6635ms)

  /api/administrator/subscriptions/unpublished-products
    UnpublishedProducts#GET
      ✓ should limit unpublished products to one page (7001ms)

  /api/administrator/subscriptions/update-plan
    UpdatePlan#PATCH
      ✓ should reject invalid planid (4417ms)
      ✓ should reject invalid productid (3923ms)
      ✓ should reject unpublished plan (5524ms)
      ✓ should reject unpublished product (5740ms)
      ✓ should reject never published product (4601ms)
      ✓ should reject invalid trial (5734ms)
      ✓ should update plan (5414ms)

  /api/administrator/subscriptions/update-product
    UpdateProduct#PATCH
      ✓ should reject invalid productid (2522ms)
      ✓ should reject invalid name (2482ms)
      ✓ should reject invalid name length (2454ms)
      ✓ should reject invalid statement_descriptor (2577ms)
      ✓ should reject invalid unit_label (2557ms)
      ✓ should update product (3674ms)

  /api/user/subscriptions/card-charges-count
    CardChargesCount#GET
      ✓ should count all charges on card (24515ms)

  /api/user/subscriptions/card-charges
    CardCharges#GET
      ✓ should limit card's charges to one page (35958ms)
      ✓ should enforce page size (41666ms)
      ✓ should enforce specified offset (53352ms)

  /api/user/subscriptions/card-invoices-count
    CardInvoicesCount#GET
      ✓ should count all invoices on card (21647ms)

  /api/user/subscriptions/card-invoices
    CardInvoices#GET
      ✓ should limit invoices on card to one page (37292ms)

  /api/user/subscriptions/card-refunds-count
    CardRefundsCount#GET
      ✓ should count all refunds on card (45647ms)

  /api/user/subscriptions/card-refunds
    CardRefunds#GET
      ✓ should limit refunds on card to one page (48078ms)

  /api/user/subscriptions/card-subscriptions-count
    CardSubscriptionsCount#GET
      ✓ should count all subscriptions on card (34260ms)

  /api/user/subscriptions/card-subscriptions
    CardSubscriptions#GET
      ✓ should limit subscriptions on card to one page (53896ms)

  /api/user/subscriptions/card
    Card#GET
      ✓ should reject invalid card (1860ms)
      ✓ should reject other account's card (5120ms)
      ✓ should return card data (3619ms)

  /api/user/subscriptions/cards-count
    CardsCount#GET
      ✓ should count account's cards (6188ms)

  /api/user/subscriptions/cards
    Cards#GET
      ✓ should limit cards to one page (7020ms)
      ✓ should enforce page size (8823ms)
      ✓ should enforce specified offset (8347ms)

  /api/user/subscriptions/charge
    Charge#GET
      ✓ should reject invalid charge (1616ms)
      ✓ should reject other account's charge (22779ms)
      ✓ should return charge data (20748ms)

  /api/user/subscriptions/charges-count
    Charges#GET
      ✓ should count charges (36503ms)

  /api/user/subscriptions/charges
    Charges#GET
      ✓ should limit charges to one page (33443ms)

  /api/user/subscriptions/create-card
    CreateCard#POST
      ✓ should require name, cvc, number, exp_month and exp_year (2071ms)
      ✓ should create card (3237ms)

  /api/user/subscriptions/create-customer
    CreateCustomer#POST
      ✓ should reject other accountid (3087ms)
      ✓ should reject existing customer (2320ms)
      ✓ should create customer (1863ms)

  /api/user/subscriptions/create-refund
    CreateRefund#POST
      ✓ should reject invalid charge (1549ms)
      ✓ should reject other account's charge (20616ms)
      ✓ should create refund (23018ms)

  /api/user/subscriptions/create-subscription
    CreateSubscription#POST
      ✓ should reject invalid planid (3502ms)
      ✓ should reject never-published planid (7075ms)
      ✓ should reject unpublished plan (8157ms)
      ✓ should allow customer without card on free plan (6808ms)
      ✓ should reject customer without card (5828ms)
      ✓ should create authorized subscription (8252ms)

  /api/user/subscriptions/customer
    Customer#GET
      ✓ should reject invalid customerid (2163ms)
      ✓ should reject other account's customerid (5326ms)
      ✓ should return customer data (3403ms)

  /api/user/subscriptions/delete-card
    DeleteCard#DELETE
      ✓ should reject invalid cardid (1547ms)
      ✓ should reject other account's card (6668ms)
      ✓ should delete card (4315ms)

  /api/user/subscriptions/delete-subscription
    DeleteSubscription#DELETE
      ✓ should reject invalid subscriptionid (1551ms)
      ✓ should reject other account's subscription (14783ms)
      ✓ should require active subscription (20275ms)
      ✓ should delete subscription at period end (20855ms)
      ✓ should delete subscription immediately (16192ms)

  /api/user/subscriptions/invoice
    Invoice#GET
      ✓ should reject invalid invoice (1553ms)
      ✓ should reject other account's invoice (23712ms)
      ✓ should return invoice data (13481ms)

  /api/user/subscriptions/charges-count
    InvoicesCount#GET
      ✓ should count charges (31426ms)

  /api/user/subscriptions/invoices
    Invoices#GET
      ✓ should limit invoices to one page (39675ms)

  /api/user/subscriptions/plan-cards-count
    PlanCardsCount#GET
      ✓ should count all cards on plan (33688ms)

  /api/user/subscriptions/plan-cards
    PlanCards#GET
      ✓ should limit cards to one page (29106ms)
      ✓ should enforce page size (44117ms)
      ✓ should enforce specified offset (66992ms)

  /api/user/subscriptions/plan-charges-count
    PlanChargesCount#GET
      ✓ should count all charges on plan (34422ms)

  /api/user/subscriptions/plan-charges
    PlanCharges#GET
      ✓ should limit charges to one page (58828ms)
      ✓ should enforce page size (44109ms)
      ✓ should enforce specified offset (47954ms)

  /api/user/subscriptions/plan-invoices-count
    PlanInvoicesCount#GET
      ✓ should count all invoices on plan (31611ms)

  /api/user/subscriptions/plan-invoices
    PlanInvoices#GET
      ✓ should limit invoices to one page (34847ms)
      ✓ should enforce page size (42842ms)
      ✓ should enforce specified offset (39517ms)

  /api/user/subscriptions/plan-subscriptions-count
    PlanSubscriptionsCount#GET
      ✓ should count all subscriptions on plan (28805ms)

  /api/user/subscriptions/plan-subscriptions
    PlanSubscriptions#GET
      ✓ should limit subscriptions to one page (34040ms)
      ✓ should enforce page size (58188ms)
      ✓ should enforce specified offset (70273ms)

  /api/user/subscriptions/product-cards-count
    ProductCardsCount#GET
      ✓ should count all cards on product (29330ms)

  /api/user/subscriptions/product-cards
    ProductCards#GET
      ✓ should limit cards to one page (25916ms)
      ✓ should enforce page size (41316ms)
      ✓ should enforce specified offset (49112ms)

  /api/user/subscriptions/product-charges-count
    ProductChargesCount#GET
      ✓ should count all charges on product (32274ms)

  /api/user/subscriptions/product-charges
    ProductCharges#GET
      ✓ should limit charges to one page (30489ms)
      ✓ should enforce page size (43505ms)
      ✓ should enforce specified offset (35468ms)

  /api/user/subscriptions/product-invoices-count
    ProductInvoicesCount#GET
      ✓ should count all invoices on product (59755ms)

  /api/user/subscriptions/product-invoices
    ProductInvoices#GET
      ✓ should limit invoices to one page (51487ms)
      ✓ should enforce page size (33491ms)
      ✓ should enforce specified offset (47923ms)

  /api/user/subscriptions/product-subscriptions-count
    ProductSubscriptionsCount#GET
      ✓ should count all subscriptions on product (29360ms)

  /api/user/subscriptions/product-subscriptions
    ProductSubscriptions#GET
      ✓ should limit subscriptions to one page (30582ms)
      ✓ should enforce page size (42997ms)
      ✓ should enforce specified offset (34787ms)

  /api/user/subscriptions/published-plan
    PublishedPlan#GET
      ✓ should not require account (3772ms)
      ✓ should reject never published plan (5323ms)
      ✓ should reject unpublished plan (6482ms)
      ✓ should return plan data (5299ms)

  /api/user/subscriptions/published-plans-count
    PublishedPlansCount#GET
      ✓ should count published plans (6658ms)

  /api/user/subscriptions/published-plans
    PublishedPlans#GET
      ✓ should not require account (3972ms)
      ✓ should exclude never published plans (4968ms)
      ✓ should exclude unpublished plan (7553ms)
      ✓ should return plan list (8975ms)

  /api/user/subscriptions/published-product
    PublishedProduct#GET
      ✓ should not require account (4012ms)
      ✓ should reject never published product (4003ms)
      ✓ should reject unpublished product (5129ms)
      ✓ should return product data (4052ms)

  /api/user/subscriptions/published-products-count
    PublishedProductsCount#GET
      ✓ should count published products (4482ms)

  /api/user/subscriptions/published-products
    PublishedProducts#GET
      ✓ should not require account (4321ms)
      ✓ should exclude never published products (4749ms)
      ✓ should exclude unpublished product (5806ms)
      ✓ should limit product list to one page (6055ms)

  /api/user/subscriptions/refund
    Refund#GET
      ✓ should reject invalid refund (2038ms)
      ✓ should reject other account's refund (27929ms)
      ✓ should return refund data (32076ms)

  /api/user/subscriptions/refunds-count
    RefundsCount#GET
      ✓ should count refunds (61232ms)

  /api/user/subscriptions/refunds
    Refunds#GET
      ✓ should limit refunds to one page (94870ms)
      ✓ should enforce page size (105430ms)
      ✓ should enforce specified offset (67637ms)

  /api/user/subscriptions/set-customer-coupon
    SetCustomerCoupon#PATCH
      ✓ should reject invalid customerid (5650ms)
      ✓ should reject account with coupon (6169ms)
      ✓ should apply coupon (5198ms)

  /api/user/subscriptions/set-invoice-paid
    SetInvoicePaid#PATCH
      ✓ should reject invalid invoiceid (3525ms)
      ✓ should reject other account's invoice (45422ms)
      ✓ should reject paid invoice (27171ms)
      ✓ should reject forgiven invoice (23468ms)
      ✓ should reject invalid source (15511ms)
      ✓ should reject other account's source (25649ms)
      ✓ should pay invoice (26593ms)

  /api/user/subscriptions/set-subscription-coupon
    SetSubscriptionCoupon#PATCH
      ✓ should reject invalid subscriptionid (5684ms)
      ✓ should reject subscription with coupon (15941ms)
      ✓ should apply coupon (16058ms)

  /api/user/subscriptions/set-subscription-plan
    SetSubscriptionPlan#PATCH
      ✓ should reject invalid subscriptionid (1538ms)
      ✓ should reject other account's subscription (24237ms)
      ✓ should reject same planid (12132ms)
      ✓ should require user add card (8251ms)
      ✓ should change plan (17338ms)

  /api/user/subscriptions/subscription-cards-count
    SubscriptionCardsCount#GET
      ✓ should count all cards on subscriptions (27228ms)

  /api/user/subscriptions/subscription-cards
    SubscriptionCards#GET
      ✓ should limit cards to one page (36951ms)
      ✓ should enforce page size (48637ms)
      ✓ should enforce specified offset (55422ms)

  /api/user/subscriptions/subscription-charges-count
    SubscriptionChargesCount#GET
      ✓ should count all charges on subscription (28465ms)

  /api/user/subscriptions/subscription-charges
    SubscriptionCharges#GET
      ✓ should limit charges on subscription to one page (30848ms)

  /api/user/subscriptions/subscription-invoices-count
    SubscriptionInvoicesCount#GET
      ✓ should count subscription's invoices (44905ms)

  /api/user/subscriptions/subscription-invoices
    SubscriptionInvoices#GET
      ✓ should limit invoices on subscription to one page (35299ms)

  /api/user/subscriptions/subscription-refunds-count
    SubscriptionRefundsCount#GET
      ✓ should count all refunds on subscription (54921ms)

  /api/user/subscriptions/subscription-refunds
    SubscriptionRefunds#GET
      ✓ should limit refunds on subscription to one page (57722ms)

  /api/user/subscriptions/subscription
    Subscription#GET
      ✓ should reject invalid subscriptionid (1573ms)
      ✓ should reject other account's subscription (13930ms)
      ✓ should return subscription data (9208ms)

  /api/user/subscriptions/subscriptions-count
    SubscriptionsCount#GET
      ✓ should count published subscriptions (14123ms)

  /api/user/subscriptions/subscriptions
    Subscriptions#GET
      ✓ should return subscription list (14040ms)

  /api/user/subscriptions/upcoming-invoice
    Upcominginvoice#GET
      ✓ should reject invalid subscriptionid (1557ms)
      ✓ should reject other account's subscription (14163ms)
      ✓ should return upcoming invoice for subscription (8964ms)

  /api/user/subscriptions/upcoming-invoices-count
    UpcominginvoicesCount#GET
      ✓ should count upcoming invoices (16357ms)

  /api/user/subscriptions/upcoming-invoices
    UpcomingInvoices#GET
      ✓ should return upcoming invoice for each subscription (13540ms)


  328 passing (2h)

