

  index
    STRIPE_JS
      Use client-side stripe.js in browser
        ✓ default unset
        ✓ Integer
    MAXIMUM_STRIPE_RETRIES
      Retry Stripe web requests
        ✓ default 0
        ✓ Integer
    SUBSCRIPTION_WEBHOOK_ENDPOINT_SECRET
      Secret provided by Stripe to sign webhooks
        ✓ String
    STRIPE_KEY
      The `sk_test_xxx` key from Stripe
        ✓ String
    STRIPE_PUBLISHABLE_KEY
      The `pk_test_xxx` key from Stripe
        ✓ String
    REQUIRE_SUBSCRIPTION
      Users must create subscription to access application
        ✓ default unset
        ✓ Boolean
    REQUIRE_PAYMENT
      Users must resolve unpaid invoices to access application
        ✓ default unset
        ✓ Boolean
    REQUIRE_PAYMENT_CONFIRMATION
      Users must resolve payment confirmations to access application
        ✓ default unset
        ✓ Boolean
    OVERDUE_INVOICE_THRESHOLD
      Duration in days to allow open invoices before enforcing payment
        ✓ default 1
        ✓ Integer
    START_SUBSCRIPTION_PATH
      Alternate URL path to your start subscription flow
        ✓ default /account/subscriptions/start-subscription
        ✓ String

  server/bind-stripekey
    after
      ✓ should bind data to req (68ms)

  server/require-payment-confirmation
    after
      ✓ should ignore guests
      ✓ should ignore user with pending confirmations requesting account pages (18593ms)
      ✓ should ignore administrators with pending confirmations requesting administration pages (6366ms)
      ✓ should ignore user without pending confirmation (6915ms)
      ✓ should require user confirm payment (6664ms)

  server/require-payment
    after
      ✓ should ignore guests
      ✓ should ignore user with amount owed requesting account pages (2607ms)
      ✓ should ignore administrator with amount owed requesting administration pages (2128ms)
      ✓ should ignore user without amount owed
      ✓ should ignore user with open but not overdue invoice (5756ms)
      ✓ should require user pay overdue invoice (5315ms)

  server/require-subscription
    after
      ✓ should ignore guests
      ✓ should ignore user without subscription requesting account pages
      ✓ should ignore administrator without subscription requesting administration pages
      ✓ should ignore user with active subscription (7911ms)
      ✓ should require user create subscription (55ms)

  /account/subscriptions/add-payment-method
    view
      ✓ should present the form for no stripe.js (3129ms)
      ✓ should present the form for stripe.js v3 (2262ms)
    submit
      ✓ should require name for no stripe.js (6150ms)
      ✓ should require CVC for no stripe.js (6234ms)
      ✓ should require card number for no stripe.js (5930ms)
      ✓ should require expiration month for no stripe.js (6281ms)
      ✓ should require expiration year for no stripe.js (6280ms)
      ✓ should add payment information no stripe.js (screenshots) (132770ms)
      ✓ should add payment information stripe.js v3 (21357ms)

  /account/subscriptions/billing-profile
    before
      ✓ should reject invalid customer (231ms)
      ✓ should reject other account's customer (243ms)
      ✓ should bind data to req (232ms)
    view
      ✓ should have row for customer (screenshots) (39497ms)

  /account/subscriptions/billing-profiles
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /account/subscriptions/cancel-subscription
    exceptions
      ✓ should reject missing subscription
      ✓ should reject invalid subscription
      ✓ should reject canceled subscription
      ✓ should reject other account's subscription
    before
      ✓ should bind data to req
    view
      ✓ should present the form
      ✓ should show fields for free plan cancelations
      ✓ should show fields for free trial cancelations
      ✓ should show fields for cancelation with credit or refund
    submit
      ✓ should cancel free subscription immediately (screenshots)
      ✓ should cancel free subscription at period end
      ✓ should cancel free trial immediately
      ✓ should cancel free trial at period end
      ✓ should cancel paid subscription and credit account
      ✓ should cancel paid subscription and show refund

  /account/subscriptions/change-plan
    before
      ✓ should bind data to req
    view
      ✓ should present the form
      ✓ should remove the form if there are no plans
    submit
      ✓ should apply plan update (screenshots)
    errors
      ✓ should reject paid plan without payment information

  /account/subscriptions/confirm-payment
    before
      ✓ should bind data to req (7670ms)
    view
      ✓ should display stripe.js confirmation

  /account/subscriptions/confirm-subscription
    exceptions
      ✓ invalid-planid (166ms)
      ✓ invalid-plan
    before
      ✓ should bind data to req
    view
      ✓ should present the form
    submit
      ✓ should start subscription (screenshots)
    errors
      ✓ invalid-paymentmethodid

  /account/subscriptions/create-billing-profile
    view
      ✓ should present the form for no stripe.js (702ms)
      ✓ should present the form for stripe.js v3 (1528ms)
    submit
      ✓ should require description for no stripe.js (6725ms)
      ✓ should require email for no stripe.js (6708ms)
      ✓ should require name for no stripe.js (6673ms)
      ✓ should require CVC for no stripe.js (7176ms)
      ✓ should require card number for no stripe.js (6663ms)
      ✓ should require expiration month for no stripe.js (6997ms)
      ✓ should require expiration year for no stripe.js (7189ms)
      ✓ should require description for stripe.js v3 (18875ms)
      ✓ should require email for stripe.js v3 (18571ms)
      ✓ should create billing profile for no stripe.js (8722ms)
      ✓ should create billing profile for stripe.js v3 (screenshots) (215381ms)

  /account/subscriptions/delete-billing-profile
    exceptions
      ✓ invalid-customerid
      ✓ invalid-account
    before
      ✓ should bind data to req
    view
      ✓ should present the form
    submit
      ✓ should delete billing profile (screenshots)

  /account/subscriptions
    before
      ✓ should bind data to req
    view
      ✓ should have row for each invoice
      ✓ should have row for each customer
      ✓ should have row for each subscription

  /account/subscriptions/invoice
    exceptions
      ✓ invalid-invoiceid
      ✓ invalid-account
    before
      ✓ should bind data to req
    view
      ✓ should have row for invoice (screenshots)

  /account/subscriptions/invoices
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /account/subscriptions/pay-invoice
    exceptions
      ✓ should reject invalid invoice
      ✓ invalid-account
      ✓ should reject paid invoice
    before
      ✓ should bind data to req
    view
      ✓ should present the form
    submit
      ✓ should pay invoice (screenshots)

  /account/subscriptions/plan
    before
      ✓ should reject invalid plan (181ms)
      ✓ should reject never published plan (925ms)
      ✓ should reject unpublished plan (964ms)
      ✓ should bind data to req (701ms)
    view
      ✓ should have row for plan (screenshots) (39609ms)

  /account/subscriptions/plans
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /account/subscriptions/refund-invoice
    exceptions
      ✓ invalid-invoiceid
      ✓ invalid-account
    before
      ✓ should bind data to req
    view
      ✓ should present the form
    submit
      ✓ should cancel subscription (screenshots)

  /account/subscriptions/refunds
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /account/subscriptions/request-refund
    exceptions
      ✓ invalid-invoice
      ✓ invalid-account
    before
      ✓ should bind data to req
    view
      ✓ should present the form
    submit
      ✓ should create refund request (screenshots)

  /account/subscriptions/subscription
    exceptions
      ✓ invalid-subscriptionid (648ms)
      ✓ invalid-account
    before
      ✓ should bind data to req
    view
      ✓ should present the subscription table (screenshots)

  /account/subscriptions/subscriptions
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /administrator/subscriptions/apply-customer-coupon
    exceptions
      ✓ should reject invalid customer (187ms)
      ✓ should reject customer with coupon (2091ms)
    before
      ✓ should bind data to req (902ms)
    view
      ✓ should present the form (1502ms)
    submit
      ✓ should apply coupon (screenshots) (72354ms)

  /administrator/subscriptions/apply-subscription-coupon
    exceptions
      ✓ should reject invalid subscription (171ms)
      ✓ should reject canceling subscription (8607ms)
      ✓ should reject free subscription (5454ms)
      ✓ should reject subscription with coupon (8759ms)
    before
      ✓ should bind data to req (7263ms)
    view
      ✓ should present the form (8540ms)
    submit
      ✓ should apply coupon (screenshots) (78146ms)

  /administrator/subscriptions/charge
    before
      ✓ should reject invalid charge (981ms)
      ✓ should bind data to req (7589ms)
    view
      ✓ should present the charge table (screenshots) (56054ms)

  /administrator/subscriptions/charges
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /administrator/subscriptions/coupon
    before
      ✓ should reject invalid coupon (163ms)
      ✓ should bind data to req (324ms)
    view
      ✓ should present the coupon table (screenshots) (45732ms)

  /administrator/subscriptions/coupons
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /administrator/subscriptions/create-coupon
    view
      ✓ should present the form (636ms)
    submit
      ✓ should reject missing couponid (1327ms)
      ✓ should enforce couponid length (2295ms)
      ✓ should reject duplicate couponid (2128ms)
      ✓ should reject missing duration (1756ms)
      ✓ should enforce invalid duration (1764ms)
      ✓ should require valid amount off (1829ms)
      ✓ should require valid percent off (1808ms)
      ✓ should require valid max redemptions (1790ms)
      ✓ should require amount or percent off (1602ms)
      ✓ should require valid duration in months if repeating (1955ms)
      ✓ should require valid redeem_by if provided (2102ms)
      ✓ should create coupon (screenshots) (58930ms)

  /administrator/subscriptions/create-plan
    view
      ✓ should present the form (851ms)
    submit
      ✓ should reject missing planid (1799ms)
      ✓ should enforce planid length (2769ms)
      ✓ should reject missing productid (1699ms)
      ✓ should reject never published product (2398ms)
      ✓ should reject unpublished product (2345ms)
      ✓ should reject missing currency (2159ms)
      ✓ should reject invalid currency (2146ms)
      ✓ should reject missing usage_type (2157ms)
      ✓ should reject missing amount (2189ms)
      ✓ should reject invalid amount (2126ms)
      ✓ should reject missing interval (2123ms)
      ✓ should reject invalid interval (2121ms)
      ✓ should reject invalid interval_count (2128ms)
      ✓ should reject invalid trial_period_days (2220ms)
      ✓ should create plan (screenshots) (59558ms)

  /administrator/subscriptions/create-product
    view
      ✓ should present the form (508ms)
    submit
      ✓ should reject missing name (1332ms)
      ✓ should enforce name length (2270ms)
      ✓ should reject missing statement_descriptor (1282ms)
      ✓ should create product (screenshots) (59285ms)

  /administrator/subscriptions/customer
    before
      ✓ should reject invalid customer (448ms)
      ✓ should bind data to req (271ms)
    view
      ✓ should present the customer table (screenshots) (39298ms)

  /administrator/subscriptions/customers
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /administrator/subscriptions/delete-coupon
    exceptions
      ✓ should reject invalid couponid (183ms)
    before
      ✓ should bind data to req (527ms)
    view
      ✓ should present the form (823ms)
    submit
      ✓ should delete coupon (screenshots) (70797ms)

  /administrator/subscriptions/delete-plan
    exceptions
      ✓ should reject invalid planid (168ms)
    before
      ✓ should bind data to req (702ms)
    view
      ✓ should present the form (1173ms)
    submit
      ✓ should delete plan (screenshots) (71058ms)

  /administrator/subscriptions/delete-product
    exceptions
      ✓ should reject invalid productid (158ms)
    before
      ✓ should bind data to req (334ms)
    view
      ✓ should present the form (808ms)
    submit
      ✓ should delete product (screenshots) (67851ms)

  /administrator/subscriptions/delete-subscription
    exceptions
      ✓ should reject missing subscription
      ✓ should reject invalid subscription
      ✓ should reject canceled subscription
    before
      ✓ should bind data to req
    view
      ✓ should present the form
      ✓ should show fields for free plan cancelations
      ✓ should show fields for free trial cancelations
      ✓ should show fields for cancelation with credit or refund
    submit
      ✓ should cancel free subscription immediately (screenshots) (5149ms)
      ✓ should cancel free subscription at period end
      ✓ should cancel free trial immediately
      ✓ should cancel free trial at period end
      ✓ should cancel paid subscription and credit account
      ✓ should cancel paid subscription and show refund

  /administrator/subscriptions/deny-refund
    exceptions
      ✓ should reject invalid chargeid (174ms)
      ✓ should reject charge without refund request (7493ms)
      ✓ should reject denied refund (7822ms)
    before
      ✓ should bind data to req (7725ms)
    view
      ✓ should present the form (9016ms)
    submit
      ✓ should deny refund (screenshots) (90374ms)

  /administrator/subscriptions/edit-coupon
    before
      ✓ should reject invalid couponid
      ✓ should reject unpublished coupon (545ms)
      ✓ should bind data to req (327ms)
    view
      ✓ should present the form (870ms)
    submit
      ✓ should reject missing name (1645ms)
      ✓ should update coupon (screenshots) (71453ms)

  /administrator/subscriptions/edit-plan
    before
      ✓ should reject invalid planid (170ms)
      ✓ should reject unpublished plan (923ms)
      ✓ should bind data to req (1012ms)
    view
      ✓ should present the form (1346ms)
    submit
      ✓ should reject missing productid (2040ms)
      ✓ should reject invalid trial period (2575ms)
      ✓ should update plan (screenshots) (74422ms)

  /administrator/subscriptions/edit-product
    before
      ✓ should reject invalid productid (171ms)
      ✓ should reject unpublished product (539ms)
      ✓ should bind data to req (510ms)
    view
      ✓ should present the form (884ms)
    submit
      ✓ should reject missing name (1614ms)
      ✓ should enforce name length (2564ms)
      ✓ should reject missing statement_descriptor (1539ms)
      ✓ should reject invalid unit_label (2240ms)
      ✓ should update product (screenshots) (77270ms)

  /administrator/subscriptions/flag-charge
    exceptions
      ✓ should reject invalid chargeid (166ms)
      ✓ should reject flagged charge
    before
      ✓ should bind data to req
    view
      ✓ should present the form
    submit
      ✓ should flag charge (screenshots)

  /administrator/subscriptions/forgive-invoice
    exceptions
      ✓ should reject invalid invoiceid (164ms)
      ✓ should reject paid invoice (7914ms)
      ✓ should reject uncollectible invoice (2795ms)
    before
      ✓ should bind data to req (2357ms)
    view
      ✓ should present the form (4052ms)
    submit
      ✓ should forgive invoice (screenshots) (68372ms)

  /administrator/subscriptions
    before
      ✓ should bind data to req (8281ms)
    view
      ✓ should have row for each plan (1708ms)
      ✓ should have row for each coupon (1152ms)
      ✓ should have row for each subscription (screenshots) (33321ms)

  /administrator/subscriptions/invoice
    before
      ✓ should reject invalid invoiceid (144ms)
      ✓ should bind data to req (8531ms)
    view
      ✓ should present the invoice table (screenshots) (54609ms)

  /administrator/subscriptions/invoices
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /administrator/subscriptions/payment-intent
    before
      ✓ should reject invalid paymentintentid
      ✓ should bind data to req (1818ms)
    view
      ✓ should have row for payment intent (screenshots) (47367ms)

  /administrator/subscriptions/payment-intents
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /administrator/subscriptions/payment-method
    before
      ✓ should reject invalid paymentmethodid
      ✓ should bind data to req (1987ms)
    view
      ✓ should have row for payment method (screenshots) (47109ms)

  /administrator/subscriptions/payment-methods
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /administrator/subscriptions/payout
    before
      ✓ should reject invalid payoutid (165ms)

  /administrator/subscriptions/plan
    before
      ✓ should reject invalid planid (169ms)
      ✓ should bind data to req (835ms)
    view
      ✓ should present the plan table (screenshots) (45956ms)

  /administrator/subscriptions/plans
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /administrator/subscriptions/product
    before
      ✓ should reject invalid productid (159ms)
      ✓ should bind data to req (318ms)
    view
      ✓ should have row for product (screenshots) (43696ms)

  /administrator/subscriptions/products
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /administrator/subscriptions/publish-coupon
    exceptions
      ✓ should reject invalid couponid (174ms)
      ✓ should reject published coupon (329ms)
    before
      ✓ should bind data to req (354ms)
    view
      ✓ should present the form (801ms)
    submit
      ✓ should publish coupon (screenshots) (69448ms)

  /administrator/subscriptions/publish-plan
    exceptions
      ✓ should reject invalid planid (165ms)
      ✓ should reject published plan (853ms)
    before
      ✓ should bind data to req (699ms)
    view
      ✓ should present the form (1142ms)
    submit
      ✓ should publish plan (screenshots) (69269ms)

  /administrator/subscriptions/publish-product
    exceptions
      ✓ should reject invalid productid (164ms)
      ✓ should reject published product (342ms)
    before
      ✓ should bind data to req (336ms)
    view
      ✓ should present the form (806ms)
    submit
      ✓ should publish product (screenshots) (66258ms)

  /administrator/subscriptions/refund-charge
    exceptions
      ✓ should reject invalid chargeid (165ms)
      ✓ should reject refunded charge
    before
      ✓ should bind data to req
    view
      ✓ should present the form
    submit
      ✓ should refund charge (screenshots)

  /administrator/subscriptions/refund-requests
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /administrator/subscriptions/refund
    before
      ✓ should reject invalid refundid (183ms)
      ✓ should bind data to req (10043ms)
    view
      ✓ should have row for refund (screenshots) (55039ms)

  /administrator/subscriptions/refunds
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /administrator/subscriptions/revoke-customer-coupon
    exceptions
      ✓ should reject invalid customer (170ms)
      ✓ should reject customer without discount (1019ms)
    before
      ✓ should bind data to req (1392ms)
    view
      ✓ should present the form (2167ms)
    submit
      ✓ should remove coupon (screenshots) (65527ms)

  /administrator/subscriptions/revoke-subscription-coupon
    exceptions
      ✓ should reject invalid subscription (167ms)
      ✓ should reject subscription without discount (7890ms)
    before
      ✓ should bind data to req (8641ms)
    view
      ✓ should present the form (11643ms)
    submit
      ✓ should remove coupon (screenshots) (78299ms)

  /administrator/subscriptions/setup-intent
    before
      ✓ should reject invalid setupintentid
      ✓ should bind data to req (3289ms)
    view
      ✓ should have row for setup intent (screenshots) (48998ms)

  /administrator/subscriptions/setup-intents
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /administrator/subscriptions/subscription
    before
      ✓ should reject invalid subscriptionid (153ms)
      ✓ should bind data to req (7357ms)
    view
      ✓ should present the subscription table (screenshots) (51456ms)

  /administrator/subscriptions/subscriptions
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /administrator/subscriptions/unpublish-coupon
    exceptions
      ✓ should reject invalid couponid (153ms)
      ✓ should reject never published coupon (348ms)
      ✓ should reject unpublished coupon (731ms)
    before
      ✓ should bind data to req (339ms)
    view
      ✓ should present the form (814ms)
    submit
      ✓ should unpublish coupon (screenshots) (69235ms)

  /administrator/subscriptions/unpublish-plan
    exceptions
      ✓ should reject invalid planid (161ms)
      ✓ should never published plan (688ms)
      ✓ should reject unpublished plan (874ms)
    before
      ✓ should bind data to req (707ms)
    view
      ✓ should present the form (1204ms)
    submit
      ✓ should unpublish plan (screenshots) (69862ms)

  /administrator/subscriptions/unpublish-product
    exceptions
      ✓ should reject invalid productid (147ms)
      ✓ should never published product (350ms)
      ✓ should reject unpublished product (537ms)
    before
      ✓ should bind data to req (327ms)
    view
      ✓ should present the form (807ms)
    submit
      ✓ should unpublish product (screenshots) (66690ms)

  /api/administrator/subscriptions/charge
    exceptions
      invalid-chargeid
        ✓ missing querystring chargeid
        ✓ invalid querystring chargeid (185ms)
    returns
      ✓ object (7831ms)

  /api/administrator/subscriptions/charges-count
    returns
      ✓ integer (25691ms)

  /api/administrator/subscriptions/charges
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/administrator/subscriptions/coupon
    exceptions
      invalid-couponid
        ✓ missing querystring couponid
        ✓ invalid querystring couponid (173ms)
    returns
      ✓ object (344ms)

  /api/administrator/subscriptions/coupons-count
    returns
      ✓ integer (574ms)

  /api/administrator/subscriptions/coupons
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/administrator/subscriptions/create-cancelation-refund
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid (158ms)
      invalid-subscription
        ✓ ineligible querystring subscription is not active (9018ms)
    returns
      ✓ object (8579ms)

  /api/administrator/subscriptions/create-coupon
    exceptions
      invalid-couponid
        ✓ missing posted couponid
        ✓ invalid posted couponid is not alphanumeric_
      invalid-amount_off
        ✓ missing posted amount_off
        ✓ invalid posted amount_off
      invalid-currency
        ✓ missing posted currency
        ✓ invalid posted currency
      invalid-percent_off
        ✓ invalid posted percent_off
      invalid-duration
        ✓ invalid posted duration
      invalid-duration_in_months
        ✓ missing posted duration_in_months
        ✓ invalid posted duration_in_months
      invalid-redeem_by_meridiem
        ✓ invalid posted redeem_by_meridiem
      invalid-redeem_by
        ✓ invalid posted redeem_by
    receives
      ✓ required posted duration
      ✓ optionally-required posted amount_off (integer, or percent_off)
      ✓ optionally-required posted currency (string, if amount_off)
      ✓ optionally-required posted percent_off (integer, or amount_off)
      ✓ optionally-required posted expire date 
      ✓ optionally-required posted duration_in_months
    returns
      ✓ object (215ms)

  /api/administrator/subscriptions/create-plan
    exceptions
      invalid-planid
        ✓ invalid posted planid is not alphanumeric_ (370ms)
      invalid-planid-length
        ✓ posted planid is too short (377ms)
        ✓ posted planid is too long (183ms)
      invalid-productid
        ✓ missing posted productid (189ms)
        ✓ invalid posted productid (348ms)
      invalid-product
        ✓ ineligible posted product is not published (310ms)
      invalid-amount
        ✓ missing posted amount (326ms)
        ✓ invalid posted amount (312ms)
      invalid-currency
        ✓ missing posted currency (188ms)
        ✓ invalid posted currency (435ms)
      invalid-interval
        ✓ missing posted interval (354ms)
        ✓ invalid posted interval (323ms)
      invalid-interval-count
        ✓ missing posted interval_count (302ms)
        ✓ invalid posted interval_count (324ms)
      invalid-trial_period
        ✓ invalid posted trial_period (319ms)
      invalid-usage_type
        ✓ invalid posted usage_type (336ms)
    receives
      ✓ optional posted published (boolean) (534ms)
      ✓ optional posted trial_period_days (integer) (543ms)
      ✓ optional posted usage_type (licensed|metered) (515ms)
    returns
      ✓ object (574ms)
    configuration
      ✓ environment MINIMUM_PLANID_LENGTH (184ms)
      ✓ environment MAXIMUM_PLANID_LENGTH (208ms)

  /api/administrator/subscriptions/create-product
    exceptions
      invalid-name
        ✓ missing posted name
      invalid-product-name-length
        ✓ posted name too short
        ✓ posted name too long
      invalid-statement_descriptor
        ✓ missing posted statement_descriptor
    receives
      ✓ optional posted published (boolean) (378ms)
    returns
      ✓ object (361ms)
    configuration
      ✓ environment MINIMUM_PRODUCT_NAME_LENGTH
      ✓ environment MAXIMUM_PRODUCT_NAME_LENGTH

  /api/administrator/subscriptions/create-refund
    exceptions
      invalid-chargeid
        ✓ missing querystring chargeid (44ms)
        ✓ invalid querystring chargeid (182ms)
      invalid-amount
        ✓ missing posted amount
        ✓ invalid posted amount
        ✓ invalid posted amount is negative
        ✓ invalid posted amount exceeds charge
    returns
      ✓ object

  /api/administrator/subscriptions/customer
    exceptions
      invalid-customerid
        ✓ missing querystring customerid
        ✓ invalid querystring customerid (193ms)
    returns
      ✓ object (3320ms)

  /api/administrator/subscriptions/customers-count
    returns
      ✓ integer (467ms)

  /api/administrator/subscriptions/customers
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/administrator/subscriptions/delete-coupon
    exceptions
      invalid-couponid
        ✓ missing querystring couponid
        ✓ invalid querystring couponid (155ms)
    returns
      ✓ boolean (516ms)

  /api/administrator/subscriptions/delete-plan
    exceptions
      invalid-planid
        ✓ missing querystring planid
        ✓ invalid querystring planid (174ms)
    returns
      ✓ boolean (1125ms)

  /api/administrator/subscriptions/delete-product
    exceptions
      invalid-productid
        ✓ missing querystring productid
        ✓ invalid querystring productid (162ms)
    returns
      ✓ boolean (534ms)

  /api/administrator/subscriptions/delete-subscription
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid (150ms)
      invalid-subscription
        ✓ ineligible querystring subscription is not active (8191ms)
    returns
      ✓ boolean (8058ms)

  /api/administrator/subscriptions/invoice
    exceptions
      invalid-invoiceid
        ✓ missing querystring invoiceid
        ✓ invalid querystring invoiceid (145ms)
    returns
      ✓ object (7483ms)

  /api/administrator/subscriptions/invoices-count
    returns
      ✓ integer (35049ms)

  /api/administrator/subscriptions/invoices
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/administrator/subscriptions/payment-intent
    exceptions
      invalid-paymentintentid
        ✓ missing querystring paymentintentid
        ✓ invalid querystring paymentintentid
    returns
      ✓ object (1960ms)

  /api/administrator/subscriptions/payment-intents-count
    returns
      ✓ integer (6099ms)

  /api/administrator/subscriptions/payment-intents
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/administrator/subscriptions/payment-method
    exceptions
      invalid-paymentmethodid
        ✓ missing querystring paymentmethodid
        ✓ invalid querystring paymentmethodid
    returns
      ✓ object (1845ms)

  /api/administrator/subscriptions/payment-methods-count
    returns
      ✓ integer (4840ms)

  /api/administrator/subscriptions/payment-methods
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/administrator/subscriptions/plan
    exceptions
      invalid-planid
        ✓ missing querystring planid
        ✓ invalid querystring planid (174ms)
    returns
      ✓ object (715ms)

  /api/administrator/subscriptions/plans-count
    returns
      ✓ integer (1641ms)

  /api/administrator/subscriptions/plans
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/administrator/subscriptions/product
    exceptions
      invalid-productid
        ✓ missing querystring productid
        ✓ invalid querystring productid (149ms)
    returns
      ✓ object (340ms)

  /api/administrator/subscriptions/products-count
    returns
      ✓ integer (561ms)

  /api/administrator/subscriptions/products
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/administrator/subscriptions/refund-requests-count
    returns
      ✓ integer (25651ms)

  /api/administrator/subscriptions/refund-requests
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/administrator/subscriptions/refund
    exceptions
      ✓ invalid querystring refundid
      ✓ missing querystring refundid (162ms)
    returns
      ✓ object (9720ms)

  /api/administrator/subscriptions/refunds-count
    returns
      ✓ integer (31431ms)

  /api/administrator/subscriptions/refunds
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/administrator/subscriptions/reset-customer-coupon
    exceptions
      invalid-customerid
        ✓ missing querystring customerid
        ✓ invalid querystring customerid (154ms)
      invalid-customeir
        ✓ invalid querystring customer has no discount (261ms)
    receives
      ✓ object (1148ms)

  /api/administrator/subscriptions/reset-subscription-coupon
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid (166ms)
      invalid-subscription
        ✓ ineligible querystring subscription has no discount (6925ms)
    returns
      ✓ object (9381ms)

  /api/administrator/subscriptions/set-charge-flagged
    exceptions
      invalid-chargeid
        ✓ missing querystring charge
        ✓ invalid querystring charge (164ms)
      invalid-charge
        ✓ ineligible querystring charge is already flagged (9024ms)
    returns
      ✓ object (7818ms)

  /api/administrator/subscriptions/set-coupon-published
    exceptions
      invalid-couponid
        ✓ missing querystring couponid
        ✓ invalid querystring couponid (156ms)
      invalid-coupon
        ✓ ineligible querystring coupon is published (336ms)
        ✓ ineligible querystring coupon is unpublished (364ms)
    returns
      ✓ object (554ms)

  /api/administrator/subscriptions/set-coupon-unpublished
    exceptions
      invalid-couponid
        ✓ missing querystring couponid
        ✓ invalid querystring couponid (158ms)
      invalid-coupon
        ✓ ineligible querystring coupon is not published (540ms)
        ✓ ineligible querystring coupon is already unpublished (530ms)
    returns
      ✓ object (568ms)

  /api/administrator/subscriptions/set-invoice-uncollectible
    exceptions
      invalid-invoiceid
        ✓ missing querystring invoiceid (159ms)
        ✓ invalid querystring invoiceid (181ms)
      invalid-invoice
        ✓ invalid querystring invoice is paid (7082ms)
        ✓ invalid querystring invoice is marked uncollectable (4493ms)
    returns
      ✓ object (4822ms)

  /api/administrator/subscriptions/set-plan-published
    exceptions
      invalid-planid
        ✓ missing querystring planid
        ✓ invalid querystring planid (160ms)
      invalid-plan
        ✓ ineligible querystring plan is published (696ms)
    returns
      ✓ object (974ms)

  /api/administrator/subscriptions/set-plan-unpublished
    exceptions
      invalid-planid
        ✓ missing querystring planid
        ✓ invalid querystring planid (193ms)
      invalid-plan
        ✓ ineligible querystring plan is not published (921ms)
        ✓ ineligible querystring plan is already unpublished (934ms)
    returns
      ✓ object (895ms)

  /api/administrator/subscriptions/set-product-published
    exceptions
      invalid-productid
        ✓ missing querystring productid (351ms)
        ✓ invalid querystring productid (344ms)
      invalid-product
        ✓ invalid querystring product is already published (327ms)
    returns
      ✓ object (550ms)

  /api/administrator/subscriptions/set-product-unpublished
    exceptions
      invalid-productid
        ✓ missing querystring productid (364ms)
        ✓ invalid querystring productid (323ms)
      invalid-product
        ✓ ineligible querystring product is not published (334ms)
        ✓ ineligible querystring product is already unpublished (528ms)
    returns
      ✓ object (507ms)

  /api/administrator/subscriptions/set-refund-request-denied
    exceptions
      invalid-chargeid
        ✓ missing querystring chargeid
        ✓ invalid querystring chargeid (165ms)
      invalid-charge
        ✓ ineligible querystring charge has no refund request (8554ms)
        ✓ ineligible querystring charge has denied request already (8361ms)
    returns
      ✓ object (7803ms)

  /api/administrator/subscriptions/set-subscription-canceled
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid (196ms)
      invalid-subscription
        ✓ ineligible querystring subscription is not active (8777ms)
    returns
      ✓ object (8363ms)

  /api/administrator/subscriptions/set-subscription-coupon
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid
      invalid-subscription
        ✓ ineligible subscription is canceling (8605ms)
        ✓ ineligible subscription has coupon (8716ms)
      invalid-couponid
        ✓ missing posted couponid (7460ms)
        ✓ invalid posted couponid (7684ms)
      invalid-coupon
        ✓ ineligible posted coupon is not published (7755ms)
        ✓ ineligible posted coupon is unpublished (7649ms)
    returns
      ✓ object (8500ms)

  /api/administrator/subscriptions/setup-intent
    exceptions
      invalid-setupintentid
        ✓ missing querystring setupintentid
        ✓ invalid querystring setupintentid
    returns
      ✓ object (2753ms)

  /api/administrator/subscriptions/setup-intents-count
    returns
      ✓ integer (4799ms)

  /api/administrator/subscriptions/setup-intents
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/administrator/subscriptions/subscription
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid (154ms)
    returns
      ✓ object (7387ms)

  /api/administrator/subscriptions/subscriptions-count
    returns
      ✓ integer (26568ms)

  /api/administrator/subscriptions/subscriptions
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/administrator/subscriptions/update-coupon
    exceptions
      invalid-couponid
        ✓ missing querystring couponid
        ✓ invalid querystring couponid (160ms)
      invalid-coupon
        ✓ ineligible querystring coupon is unpublished (536ms)
      invalid-name
        ✓ missing posted name (340ms)
        ✓ invalid posted name (319ms)
    receives
      ✓ required posted name (505ms)
    returns
      ✓ object (588ms)

  /api/administrator/subscriptions/update-plan
    exceptions
      invalid-planid
        ✓ missing querystring planid
        ✓ invalid querystring planid (163ms)
      invalid-plan
        ✓ ineligible querystring plan is unpublished (1065ms)
      invalid-productid
        ✓ invalid posted productid (816ms)
      invalid-product
        ✓ ineligible posted product is not published (983ms)
        ✓ ineligible posted product is unpublished (1147ms)
      invalid-trial_period_days
        ✓ invalid posted trial_period_days (992ms)
        ✓ ineligible posted trial_period_days is negative (1157ms)
        ✓ ineligible posted trial_period_days greater than 365 (949ms)
    receives
      ✓ optional posted trial_period_days (integer) (956ms)
    returns
      ✓ object (1434ms)

  /api/administrator/subscriptions/update-product
    exceptions
      invalid-productid
        ✓ missing querystring productid (209ms)
        ✓ invalid querystring productid (496ms)
      invalid-product
        ✓ ineligible querystring product is unpublished (570ms)
      invalid-name
        ✓ invalid posted name (330ms)
      invalid-name-length
        ✓ posted name too short (531ms)
        ✓ posted name too long (342ms)
      invalid-statement_descriptor
        ✓ invalid posted statement_descriptor (336ms)
      invalid-statement_descriptor-length
        ✓ posted statement_descriptor too short (332ms)
        ✓ posted statement_descriptor too long (326ms)
      invalid-unit_label
        ✓ missing posted unit_label (334ms)
    receives
      ✓ optional posted name (527ms)
      ✓ optional posted statement_descriptor (491ms)
      ✓ optional posted unit_label (499ms)
    returns
      ✓ object (675ms)
    configuration
      ✓ environment MINIMUM_PRODUCT_NAME_LENGTH (314ms)
      ✓ environment MAXIMUM_PRODUCT_NAME_LENGTH (330ms)

  /api/administrator/subscriptions/usage-record-summaries
    exceptions
      invalid-subscriptionitemid
        ✓ missing querystring subscriptionitemid
        ✓ invalid querystring subscriptionitemid
    receives
      ✓ optional querystring starting_after (string)
      ✓ optional querystring ending_before (string)
      ✓ optional querystring limit (integer)
    returns
      ✓ stripe list response
    configuration
      ✓ environment PAGE_SIZE

  /api/user/subscriptions/charge
    exceptions
      invalid-chargeid
        ✓ missing querystring chargeid
        ✓ invalid querystring chargeid
      invalid-account
        ✓ ineligible accessing account (13294ms)
    returns
      ✓ object (7541ms)

  /api/user/subscriptions/charges-count
    returns
      ✓ integer (15297ms)

  /api/user/subscriptions/charges
    exceptions
      invalid-accountid
        ✓ missing querystring accountid
        ✓ invalid querystring accountid
      invalid-account
        ✓ ineligible accessing account (41ms)
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/user/subscriptions/create-cancelation-refund
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid
      invalid-account
        ✓ ineligible accessing account (8869ms)
      invalid-subscription
        ✓ ineligible querystring subscription is not active (8509ms)
        ✓ ineligible querystring subscription is free (6496ms)
        ✓ ineligible querystring subscription is in free trial (6418ms)
    returns
      ✓ object (8632ms)

  /api/user/subscriptions/create-customer
    exceptions
      invalid-accountid
        ✓ missing querystring accountid
        ✓ invalid querystring accountid
      invalid-account
        ✓ ineligible accessing account (39ms)
    returns
      ✓ object (217ms)

  /api/user/subscriptions/create-payment-intent
    exceptions
      invalid-customerid
        ✓ missing querystring customerid
        ✓ invalid querystring customerid
      invalid-account
        ✓ ineligible accessing account (1523ms)
        ✓ ineligible posted payment method (1829ms)
      invalid-paymentmethodid
        ✓ missing posted paymentmethodid (224ms)
        ✓ invalid posted paymentmethodid (228ms)
    object
      ✓ object (1924ms)

  /api/user/subscriptions/create-payment-method
    exceptions
      invalid-customerid
        ✓ missing querystring customerid
        ✓ invalid querystring customerid
      invalid-account
        ✓ ineligible accessing account (234ms)
    receives
      ✓ optionally-required posted name (215ms)
      ✓ optionally-required posted cvc (212ms)
      ✓ optionally-required posted number (233ms)
      ✓ optionally-required posted exp_month (241ms)
      ✓ optionally-required posted exp_year (231ms)
      ✓ optionally-required posted token (426ms)
    returns
      ✓ object (1697ms)
    configuration
      ✓ environment STRIPE_JS (225ms)

  /api/user/subscriptions/create-refund-request
    exceptions
      invalid-chargeid
        ✓ missing querystring chargeid
        ✓ invalid querystring chargeid
      invalid-charge
        ✓ ineligible querystring charge is refunded (8368ms)
        ✓ ineligible querystring charge has refund request (8002ms)
      invalid-account
        ✓ ineligible accessing account (7281ms)
    returns
      ✓ object (8136ms)

  /api/user/subscriptions/create-refund
    exceptions
      invalid-chargeid
        ✓ missing querystring chargeid
        ✓ invalid querystring chargeid
      invalid-charge
        ✓ ineligible querystring charge is refunded (9218ms)
        ✓ ineligible querystring charge is out of refund period (7048ms)
      invalid-account
        ✓ ineligible accessing account (7682ms)
    returns
      ✓ object (9070ms)
    configuration
      ✓ environment SUBSCRIPTION_REFUND_PERIOD (8661ms)

  /api/user/subscriptions/create-setup-intent
    exceptions
      invalid-customerid
        ✓ missing querystring customerid
        ✓ invalid querystring customerid
      invalid-account
        ✓ ineligible accessing account (1823ms)
      invalid-paymentmethodid
        ✓ missing posted paymentmethodid (207ms)
        ✓ invalid posted paymentmethodid (238ms)
    returns
      ✓ object (1820ms)

  /api/user/subscriptions/create-subscription
    exceptions
      invalid-customerid
        ✓ missing querystring customerid (605ms)
        ✓ invalid querystring customerid (699ms)
      invalid-customer
        ✓ ineligible querystring customer requires payment method (895ms)
      invalid-account
        ✓ ineligible accessing account (967ms)
      invalid-planid
        ✓ missing posted planid (2032ms)
        ✓ invalid posted planid (2287ms)
      invalid-plan
        ✓ ineligible posted plan is not published (2408ms)
        ✓ ineligible posted plan is unpublished (2682ms)
    returns
      ✓ object (4100ms)

  /api/user/subscriptions/create-usage-record
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid
      invalid-subscription
        ✓ invalid querystring subscription is not "metered" (7485ms)
      invalid-account
        ✓ ineligible accessing account (6096ms)
      invalid-quantity
        ✓ invalid posted quantity is not integer (5824ms)
        ✓ invalid posted quantity is negative (5383ms)
      invalid-action
        ✓ missing posted action (5026ms)
        ✓ invalid posted action (5643ms)
      invalid-subscriptionitemid
        ✓ missing posted subscriptionitemid (5854ms)
        ✓ invalid posted subscriptionitemid (6064ms)
    receives
      ✓ required posted quantity (6753ms)
      ✓ required posted action (5360ms)
      ✓ required posted subscriptionitemid (5418ms)
    returns
      ✓ object (6329ms)

  /api/user/subscriptions/customer
    exceptions
      invalid-customerid
        ✓ missing querystring customerid
        ✓ invalid querystring customerid
      invalid-account
        ✓ ineligible accessing account (1498ms)
    returns
      ✓ object (1586ms)

  /api/user/subscriptions/customers
    exceptions
      invalid-accountid
        ✓ missing querystring accountid
        ✓ invalid querystring accountid
      invalid-account
        ✓ ineligible accessing account (41ms)
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/user/subscriptions/delete-customer
    exceptions
      invalid-customerid
        ✓ missing querystring customerid
        ✓ invalid querystring customerid
      invalid-account
        ✓ ineligible accessing account (307ms)
    returns
      ✓ boolean (443ms)

  /api/user/subscriptions/delete-subscription
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid
      invalid-account
        ✓ ineligible accessing account (7272ms)
      invalid-subscription
        ✓ ineligible querystring subscription is not active (9336ms)
    returns
      ✓ boolean (8700ms)

  /api/user/subscriptions/invoice
    exceptions
      invalid-invoiceid
        ✓ missing querystring invoiceid
        ✓ invalid querystring invoiceid
      invalid-account
        ✓ ineligible accessing account (8148ms)
    returns
      ✓ object (8231ms)

  /api/user/subscriptions/invoices-count
    returns
      ✓ integer (19429ms)

  /api/user/subscriptions/invoices
    exceptions
      invalid-accountid
        ✓ missing querystring accountid
        ✓ invalid querystring accountid
      invalid-account
        ✓ ineligible accessing account (46ms)
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/user/subscriptions/payment-intent
    exceptions
      invalid-paymentintentid
        ✓ missing querystring invalid
        ✓ invalid querystring invalid
      invalid-account
        ✓ ineligible accessing account (1997ms)
    returns
      ✓ object (2143ms)

  /api/user/subscriptions/payment-intents-count
    returns
      ✓ integer (7624ms)

  /api/user/subscriptions/payment-intents
    exceptions
      invalid-accountid
        ✓ missing querystring accountid
        ✓ invalid querystring accountid
      invalid-account
        ✓ ineligible accessing account (44ms)
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/user/subscriptions/payment-method
    exceptions
      invalid-paymentmethodid
        ✓ missing querystring paymentmethodid
        ✓ invalid querystring paymentmethodid
      invalid-account
        ✓ ineligible accessing account (1849ms)
    returns
      ✓ object (1762ms)

  /api/user/subscriptions/payment-methods-count
    returns
      ✓ integer (4813ms)

  /api/user/subscriptions/payment-methods
    exceptions
      invalid-accountid
        ✓ missing querystring accountid
        ✓ invalid querystring accountid
      invalid-account
        ✓ ineligible accessing account (52ms)
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/user/subscriptions/published-plan
    exceptions
      invalid-planid
        ✓ missing querystring planid
        ✓ invalid querystring planid (140ms)
      invalid-plan
        ✓ ineligible querystring plan is not published (887ms)
    returns
      ✓ object (762ms)

  /api/user/subscriptions/published-plans-count
    returns
      ✓ integer (1155ms)

  /api/user/subscriptions/published-plans
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/user/subscriptions/published-product
    exceptions
      invalid-productid
        ✓ missing querystring productid
        ✓ invalid querystring productid (145ms)
      invalid-product
        ✓ ineligible querystring product is not published (350ms)
    returns
      ✓ object (348ms)

  /api/user/subscriptions/published-products-count
    returns
      ✓ integer (361ms)

  /api/user/subscriptions/published-products
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/user/subscriptions/refund
    exceptions
      invalid-refundid
        ✓ missing querystring refundid (824ms)
        ✓ invalid querystring refundid (629ms)
      invalid-account
        ✓ ineligible accessing account (10723ms)
    returns
      ✓ object (10270ms)

  /api/user/subscriptions/refunds-count
    returns
      ✓ integer (26905ms)

  /api/user/subscriptions/refunds
    exceptions
      invalid-accountid
        ✓ missing querystring accountid
        ✓ invalid querystring accountid
      invalid-account
        ✓ ineligible accessing account (40ms)
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/user/subscriptions/reset-subscription-canceling
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid
      invalid-subscription
        ✓ invalid querystring subscription is active (7966ms)
      invalid-account
        ✓ ineligible accessing account (9076ms)
    returns
      ✓ object (8930ms)

  /api/user/subscriptions/set-customer-coupon
    exceptions
      invalid-customerid
        ✓ missing querystring customerid (247ms)
        ✓ invalid querystring customerid (238ms)
      invalid-customer
        ✓ invalid querystring customer has coupon (1223ms)
      invalid-account
        ✓ ineligible account accessing (458ms)
      invalid-couponid
        ✓ missing posted couponid (242ms)
        ✓ invalid posted couponid (233ms)
      invalid-coupon
        ✓ invalid posted coupon is not published (568ms)
        ✓ invalid posted coupon is unpublished (808ms)
    returns
      ✓ object (843ms)

  /api/user/subscriptions/set-invoice-paid
    exceptions
      invalid-invoiceid
        ✓ missing querystring invoiceid
        ✓ invalid querystring invoiceid
      invalid-account
        ✓ ineligible accessing account (2073ms)
        ✓ ineligible posted payment method (8171ms)
      invalid-invoice
        ✓ invalid querystring invoice is paid (7124ms)
        ✓ invalid querystring invoice is marked uncollectable (5142ms)
      invalid-paymentmethodid
        ✓ missing posted paymentmethodid (2399ms)
        ✓ invalid posted paymentmethodid (3105ms)
    returns
      ✓ object (5896ms)

  /api/user/subscriptions/set-payment-intent-canceled
    exceptions
      invalid-paymentintentid
        ✓ missing querystring paymentintentid
        ✓ invalid querystring paymentintentid
      invalid-account
        ✓ ineligible accessing account (1881ms)
    returns
      ✓ object (2173ms)

  /api/user/subscriptions/set-payment-method-detached
    exceptions
      invalid-paymentmethodid
        ✓ missing querystring paymentmethodid
        ✓ invalid querystring paymentmethodid
      invalid-account
        ✓ ineligible accessing account (2025ms)
      invalid-paymentmethod
        ✓ invalid querystring payment method is default (1749ms)
    returns
      ✓ object (3321ms)

  /api/user/subscriptions/set-setup-intent-canceled
    exceptions
      invalid-setupintentid
        ✓ missing querystring setupintentid
        ✓ invalid querystring setupintentid
      invalid-account
        ✓ ineligible accessing account (2680ms)
    returns
      ✓ object (3546ms)

  /api/user/subscriptions/set-subscription-canceled
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid (62ms)
      invalid-account
        ✓ ineligible accessing account (7213ms)
      invalid-subscription
        ✓ ineligible querystring subscription is not active (8282ms)
    returns
      ✓ object (8312ms)

  /api/user/subscriptions/set-subscription-coupon
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid
      invalid-subscription
        ✓ invalid querystring subscription has coupon (7928ms)
        ✓ invalid querystring subscription is canceling (8816ms)
      invalid-account
        ✓ ineligible accessing account (7230ms)
      invalid-couponid
        ✓ missing posted couponid (7084ms)
        ✓ invalid posted couponid (7454ms)
      invalid-coupon
        ✓ invalid posted coupon is not published (9772ms)
        ✓ invalid posted coupon is unpublished (7264ms)
        ✓ invalid posted coupon is other currency (7540ms)
    returns
      ✓ object (8524ms)

  /api/user/subscriptions/set-subscription-plan
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid
      invalid-account
        ✓ ineligible accessing account (14768ms)
      invalid-planid
        ✓ missing posted planid (7557ms)
        ✓ invalid posted planid (7872ms)
      invalid-plan
        ✓ invalid posted plan is not published (7976ms)
        ✓ invalid posted plan is unpublished (8332ms)
        ✓ invalid posted plan is unchanged (7413ms)
    invalid-paymentmethodid
      ✓ invalid customer requires payments method (5876ms)
    returns
      ✓ object (8204ms)

  /api/user/subscriptions/set-subscription-quantity
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid
      invalid-account
        ✓ ineligible accessing account (7337ms)
      invalid-quantity
        ✓ invalid posted quantity (8058ms)
        ✓ invalid posted quantity is unchanged (7632ms)
        ✓ invalid posted quantity is negative (7618ms)
        ✓ invalid posted quantity is zero (7590ms)
    returns
      ✓ object (8631ms)

  /api/user/subscriptions/set-subscription-tax-percent
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid
      invalid-account
        ✓ ineligible accessing account (6931ms)
      invalid-tax_percent
        ✓ invalid posted tax_percent (7647ms)
        ✓ invalid posted tax_percent is unchanged (7366ms)
        ✓ invalid posted tax_percent is negative (7550ms)
    returns
      ✓ object (9993ms)

  /api/user/subscriptions/setup-intent
    exceptions
      invalid-setupintentid
        ✓ missing querystring setupintentid
        ✓ invalid querystring setupintentid
      invalid-account
        ✓ ineligible accessing account (3761ms)
    returns
      ✓ object (2837ms)

  /api/user/subscriptions/setup-intents-count
    returns
      ✓ integer (4841ms)

  /api/user/subscriptions/setup-intents
    exceptions
      invalid-accountid
        ✓ missing querystring accountid
        ✓ invalid querystring accountid
      invalid-account
        ✓ ineligible accessing account (42ms)
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    configuration
      ✓ environment PAGE_SIZE

  /api/user/subscriptions/subscription
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid
      invalid-account
        ✓ ineligible accessing account (14804ms)
    returns
      ✓ object (8062ms)

  /api/user/subscriptions/subscriptions-count
    exceptions
      invalid-accountid
        ✓ missing querystring accountid
        ✓ invalid querystring accountid
      invalid-account
        ✓ ineligible accessing account (46ms)
    returns
      ✓ integer (10940ms)

  /api/user/subscriptions/subscriptions
    exceptions
      invalid-accountid
        ✓ missing querystring accountid
        ✓ invalid querystring accountid
      invalid-account
        ✓ ineligible accessing account (40ms)
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/user/subscriptions/upcoming-invoice
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid
      invalid-account
        ✓ ineligible accessing account (14239ms)
      invalid-subscription
        ✓ ineligible querystring subscription (13283ms)
    returns
      ✓ object (7288ms)

  /api/user/subscriptions/usage-record-summaries
    exceptions
      invalid-subscriptionitemid
        ✓ missing querystring subscriptionitemid
        ✓ invalid querystring subscriptionitemid
    receives
      ✓ optional querystring starting_after (string)
      ✓ optional querystring ending_before (string)
      ✓ optional querystring limit (integer)
    returns
      ✓ stripe list response
    configuration
      ✓ environment PAGE_SIZE


  966 passing (2h)

