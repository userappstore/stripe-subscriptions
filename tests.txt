
> @userappstore/stripe-subscriptions@1.0.1058 test /root/workspace/stripe-subscriptions
> NODE_ENV=testing mocha --recursive --timeout 180000 --slow 1 "src"



  proxy/x-customer-header
    Customer#AFTER
      ✓ should set customer data in header (2223ms)

  proxy/x-invoices-header
    Invoices#AFTER
      ✓ should set invoice data in header (16111ms)

  proxy/x-subscriptions-header
    Subscriptions#AFTER
      ✓ should set invoice data in header (10932ms)

  server/bind-customer
    BindCustomer#AFTER
      ✓ should bind existing customer data to req (2527ms)

  server/bind-stripekey
    BindStripeKey#AFTER
      ✓ should bind stripekey data to req (1747ms)

  server/require-payment
    RequirePayment#AFTER
      ✓ should allow non-customer through (1632ms)
      ✓ should allow unsubscribed customer through (2118ms)
      ✓ should allow owing customer access to /account/* (15059ms)
      ✓ should allow owing administrator access to /administrator/ (19846ms)
      ✓ should redirect owing customer (21934ms)
      ✓ should allow non-owing customer (10025ms)

  server/require-subscription
    RequireSubscription#AFTER
      ✓ should allow non-customer (1693ms)
      ✓ should allow customer without subscription access to /account/* (2205ms)
      ✓ should allow administrator without subscription access to /administrator/ (3599ms)
      ✓ should redirect unsubscribed customer to the plans list (2253ms)
      ✓ should allow customer with subscription to pass (10259ms)

  /account/subscriptions/cancel-subscription
    CancelSubscription#BEFORE
      ✓ should bind subscription to req (11327ms)
    CancelSubscription#GET
      ✓ should present the form (11125ms)
      ✓ should present the subscription table (11024ms)
    CancelSubscription#POST
      ✓ should apply after authorization (12431ms)

  /account/subscriptions/card
    Card#BEFORE
      ✓ should reject invalid card (2100ms)
      ✓ should reject other account's card (5933ms)
      ✓ should bind card to req (3941ms)
    Card#GET
      ✓ should have row for card (3944ms)

  /account/subscriptions/cards
    Cards#BEFORE
      ✓ should bind cards to req (8422ms)
    Cards#GET
      ✓ should enforce page size (10059ms)
      ✓ should enforce specified offset (9631ms)

  /account/subscriptions/change-plan
    ChangePlan#BEFORE
      ✓ should bind subscription to req (11473ms)
    ChangePlan#GET
      ✓ should present the form (10829ms)
      ✓ should present the subscription table (10888ms)
    ChangePlan#POST
      ✓ should reject same plan (12462ms)
      ✓ should reject never published plan (13398ms)
      ✓ should reject unpublished plan (14349ms)
      ✓ should reject paid plan without payment information (10864ms)
      ✓ should apply after authorization (15390ms)

  /account/subscriptions/delete-card
    DeleteCard#BEFORE
      ✓ should reject invalid cardid (6428ms)
      ✓ should reject other account's card (9871ms)
      ✓ should reject default payment source (8195ms)
      ✓ should bind card to req (6002ms)
    DeleteCard#GET
      ✓ should present the form (7717ms)
      ✓ should present the card table (5842ms)
    DeleteCard#POST
      ✓ should apply after authorization (7253ms)

  /account/subscriptions/edit-payment-information
    EditPaymentInformation#GET
      ✓ should present the form (2257ms)
    EditPaymentInformation#POST
      ✓ should require name (2282ms)
      ✓ should require CVC (2218ms)
      ✓ should require card number (2267ms)
      ✓ should require expiration month (2300ms)
      ✓ should require expiration year (2437ms)
      ✓ should apply after authorization (4133ms)

  /account/subscriptions
    Index#BEFORE
      ✓ should bind cards to req (4191ms)
      ✓ should bind invoices to req (15473ms)
      ✓ should bind subscriptions to req (11567ms)
    Index#GET
      ✓ should have row for each invoice (22482ms)
      ✓ should have row for each card (6166ms)
      ✓ should have row for each subscription (16595ms)

  /account/subscriptions/invoice
    Invoice#BEFORE
      ✓ should reject invalid invoice (3833ms)
      ✓ should reject other account's invoice (15637ms)
      ✓ should bind invoice to req (12074ms)
    Invoice#GET
      ✓ should have row for invoice (14567ms)

  /account/subscriptions/invoices
    Invoices#BEFORE
      ✓ should bind invoices to req (36752ms)
    Invoices#GET
      ✓ should enforce page size (39387ms)
      ✓ should enforce specified offset (36458ms)

  /account/subscriptions/pay-invoice
    PayInvoice#BEFORE
      ✓ should reject invalid invoice (2011ms)
      ✓ should reject other account's invoice (21936ms)
      ✓ should reject paid invoice (14941ms)
      ✓ should bind invoice to req (23053ms)
    PayInvoice#GET
      ✓ should present the form (16996ms)
      ✓ should present the invoice table (17831ms)
    PayInvoice#POST
      ✓ should apply after authorization (19725ms)

  /account/subscriptions/plan
    Plan#BEFORE
      ✓ should reject invalid plan (2550ms)
      ✓ should reject never published plan (6550ms)
      ✓ should reject unpublished plan (8258ms)
      ✓ should bind plan to req (6573ms)
    Plan#GET
      ✓ should have row for plan (6446ms)

  /account/subscriptions/plans
    Plans#BEFORE
      ✓ should bind plans to req (9603ms)
    Plans#GET
      ✓ should enforce page size (11690ms)
      ✓ should enforce specified offset (11535ms)

  /account/subscriptions/refund-invoice
    RefundInvoice#BEFORE
      ✓ should reject invalid invoice (3850ms)
      ✓ should reject other account's invoice (16935ms)
      ✓ should bind invoice to req (15808ms)
      ✓ should bind charge to req (16453ms)
    RefundInvoice#GET
