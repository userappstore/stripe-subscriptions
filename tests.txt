

  index
    STRIPE_JS
      Use client-side stripe.js in browser
        ✓ default unset
        ✓ Integer
    MAXIMUM_STRIPE_RETRIES
      Retry Stripe web requests
        ✓ default 0
        ✓ Integer
    SUBSCRIPTION_WEBHOOK_ENDPOINT_SECRET
      Secret provided by Stripe to sign webhooks
        ✓ String
    STRIPE_KEY
      The `sk_test_xxx` key from Stripe
        ✓ String
    STRIPE_PUBLISHABLE_KEY
      The `pk_test_xxx` key from Stripe
        ✓ String
    REQUIRE_SUBSCRIPTION
      Users must create subscription to access application
        ✓ default unset
        ✓ Boolean
    REQUIRE_PAYMENT
      Users must resolve unpaid invoices to access application
        ✓ default unset
        ✓ Boolean
    REQUIRE_PAYMENT_CONFIRMATION
      Users must resolve payment confirmations to access application
        ✓ default unset
        ✓ Boolean
    OVERDUE_INVOICE_THRESHOLD
      Duration in days to allow open invoices before enforcing payment
        ✓ default 1
        ✓ Integer
    START_SUBSCRIPTION_PATH
      Alternate URL path to your start subscription flow
        ✓ default /account/subscriptions/start-subscription
        ✓ String

  server/bind-stripekey
    after
      ✓ should bind data to req (58ms)

  server/require-payment-confirmation
    after
      ✓ should ignore guests
      ✓ should ignore user with pending confirmations requesting account pages (6117ms)
      ✓ should ignore administrators with pending confirmations requesting administration pages (5867ms)
      ✓ should ignore user without pending confirmation (6726ms)
      ✓ should require user confirm payment (6055ms)

  server/require-payment
    after
      ✓ should ignore guests
      ✓ should ignore user with amount owed requesting account pages (1968ms)
      ✓ should ignore administrator with amount owed requesting administration pages (2161ms)
      ✓ should ignore user without amount owed
      ✓ should ignore user with open but not overdue invoice (5035ms)
      ✓ should require user pay overdue invoice (5217ms)

  server/require-subscription
    after
      ✓ should ignore guests
      ✓ should ignore user without subscription requesting account pages
      ✓ should ignore administrator without subscription requesting administration pages
      ✓ should ignore user with active subscription (7185ms)
      ✓ should require user create subscription (63ms)

  /account/subscriptions/add-payment-method
    view
      ✓ should present the form for no stripe.js (1685ms)
      ✓ should present the form for stripe.js v3 (1986ms)
    submit
      ✓ should require name for no stripe.js (6095ms)
      ✓ should require CVC for no stripe.js (6204ms)
      ✓ should require card number for no stripe.js (5863ms)
      ✓ should require expiration month for no stripe.js (6203ms)
      ✓ should require expiration year for no stripe.js (6221ms)
      ✓ should add payment information no stripe.js (screenshots) (71078ms)
      ✓ should add payment information stripe.js v3 (20944ms)

  /account/subscriptions/billing-profile
    before
      ✓ should reject invalid customer (224ms)
      ✓ should reject other account's customer (242ms)
      ✓ should bind data to req (227ms)
    view
      ✓ should have row for customer (screenshots) (20912ms)

  /account/subscriptions/billing-profiles
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /account/subscriptions/cancel-subscription
    exceptions
      ✓ should reject missing subscription
      ✓ should reject invalid subscription
      ✓ should reject canceled subscription
      ✓ should reject other account's subscription
    before
      ✓ should bind data to req
    view
      ✓ should present the form
      ✓ should show fields for free plan cancelations
      ✓ should show fields for free trial cancelations
      ✓ should show fields for cancelation with credit or refund
    submit
      ✓ should cancel free subscription immediately (screenshots)
      ✓ should cancel free subscription at period end
      ✓ should cancel free trial immediately
      ✓ should cancel free trial at period end
      ✓ should cancel paid subscription and credit account
      ✓ should cancel paid subscription and show refund

  /account/subscriptions/change-plan
    before
      ✓ should bind data to req
    view
      ✓ should present the form
      ✓ should remove the form if there are no plans
    submit
      ✓ should apply plan update (screenshots)
    errors
      ✓ should reject paid plan without payment information

  /account/subscriptions/confirm-payment
    before
      ✓ should bind data to req (6299ms)
    view
      ✓ should display stripe.js confirmation

  /account/subscriptions/confirm-subscription
    exceptions
      ✓ invalid-planid (154ms)
      ✓ invalid-plan
    before
      ✓ should bind data to req
    view
      ✓ should present the form
    submit
      ✓ should start subscription (screenshots)
    errors
      ✓ invalid-paymentmethodid

  /account/subscriptions/create-billing-profile
    view
      ✓ should present the form for no stripe.js (662ms)
      ✓ should present the form for stripe.js v3 (1388ms)
    submit
      ✓ should require description for no stripe.js (7008ms)
      ✓ should require email for no stripe.js (6493ms)
      ✓ should require name for no stripe.js (6808ms)
      ✓ should require CVC for no stripe.js (7549ms)
      ✓ should require card number for no stripe.js (6553ms)
      ✓ should require expiration month for no stripe.js (6939ms)
      ✓ should require expiration year for no stripe.js (7127ms)
      ✓ should require description for stripe.js v3 (18541ms)
      ✓ should require email for stripe.js v3 (18532ms)
      ✓ should create billing profile for no stripe.js (8355ms)
      ✓ should create billing profile for stripe.js v3 (screenshots) (111987ms)

  /account/subscriptions/delete-billing-profile
    exceptions
      ✓ invalid-customerid
      ✓ invalid-account
    before
      ✓ should bind data to req
    view
      ✓ should present the form
    submit
      ✓ should delete billing profile (screenshots)

  /account/subscriptions
    before
      ✓ should bind data to req
    view
      ✓ should have row for each invoice
      ✓ should have row for each customer
      ✓ should have row for each subscription

  /account/subscriptions/invoice
    exceptions
      ✓ invalid-invoiceid
      ✓ invalid-account
    before
      ✓ should bind data to req
    view
      ✓ should have row for invoice (screenshots)

  /account/subscriptions/invoices
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /account/subscriptions/pay-invoice
    exceptions
      ✓ should reject invalid invoice
      ✓ invalid-account
      ✓ should reject paid invoice
    before
      ✓ should bind data to req
    view
      ✓ should present the form
    submit
      ✓ should pay invoice (screenshots)

  /account/subscriptions/plan
    before
      ✓ should reject invalid plan (163ms)
      ✓ should reject never published plan (649ms)
      ✓ should reject unpublished plan (826ms)
      ✓ should bind data to req (667ms)
    view
      ✓ should have row for plan (screenshots) (20647ms)

  /account/subscriptions/plans
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /account/subscriptions/refund-invoice
    exceptions
      ✓ invalid-invoiceid
      ✓ invalid-account
    before
      ✓ should bind data to req
    view
      ✓ should present the form
    submit
      ✓ should cancel subscription (screenshots)

  /account/subscriptions/refunds
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /account/subscriptions/request-refund
    exceptions
      ✓ invalid-invoice
      ✓ invalid-account
    before
      ✓ should bind data to req
    view
      ✓ should present the form
    submit
      ✓ should create refund request (screenshots)

  /account/subscriptions/subscription
    exceptions
      ✓ invalid-subscriptionid (773ms)
      ✓ invalid-account
    before
      ✓ should bind data to req
    view
      ✓ should present the subscription table (screenshots)

  /account/subscriptions/subscriptions
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /administrator/subscriptions/apply-customer-coupon
    exceptions
      ✓ should reject invalid customer (169ms)
      ✓ should reject customer with coupon (2155ms)
    before
      ✓ should bind data to req (904ms)
    view
      ✓ should present the form (1508ms)
    submit
      ✓ should apply coupon (screenshots) (39277ms)

  /administrator/subscriptions/apply-subscription-coupon
    exceptions
      ✓ should reject invalid subscription (147ms)
      ✓ should reject canceling subscription (9209ms)
      ✓ should reject free subscription (5240ms)
      ✓ should reject subscription with coupon (9880ms)
    before
      ✓ should bind data to req (7969ms)
    view
      ✓ should present the form (8098ms)
    submit
      ✓ should apply coupon (screenshots) (45097ms)

  /administrator/subscriptions/charge
    before
      ✓ should reject invalid charge (969ms)
      ✓ should bind data to req (6929ms)
    view
      ✓ should present the charge table (screenshots) (31081ms)

  /administrator/subscriptions/charges
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /administrator/subscriptions/coupon
    before
      ✓ should reject invalid coupon (215ms)
      ✓ should bind data to req (315ms)
    view
      ✓ should present the coupon table (screenshots) (24419ms)

  /administrator/subscriptions/coupons
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /administrator/subscriptions/create-coupon
    view
      ✓ should present the form (774ms)
    submit
      ✓ should reject missing couponid (1372ms)
      ✓ should enforce couponid length (2260ms)
      ✓ should reject duplicate couponid (2100ms)
      ✓ should reject missing duration (1763ms)
      ✓ should enforce invalid duration (1790ms)
      ✓ should require valid amount off (1845ms)
      ✓ should require valid percent off (1720ms)
      ✓ should require valid max redemptions (1789ms)
      ✓ should require amount or percent off (1598ms)
      ✓ should require valid duration in months if repeating (1872ms)
      ✓ should require valid redeem_by if provided (2099ms)
      ✓ should create coupon (screenshots) (31170ms)

  /administrator/subscriptions/create-plan
    view
      ✓ should present the form (856ms)
    submit
      ✓ should reject missing planid (1920ms)
      ✓ should enforce planid length (3072ms)
      ✓ should reject missing productid (1674ms)
      ✓ should reject never published product (2078ms)
      ✓ should reject unpublished product (2129ms)
      ✓ should reject missing currency (2076ms)
      ✓ should reject invalid currency (2113ms)
      ✓ should reject missing usage_type (2071ms)
      ✓ should reject missing amount (1999ms)
      ✓ should reject invalid amount (2089ms)
      ✓ should reject missing interval (2069ms)
      ✓ should reject invalid interval (2085ms)
      ✓ should reject invalid interval_count (2060ms)
      ✓ should reject invalid trial_period_days (2348ms)
      ✓ should create plan (screenshots) (31621ms)

  /administrator/subscriptions/create-product
    view
      ✓ should present the form (497ms)
    submit
      ✓ should reject missing name (1329ms)
      ✓ should enforce name length (2241ms)
      ✓ should reject missing statement_descriptor (1239ms)
      ✓ should create product (screenshots) (30835ms)

  /administrator/subscriptions/customer
    before
      ✓ should reject invalid customer (476ms)
      ✓ should bind data to req (236ms)
    view
      ✓ should present the customer table (screenshots) (20659ms)

  /administrator/subscriptions/customers
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /administrator/subscriptions/delete-coupon
    exceptions
      ✓ should reject invalid couponid (143ms)
    before
      ✓ should bind data to req (294ms)
    view
      ✓ should present the form (780ms)
    submit
      ✓ should delete coupon (screenshots) (37334ms)

  /administrator/subscriptions/delete-plan
    exceptions
      ✓ should reject invalid planid (162ms)
    before
      ✓ should bind data to req (595ms)
    view
      ✓ should present the form (1160ms)
    submit
      ✓ should delete plan (screenshots) (37670ms)

  /administrator/subscriptions/delete-product
    exceptions
      ✓ should reject invalid productid (136ms)
    before
      ✓ should bind data to req (291ms)
    view
      ✓ should present the form (785ms)
    submit
      ✓ should delete product (screenshots) (35938ms)

  /administrator/subscriptions/delete-subscription
    exceptions
      ✓ should reject missing subscription
      ✓ should reject invalid subscription
      ✓ should reject canceled subscription
    before
      ✓ should bind data to req
    view
      ✓ should present the form
      ✓ should show fields for free plan cancelations
      ✓ should show fields for free trial cancelations
      ✓ should show fields for cancelation with credit or refund
    submit
      ✓ should cancel free subscription immediately (screenshots) (5863ms)
      ✓ should cancel free subscription at period end
      ✓ should cancel free trial immediately
      ✓ should cancel free trial at period end
      ✓ should cancel paid subscription and credit account
      ✓ should cancel paid subscription and show refund

  /administrator/subscriptions/deny-refund
    exceptions
      ✓ should reject invalid chargeid (146ms)
      ✓ should reject charge without refund request (7548ms)
      ✓ should reject denied refund (8862ms)
    before
      ✓ should bind data to req (7344ms)
    view
      ✓ should present the form (9023ms)
    submit
      ✓ should deny refund (screenshots) (48810ms)

  /administrator/subscriptions/edit-coupon
    before
      ✓ should reject invalid couponid
      ✓ should reject unpublished coupon (515ms)
      ✓ should bind data to req (309ms)
    view
      ✓ should present the form (805ms)
    submit
      ✓ should reject missing name (1209ms)
      ✓ should update coupon (screenshots) (37999ms)

  /administrator/subscriptions/edit-plan
    before
      ✓ should reject invalid planid (298ms)
      ✓ should reject unpublished plan (1003ms)
      ✓ should bind data to req (758ms)
    view
      ✓ should present the form (1288ms)
    submit
      ✓ should reject missing productid (1879ms)
      ✓ should reject invalid trial period (2515ms)
      ✓ should update plan (screenshots) (40059ms)

  /administrator/subscriptions/edit-product
    before
      ✓ should reject invalid productid (142ms)
      ✓ should reject unpublished product (456ms)
      ✓ should bind data to req (308ms)
    view
      ✓ should present the form (798ms)
    submit
      ✓ should reject missing name (1536ms)
      ✓ should enforce name length (2433ms)
      ✓ should reject missing statement_descriptor (1492ms)
      ✓ should reject invalid unit_label (1892ms)
      ✓ should update product (screenshots) (40353ms)

  /administrator/subscriptions/flag-charge
    exceptions
      ✓ should reject invalid chargeid (188ms)
      ✓ should reject flagged charge
    before
      ✓ should bind data to req
    view
      ✓ should present the form
    submit
      ✓ should flag charge (screenshots)

  /administrator/subscriptions/forgive-invoice
    exceptions
      ✓ should reject invalid invoiceid (355ms)
      ✓ should reject paid invoice (7741ms)
      ✓ should reject uncollectible invoice (2639ms)
    before
      ✓ should bind data to req (2356ms)
    view
      ✓ should present the form (2892ms)
    submit
      ✓ should forgive invoice (screenshots) (36933ms)

  /administrator/subscriptions
    before
      ✓ should bind data to req (9239ms)
    view
      ✓ should have row for each plan (1672ms)
      ✓ should have row for each coupon (1089ms)
      ✓ should have row for each subscription (screenshots) (29374ms)

  /administrator/subscriptions/invoice
    before
      ✓ should reject invalid invoiceid (160ms)
      ✓ should bind data to req (7161ms)
    view
      ✓ should present the invoice table (screenshots) (31422ms)

  /administrator/subscriptions/invoices
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /administrator/subscriptions/payment-intent
    before
      ✓ should reject invalid paymentintentid
      ✓ should bind data to req (1710ms)
    view
      ✓ should have row for payment intent (screenshots) (25845ms)

  /administrator/subscriptions/payment-intents
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /administrator/subscriptions/payment-method
    before
      ✓ should reject invalid paymentmethodid (55ms)
      ✓ should bind data to req (1685ms)
    view
      ✓ should have row for payment method (screenshots) (25679ms)

  /administrator/subscriptions/payment-methods
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /administrator/subscriptions/payout
    before
      ✓ should reject invalid payoutid (158ms)

  /administrator/subscriptions/plan
    before
      ✓ should reject invalid planid (166ms)
      ✓ should bind data to req (656ms)
    view
      ✓ should present the plan table (screenshots) (24652ms)

  /administrator/subscriptions/plans
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /administrator/subscriptions/product
    before
      ✓ should reject invalid productid (155ms)
      ✓ should bind data to req (308ms)
    view
      ✓ should have row for product (screenshots) (23202ms)

  /administrator/subscriptions/products
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /administrator/subscriptions/publish-coupon
    exceptions
      ✓ should reject invalid couponid (145ms)
      ✓ should reject published coupon (312ms)
    before
      ✓ should bind data to req (342ms)
    view
      ✓ should present the form (821ms)
    submit
      ✓ should publish coupon (screenshots) (36901ms)

  /administrator/subscriptions/publish-plan
    exceptions
      ✓ should reject invalid planid (154ms)
      ✓ should reject published plan (633ms)
    before
      ✓ should bind data to req (625ms)
    view
      ✓ should present the form (1147ms)
    submit
      ✓ should publish plan (screenshots) (37386ms)

  /administrator/subscriptions/publish-product
    exceptions
      ✓ should reject invalid productid (155ms)
      ✓ should reject published product (305ms)
    before
      ✓ should bind data to req (320ms)
    view
      ✓ should present the form (772ms)
    submit
      ✓ should publish product (screenshots) (35537ms)

  /administrator/subscriptions/refund-charge
    exceptions
      ✓ should reject invalid chargeid (162ms)
      ✓ should reject refunded charge
    before
      ✓ should bind data to req
    view
      ✓ should present the form
    submit
      ✓ should refund charge (screenshots)

  /administrator/subscriptions/refund-requests
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /administrator/subscriptions/refund
    before
      ✓ should reject invalid refundid (141ms)
      ✓ should bind data to req (9466ms)
    view
      ✓ should have row for refund (screenshots) (33684ms)

  /administrator/subscriptions/refunds
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /administrator/subscriptions/revoke-customer-coupon
    exceptions
      ✓ should reject invalid customer (143ms)
      ✓ should reject customer without discount (875ms)
    before
      ✓ should bind data to req (1397ms)
    view
      ✓ should present the form (1925ms)
    submit
      ✓ should remove coupon (screenshots) (35386ms)

  /administrator/subscriptions/revoke-subscription-coupon
    exceptions
      ✓ should reject invalid subscription (159ms)
      ✓ should reject subscription without discount (12334ms)
    before
      ✓ should bind data to req (9221ms)
    view
      ✓ should present the form (9107ms)
    submit
      ✓ should remove coupon (screenshots) (45722ms)

  /administrator/subscriptions/setup-intent
    before
      ✓ should reject invalid setupintentid
      ✓ should bind data to req (3332ms)
    view
      ✓ should have row for setup intent (screenshots) (26937ms)

  /administrator/subscriptions/setup-intents
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /administrator/subscriptions/subscription
    before
      ✓ should reject invalid subscriptionid (139ms)
      ✓ should bind data to req (8015ms)
    view
      ✓ should present the subscription table (screenshots) (30309ms)

  /administrator/subscriptions/subscriptions
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /administrator/subscriptions/unpublish-coupon
    exceptions
      ✓ should reject invalid couponid (142ms)
      ✓ should reject never published coupon (303ms)
      ✓ should reject unpublished coupon (508ms)
    before
      ✓ should bind data to req (288ms)
    view
      ✓ should present the form (775ms)
    submit
      ✓ should unpublish coupon (screenshots) (37214ms)

  /administrator/subscriptions/unpublish-plan
    exceptions
      ✓ should reject invalid planid (164ms)
      ✓ should never published plan (617ms)
      ✓ should reject unpublished plan (901ms)
    before
      ✓ should bind data to req (658ms)
    view
      ✓ should present the form (1229ms)
    submit
      ✓ should unpublish plan (screenshots) (37381ms)

  /administrator/subscriptions/unpublish-product
    exceptions
      ✓ should reject invalid productid (144ms)
      ✓ should never published product (290ms)
      ✓ should reject unpublished product (437ms)
    before
      ✓ should bind data to req (291ms)
    view
      ✓ should present the form (745ms)
    submit
      ✓ should unpublish product (screenshots) (35657ms)

  /api/administrator/subscriptions/charge
    exceptions
      invalid-chargeid
        ✓ missing querystring chargeid
        ✓ invalid querystring chargeid (157ms)
    returns
      ✓ object (7408ms)

  /api/administrator/subscriptions/charges-count
    returns
      ✓ integer (26630ms)

  /api/administrator/subscriptions/charges
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/administrator/subscriptions/coupon
    exceptions
      invalid-couponid
        ✓ missing querystring couponid
        ✓ invalid querystring couponid (146ms)
    returns
      ✓ object (341ms)

  /api/administrator/subscriptions/coupons-count
    returns
      ✓ integer (508ms)

  /api/administrator/subscriptions/coupons
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/administrator/subscriptions/create-cancelation-refund
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid (163ms)
      invalid-subscription
        ✓ ineligible querystring subscription is not active (8831ms)
    returns
      ✓ object (8185ms)

  /api/administrator/subscriptions/create-coupon
    exceptions
      invalid-couponid
        ✓ missing posted couponid
        ✓ invalid posted couponid is not alphanumeric_
      invalid-amount_off
        ✓ missing posted amount_off
        ✓ invalid posted amount_off
      invalid-currency
        ✓ missing posted currency
        ✓ invalid posted currency
      invalid-percent_off
        ✓ invalid posted percent_off
      invalid-duration
        ✓ invalid posted duration
      invalid-duration_in_months
        ✓ missing posted duration_in_months
        ✓ invalid posted duration_in_months
      invalid-redeem_by_meridiem
        ✓ invalid posted redeem_by_meridiem
      invalid-redeem_by
        ✓ invalid posted redeem_by
    receives
      ✓ required posted duration
      ✓ optionally-required posted amount_off (integer, or percent_off)
      ✓ optionally-required posted currency (string, if amount_off)
      ✓ optionally-required posted percent_off (integer, or amount_off)
      ✓ optionally-required posted expire date 
      ✓ optionally-required posted duration_in_months
    returns
      ✓ object (180ms)

  /api/administrator/subscriptions/create-plan
    exceptions
      invalid-planid
        ✓ invalid posted planid is not alphanumeric_ (167ms)
      invalid-planid-length
        ✓ posted planid is too short (175ms)
        ✓ posted planid is too long (181ms)
      invalid-productid
        ✓ missing posted productid (354ms)
        ✓ invalid posted productid (292ms)
      invalid-product
        ✓ ineligible posted product is not published (296ms)
      invalid-amount
        ✓ missing posted amount (289ms)
        ✓ invalid posted amount (308ms)
      invalid-currency
        ✓ missing posted currency (182ms)
        ✓ invalid posted currency (159ms)
      invalid-interval
        ✓ missing posted interval (281ms)
        ✓ invalid posted interval (305ms)
      invalid-interval-count
        ✓ missing posted interval_count (291ms)
        ✓ invalid posted interval_count (319ms)
      invalid-trial_period
        ✓ invalid posted trial_period (296ms)
      invalid-usage_type
        ✓ invalid posted usage_type (310ms)
    receives
      ✓ optional posted published (boolean) (513ms)
      ✓ optional posted trial_period_days (integer) (527ms)
      ✓ optional posted usage_type (licensed|metered) (535ms)
    returns
      ✓ object (497ms)
    configuration
      ✓ environment MINIMUM_PLANID_LENGTH (181ms)
      ✓ environment MAXIMUM_PLANID_LENGTH (197ms)

  /api/administrator/subscriptions/create-product
    exceptions
      invalid-name
        ✓ missing posted name
      invalid-product-name-length
        ✓ posted name too short
        ✓ posted name too long
      invalid-statement_descriptor
        ✓ missing posted statement_descriptor
    receives
      ✓ optional posted published (boolean) (325ms)
    returns
      ✓ object (341ms)
    configuration
      ✓ environment MINIMUM_PRODUCT_NAME_LENGTH
      ✓ environment MAXIMUM_PRODUCT_NAME_LENGTH

  /api/administrator/subscriptions/create-refund
    exceptions
      invalid-chargeid
        ✓ missing querystring chargeid
        ✓ invalid querystring chargeid (148ms)
      invalid-amount
        ✓ missing posted amount
        ✓ invalid posted amount
        ✓ invalid posted amount is negative
        ✓ invalid posted amount exceeds charge
    returns
      ✓ object

  /api/administrator/subscriptions/customer
    exceptions
      invalid-customerid
        ✓ missing querystring customerid
        ✓ invalid querystring customerid (144ms)
    returns
      ✓ object (3636ms)

  /api/administrator/subscriptions/customers-count
    returns
      ✓ integer (472ms)

  /api/administrator/subscriptions/customers
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/administrator/subscriptions/delete-coupon
    exceptions
      invalid-couponid
        ✓ missing querystring couponid
        ✓ invalid querystring couponid (159ms)
    returns
      ✓ boolean (629ms)

  /api/administrator/subscriptions/delete-plan
    exceptions
      invalid-planid
        ✓ missing querystring planid
        ✓ invalid querystring planid (157ms)
    returns
      ✓ boolean (814ms)

  /api/administrator/subscriptions/delete-product
    exceptions
      invalid-productid
        ✓ missing querystring productid
        ✓ invalid querystring productid (134ms)
    returns
      ✓ boolean (475ms)

  /api/administrator/subscriptions/delete-subscription
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid (151ms)
      invalid-subscription
        ✓ ineligible querystring subscription is not active (10205ms)
    returns
      ✓ boolean (7544ms)

  /api/administrator/subscriptions/invoice
    exceptions
      invalid-invoiceid
        ✓ missing querystring invoiceid
        ✓ invalid querystring invoiceid (151ms)
    returns
      ✓ object (6953ms)

  /api/administrator/subscriptions/invoices-count
    returns
      ✓ integer (30877ms)

  /api/administrator/subscriptions/invoices
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/administrator/subscriptions/payment-intent
    exceptions
      invalid-paymentintentid
        ✓ missing querystring paymentintentid
        ✓ invalid querystring paymentintentid
    returns
      ✓ object (1890ms)

  /api/administrator/subscriptions/payment-intents-count
    returns
      ✓ integer (5277ms)

  /api/administrator/subscriptions/payment-intents
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/administrator/subscriptions/payment-method
    exceptions
      invalid-paymentmethodid
        ✓ missing querystring paymentmethodid
        ✓ invalid querystring paymentmethodid
    returns
      ✓ object (2061ms)

  /api/administrator/subscriptions/payment-methods-count
    returns
      ✓ integer (4262ms)

  /api/administrator/subscriptions/payment-methods
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/administrator/subscriptions/plan
    exceptions
      invalid-planid
        ✓ missing querystring planid
        ✓ invalid querystring planid (166ms)
    returns
      ✓ object (657ms)

  /api/administrator/subscriptions/plans-count
    returns
      ✓ integer (1234ms)

  /api/administrator/subscriptions/plans
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/administrator/subscriptions/product
    exceptions
      invalid-productid
        ✓ missing querystring productid
        ✓ invalid querystring productid (180ms)
    returns
      ✓ object (315ms)

  /api/administrator/subscriptions/products-count
    returns
      ✓ integer (525ms)

  /api/administrator/subscriptions/products
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/administrator/subscriptions/refund-requests-count
    returns
      ✓ integer (28768ms)

  /api/administrator/subscriptions/refund-requests
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/administrator/subscriptions/refund
    exceptions
      ✓ invalid querystring refundid
      ✓ missing querystring refundid (145ms)
    returns
      ✓ object (10873ms)

  /api/administrator/subscriptions/refunds-count
    returns
      ✓ integer (32822ms)

  /api/administrator/subscriptions/refunds
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/administrator/subscriptions/reset-customer-coupon
    exceptions
      invalid-customerid
        ✓ missing querystring customerid
        ✓ invalid querystring customerid (157ms)
      invalid-customeir
        ✓ invalid querystring customer has no discount (219ms)
    receives
      ✓ object (957ms)

  /api/administrator/subscriptions/reset-subscription-coupon
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid (298ms)
      invalid-subscription
        ✓ ineligible querystring subscription has no discount (6993ms)
    returns
      ✓ object (8413ms)

  /api/administrator/subscriptions/set-charge-flagged
    exceptions
      invalid-chargeid
        ✓ missing querystring charge
        ✓ invalid querystring charge (152ms)
      invalid-charge
        ✓ ineligible querystring charge is already flagged (8381ms)
    returns
      ✓ object (8412ms)

  /api/administrator/subscriptions/set-coupon-published
    exceptions
      invalid-couponid
        ✓ missing querystring couponid
        ✓ invalid querystring couponid (167ms)
      invalid-coupon
        ✓ ineligible querystring coupon is published (333ms)
        ✓ ineligible querystring coupon is unpublished (365ms)
    returns
      ✓ object (616ms)

  /api/administrator/subscriptions/set-coupon-unpublished
    exceptions
      invalid-couponid
        ✓ missing querystring couponid
        ✓ invalid querystring couponid (140ms)
      invalid-coupon
        ✓ ineligible querystring coupon is not published (311ms)
        ✓ ineligible querystring coupon is already unpublished (488ms)
    returns
      ✓ object (515ms)

  /api/administrator/subscriptions/set-invoice-uncollectible
    exceptions
      invalid-invoiceid
        ✓ missing querystring invoiceid (153ms)
        ✓ invalid querystring invoiceid (147ms)
      invalid-invoice
        ✓ invalid querystring invoice is paid (6528ms)
        ✓ invalid querystring invoice is marked uncollectable (4598ms)
    returns
      ✓ object (5186ms)

  /api/administrator/subscriptions/set-plan-published
    exceptions
      invalid-planid
        ✓ missing querystring planid
        ✓ invalid querystring planid (156ms)
      invalid-plan
        ✓ ineligible querystring plan is published (623ms)
    returns
      ✓ object (820ms)

  /api/administrator/subscriptions/set-plan-unpublished
    exceptions
      invalid-planid
        ✓ missing querystring planid
        ✓ invalid querystring planid (153ms)
      invalid-plan
        ✓ ineligible querystring plan is not published (824ms)
        ✓ ineligible querystring plan is already unpublished (963ms)
    returns
      ✓ object (865ms)

  /api/administrator/subscriptions/set-product-published
    exceptions
      invalid-productid
        ✓ missing querystring productid (312ms)
        ✓ invalid querystring productid (321ms)
      invalid-product
        ✓ invalid querystring product is already published (335ms)
    returns
      ✓ object (483ms)

  /api/administrator/subscriptions/set-product-unpublished
    exceptions
      invalid-productid
        ✓ missing querystring productid (328ms)
        ✓ invalid querystring productid (317ms)
      invalid-product
        ✓ ineligible querystring product is not published (330ms)
        ✓ ineligible querystring product is already unpublished (490ms)
    returns
      ✓ object (470ms)

  /api/administrator/subscriptions/set-refund-request-denied
    exceptions
      invalid-chargeid
        ✓ missing querystring chargeid
        ✓ invalid querystring chargeid (161ms)
      invalid-charge
        ✓ ineligible querystring charge has no refund request (8935ms)
        ✓ ineligible querystring charge has denied request already (7359ms)
    returns
      ✓ object (7191ms)

  /api/administrator/subscriptions/set-subscription-canceled
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid (155ms)
      invalid-subscription
        ✓ ineligible querystring subscription is not active (8402ms)
    returns
      ✓ object (8147ms)

  /api/administrator/subscriptions/set-subscription-coupon
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid
      invalid-subscription
        ✓ ineligible subscription is canceling (8973ms)
        ✓ ineligible subscription has coupon (8125ms)
      invalid-couponid
        ✓ missing posted couponid (6767ms)
        ✓ invalid posted couponid (6450ms)
      invalid-coupon
        ✓ ineligible posted coupon is not published (7237ms)
        ✓ ineligible posted coupon is unpublished (7688ms)
    returns
      ✓ object (10159ms)

  /api/administrator/subscriptions/setup-intent
    exceptions
      invalid-setupintentid
        ✓ missing querystring setupintentid
        ✓ invalid querystring setupintentid
    returns
      ✓ object (2914ms)

  /api/administrator/subscriptions/setup-intents-count
    returns
      ✓ integer (3966ms)

  /api/administrator/subscriptions/setup-intents
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/administrator/subscriptions/subscription
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid (144ms)
    returns
      ✓ object (10544ms)

  /api/administrator/subscriptions/subscriptions-count
    returns
      ✓ integer (24381ms)

  /api/administrator/subscriptions/subscriptions
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/administrator/subscriptions/update-coupon
    exceptions
      invalid-couponid
        ✓ missing querystring couponid
        ✓ invalid querystring couponid (154ms)
      invalid-coupon
        ✓ ineligible querystring coupon is unpublished (485ms)
      invalid-name
        ✓ missing posted name (329ms)
        ✓ invalid posted name (333ms)
    receives
      ✓ required posted name (473ms)
    returns
      ✓ object (494ms)

  /api/administrator/subscriptions/update-plan
    exceptions
      invalid-planid
        ✓ missing querystring planid
        ✓ invalid querystring planid (162ms)
      invalid-plan
        ✓ ineligible querystring plan is unpublished (985ms)
      invalid-productid
        ✓ invalid posted productid (739ms)
      invalid-product
        ✓ ineligible posted product is not published (902ms)
        ✓ ineligible posted product is unpublished (1090ms)
      invalid-trial_period_days
        ✓ invalid posted trial_period_days (937ms)
        ✓ ineligible posted trial_period_days is negative (1037ms)
        ✓ ineligible posted trial_period_days greater than 365 (1078ms)
    receives
      ✓ optional posted trial_period_days (integer) (764ms)
    returns
      ✓ object (1232ms)

  /api/administrator/subscriptions/update-product
    exceptions
      invalid-productid
        ✓ missing querystring productid (187ms)
        ✓ invalid querystring productid (336ms)
      invalid-product
        ✓ ineligible querystring product is unpublished (456ms)
      invalid-name
        ✓ invalid posted name (307ms)
      invalid-name-length
        ✓ posted name too short (299ms)
        ✓ posted name too long (323ms)
      invalid-statement_descriptor
        ✓ invalid posted statement_descriptor (299ms)
      invalid-statement_descriptor-length
        ✓ posted statement_descriptor too short (295ms)
        ✓ posted statement_descriptor too long (284ms)
      invalid-unit_label
        ✓ missing posted unit_label (297ms)
    receives
      ✓ optional posted name (455ms)
      ✓ optional posted statement_descriptor (466ms)
      ✓ optional posted unit_label (457ms)
    returns
      ✓ object (511ms)
    configuration
      ✓ environment MINIMUM_PRODUCT_NAME_LENGTH (308ms)
      ✓ environment MAXIMUM_PRODUCT_NAME_LENGTH (292ms)

  /api/administrator/subscriptions/usage-record-summaries
    exceptions
      invalid-subscriptionitemid
        ✓ missing querystring subscriptionitemid
        ✓ invalid querystring subscriptionitemid
    receives
      ✓ optional querystring starting_after (string)
      ✓ optional querystring ending_before (string)
      ✓ optional querystring limit (integer)
    returns
      ✓ stripe list response
    configuration
      ✓ environment PAGE_SIZE

  /api/user/subscriptions/charge
    exceptions
      invalid-chargeid
        ✓ missing querystring chargeid
        ✓ invalid querystring chargeid
      invalid-account
        ✓ ineligible accessing account (12929ms)
    returns
      ✓ object (7076ms)

  /api/user/subscriptions/charges-count
    returns
      ✓ integer (15064ms)

  /api/user/subscriptions/charges
    exceptions
      invalid-accountid
        ✓ missing querystring accountid
        ✓ invalid querystring accountid
      invalid-account
        ✓ ineligible accessing account (38ms)
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/user/subscriptions/create-cancelation-refund
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid
      invalid-account
        ✓ ineligible accessing account (7152ms)
      invalid-subscription
        ✓ ineligible querystring subscription is not active (278776ms)
        ✓ ineligible querystring subscription is free (19985ms)
        ✓ ineligible querystring subscription is in free trial (40598ms)
    returns
      ✓ object (62452ms)

  /api/user/subscriptions/create-customer
    exceptions
      invalid-accountid
        ✓ missing querystring accountid
        ✓ invalid querystring accountid
      invalid-account
        ✓ ineligible accessing account
    returns
      ✓ object (201ms)

  /api/user/subscriptions/create-payment-intent
    exceptions
      invalid-customerid
        ✓ missing querystring customerid
        ✓ invalid querystring customerid
      invalid-account
        ✓ ineligible accessing account (1849ms)
        ✓ ineligible posted payment method (1659ms)
      invalid-paymentmethodid
        ✓ missing posted paymentmethodid (204ms)
        ✓ invalid posted paymentmethodid (194ms)
    object
      ✓ object (1820ms)

  /api/user/subscriptions/create-payment-method
    exceptions
      invalid-customerid
        ✓ missing querystring customerid
        ✓ invalid querystring customerid
      invalid-account
        ✓ ineligible accessing account (229ms)
    receives
      ✓ optionally-required posted name (202ms)
      ✓ optionally-required posted cvc (215ms)
      ✓ optionally-required posted number (204ms)
      ✓ optionally-required posted exp_month (233ms)
      ✓ optionally-required posted exp_year (192ms)
      ✓ optionally-required posted token (201ms)
    returns
      ✓ object (1733ms)
    configuration
      ✓ environment STRIPE_JS (215ms)

  /api/user/subscriptions/create-refund-request
    exceptions
      invalid-chargeid
        ✓ missing querystring chargeid
        ✓ invalid querystring chargeid
      invalid-charge
        ✓ ineligible querystring charge is refunded (44842ms)
        ✓ ineligible querystring charge has refund request (17295ms)
      invalid-account
        ✓ ineligible accessing account (8265ms)
    returns
      ✓ object (8910ms)

  /api/user/subscriptions/create-refund
    exceptions
      invalid-chargeid
        ✓ missing querystring chargeid
        ✓ invalid querystring chargeid
      invalid-charge
        ✓ ineligible querystring charge is refunded (8350ms)
        ✓ ineligible querystring charge is out of refund period (9007ms)
      invalid-account
        ✓ ineligible accessing account (8327ms)
    returns
      ✓ object (141643ms)
    configuration
      ✓ environment SUBSCRIPTION_REFUND_PERIOD (7910ms)

  /api/user/subscriptions/create-setup-intent
    exceptions
      invalid-customerid
        ✓ missing querystring customerid
        ✓ invalid querystring customerid
      invalid-account
        ✓ ineligible accessing account (1538ms)
      invalid-paymentmethodid
        ✓ missing posted paymentmethodid (216ms)
        ✓ invalid posted paymentmethodid (200ms)
    returns
      ✓ object (1551ms)

  /api/user/subscriptions/create-subscription
    exceptions
      invalid-customerid
        ✓ missing querystring customerid (515ms)
        ✓ invalid querystring customerid (629ms)
      invalid-customer
        ✓ ineligible querystring customer requires payment method (1006ms)
      invalid-account
        ✓ ineligible accessing account (883ms)
      invalid-planid
        ✓ missing posted planid (1598ms)
        ✓ invalid posted planid (1643ms)
      invalid-plan
        ✓ ineligible posted plan is not published (2014ms)
        ✓ ineligible posted plan is unpublished (2135ms)
    returns
      ✓ object (4114ms)

  /api/user/subscriptions/create-usage-record
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid
      invalid-subscription
        ✓ invalid querystring subscription is not "metered" (144378ms)
      invalid-account
        ✓ ineligible accessing account (8846ms)
      invalid-quantity
        ✓ invalid posted quantity is not integer (6037ms)
        ✓ invalid posted quantity is negative (8296ms)
      invalid-action
        ✓ missing posted action (5019ms)
        ✓ invalid posted action (8210ms)
      invalid-subscriptionitemid
        ✓ missing posted subscriptionitemid (5143ms)
        ✓ invalid posted subscriptionitemid (4989ms)
    receives
      ✓ required posted quantity (5418ms)
      ✓ required posted action (5643ms)
      ✓ required posted subscriptionitemid (5798ms)
    returns
      ✓ object (5903ms)

  /api/user/subscriptions/customer
    exceptions
      invalid-customerid
        ✓ missing querystring customerid
        ✓ invalid querystring customerid
      invalid-account
        ✓ ineligible accessing account (1771ms)
    returns
      ✓ object (1618ms)

  /api/user/subscriptions/customers
    exceptions
      invalid-accountid
        ✓ missing querystring accountid
        ✓ invalid querystring accountid
      invalid-account
        ✓ ineligible accessing account
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/user/subscriptions/delete-customer
    exceptions
      invalid-customerid
        ✓ missing querystring customerid
        ✓ invalid querystring customerid
      invalid-account
        ✓ ineligible accessing account (215ms)
    returns
      ✓ boolean (402ms)

  /api/user/subscriptions/delete-subscription
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid
      invalid-account
        ✓ ineligible accessing account (7105ms)
      invalid-subscription
        ✓ ineligible querystring subscription is not active (8449ms)
    returns
      ✓ boolean (7415ms)

  /api/user/subscriptions/invoice
    exceptions
      invalid-invoiceid
        ✓ missing querystring invoiceid
        ✓ invalid querystring invoiceid
      invalid-account
        ✓ ineligible accessing account (8257ms)
    returns
      ✓ object (6730ms)

  /api/user/subscriptions/invoices-count
    returns
      ✓ integer (20169ms)

  /api/user/subscriptions/invoices
    exceptions
      invalid-accountid
        ✓ missing querystring accountid
        ✓ invalid querystring accountid
      invalid-account
        ✓ ineligible accessing account (42ms)
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/user/subscriptions/payment-intent
    exceptions
      invalid-paymentintentid
        ✓ missing querystring invalid
        ✓ invalid querystring invalid
      invalid-account
        ✓ ineligible accessing account (1746ms)
    returns
      ✓ object (1685ms)

  /api/user/subscriptions/payment-intents-count
    returns
      ✓ integer (5217ms)

  /api/user/subscriptions/payment-intents
    exceptions
      invalid-accountid
        ✓ missing querystring accountid
        ✓ invalid querystring accountid
      invalid-account
        ✓ ineligible accessing account (56ms)
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/user/subscriptions/payment-method
    exceptions
      invalid-paymentmethodid
        ✓ missing querystring paymentmethodid
        ✓ invalid querystring paymentmethodid
      invalid-account
        ✓ ineligible accessing account (1608ms)
    returns
      ✓ object (1624ms)

  /api/user/subscriptions/payment-methods-count
    returns
      ✓ integer (3675ms)

  /api/user/subscriptions/payment-methods
    exceptions
      invalid-accountid
        ✓ missing querystring accountid
        ✓ invalid querystring accountid
      invalid-account
        ✓ ineligible accessing account
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/user/subscriptions/published-plan
    exceptions
      invalid-planid
        ✓ missing querystring planid
        ✓ invalid querystring planid (131ms)
      invalid-plan
        ✓ ineligible querystring plan is not published (676ms)
    returns
      ✓ object (663ms)

  /api/user/subscriptions/published-plans-count
    returns
      ✓ integer (1007ms)

  /api/user/subscriptions/published-plans
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/user/subscriptions/published-product
    exceptions
      invalid-productid
        ✓ missing querystring productid
        ✓ invalid querystring productid (125ms)
      invalid-product
        ✓ ineligible querystring product is not published (325ms)
    returns
      ✓ object (309ms)

  /api/user/subscriptions/published-products-count
    returns
      ✓ integer (354ms)

  /api/user/subscriptions/published-products
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/user/subscriptions/refund
    exceptions
      invalid-refundid
        ✓ missing querystring refundid (709ms)
        ✓ invalid querystring refundid (1170ms)
      invalid-account
        ✓ ineligible accessing account (10385ms)
    returns
      ✓ object (9216ms)

  /api/user/subscriptions/refunds-count
    returns
      ✓ integer (23075ms)

  /api/user/subscriptions/refunds
    exceptions
      invalid-accountid
        ✓ missing querystring accountid
        ✓ invalid querystring accountid
      invalid-account
        ✓ ineligible accessing account (44ms)
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/user/subscriptions/reset-subscription-canceling
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid
      invalid-subscription
        ✓ invalid querystring subscription is active (7473ms)
      invalid-account
        ✓ ineligible accessing account (7406ms)
    returns
      ✓ object (9135ms)

  /api/user/subscriptions/set-customer-coupon
    exceptions
      invalid-customerid
        ✓ missing querystring customerid (195ms)
        ✓ invalid querystring customerid (203ms)
      invalid-customer
        ✓ invalid querystring customer has coupon (1037ms)
      invalid-account
        ✓ ineligible account accessing (519ms)
      invalid-couponid
        ✓ missing posted couponid (209ms)
        ✓ invalid posted couponid (212ms)
      invalid-coupon
        ✓ invalid posted coupon is not published (513ms)
        ✓ invalid posted coupon is unpublished (715ms)
    returns
      ✓ object (834ms)

  /api/user/subscriptions/set-invoice-paid
    exceptions
      invalid-invoiceid
        ✓ missing querystring invoiceid
        ✓ invalid querystring invoiceid
      invalid-account
        ✓ ineligible accessing account (2869ms)
        ✓ ineligible posted payment method (8330ms)
      invalid-invoice
        ✓ invalid querystring invoice is paid (7369ms)
        ✓ invalid querystring invoice is marked uncollectable (5018ms)
      invalid-paymentmethodid
        ✓ missing posted paymentmethodid (2810ms)
        ✓ invalid posted paymentmethodid (2024ms)
    returns
      ✓ object (5617ms)

  /api/user/subscriptions/set-payment-intent-canceled
    exceptions
      invalid-paymentintentid
        ✓ missing querystring paymentintentid
        ✓ invalid querystring paymentintentid
      invalid-account
        ✓ ineligible accessing account (1583ms)
    returns
      ✓ object (1767ms)

  /api/user/subscriptions/set-payment-method-detached
    exceptions
      invalid-paymentmethodid
        ✓ missing querystring paymentmethodid
        ✓ invalid querystring paymentmethodid
      invalid-account
        ✓ ineligible accessing account (1524ms)
      invalid-paymentmethod
        ✓ invalid querystring payment method is default (1440ms)
    returns
      ✓ object (3370ms)

  /api/user/subscriptions/set-setup-intent-canceled
    exceptions
      invalid-setupintentid
        ✓ missing querystring setupintentid
        ✓ invalid querystring setupintentid
      invalid-account
        ✓ ineligible accessing account (2589ms)
    returns
      ✓ object (2883ms)

  /api/user/subscriptions/set-subscription-canceled
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid
      invalid-account
        ✓ ineligible accessing account (7681ms)
      invalid-subscription
        ✓ ineligible querystring subscription is not active (10144ms)
    returns
      ✓ object (7344ms)

  /api/user/subscriptions/set-subscription-coupon
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid
      invalid-subscription
        ✓ invalid querystring subscription has coupon (8726ms)
        ✓ invalid querystring subscription is canceling (8509ms)
      invalid-account
        ✓ ineligible accessing account (7422ms)
      invalid-couponid
        ✓ missing posted couponid (7371ms)
        ✓ invalid posted couponid (7334ms)
      invalid-coupon
        ✓ invalid posted coupon is not published (8023ms)
        ✓ invalid posted coupon is unpublished (7898ms)
        ✓ invalid posted coupon is other currency (8339ms)
    returns
      ✓ object (9338ms)

  /api/user/subscriptions/set-subscription-plan
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid
      invalid-account
        ✓ ineligible accessing account (16417ms)
      invalid-planid
        ✓ missing posted planid (9701ms)
        ✓ invalid posted planid (7013ms)
      invalid-plan
        ✓ invalid posted plan is not published (8272ms)
        ✓ invalid posted plan is unpublished (7489ms)
        ✓ invalid posted plan is unchanged (7829ms)
    invalid-paymentmethodid
      ✓ invalid customer requires payments method (6648ms)
    returns
      ✓ object (8255ms)

  /api/user/subscriptions/set-subscription-quantity
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid
      invalid-account
        ✓ ineligible accessing account (7439ms)
      invalid-quantity
        ✓ invalid posted quantity (7160ms)
        ✓ invalid posted quantity is unchanged (7198ms)
        ✓ invalid posted quantity is negative (6808ms)
        ✓ invalid posted quantity is zero (8290ms)
    returns
      ✓ object (7893ms)

  /api/user/subscriptions/set-subscription-tax-percent
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid
      invalid-account
        ✓ ineligible accessing account (7015ms)
      invalid-tax_percent
        ✓ invalid posted tax_percent (6927ms)
        ✓ invalid posted tax_percent is unchanged (8600ms)
        ✓ invalid posted tax_percent is negative (8009ms)
    returns
      ✓ object (6957ms)

  /api/user/subscriptions/setup-intent
    exceptions
      invalid-setupintentid
        ✓ missing querystring setupintentid
        ✓ invalid querystring setupintentid
      invalid-account
        ✓ ineligible accessing account (2924ms)
    returns
      ✓ object (2438ms)

  /api/user/subscriptions/setup-intents-count
    returns
      ✓ integer (4096ms)

  /api/user/subscriptions/setup-intents
    exceptions
      invalid-accountid
        ✓ missing querystring accountid
        ✓ invalid querystring accountid
      invalid-account
        ✓ ineligible accessing account (44ms)
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    configuration
      ✓ environment PAGE_SIZE

  /api/user/subscriptions/subscription
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid
      invalid-account
        ✓ ineligible accessing account (15126ms)
    returns
      ✓ object (8434ms)

  /api/user/subscriptions/subscriptions-count
    exceptions
      invalid-accountid
        ✓ missing querystring accountid
        ✓ invalid querystring accountid
      invalid-account
        ✓ ineligible accessing account
    returns
      ✓ integer (11105ms)

  /api/user/subscriptions/subscriptions
    exceptions
      invalid-accountid
        ✓ missing querystring accountid
        ✓ invalid querystring accountid
      invalid-account
        ✓ ineligible accessing account
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/user/subscriptions/upcoming-invoice
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid
      invalid-account
        ✓ ineligible accessing account (13740ms)
      invalid-subscription
        ✓ ineligible querystring subscription (14717ms)
    returns
      ✓ object (8246ms)

  /api/user/subscriptions/usage-record-summaries
    exceptions
      invalid-subscriptionitemid
        ✓ missing querystring subscriptionitemid
        ✓ invalid querystring subscriptionitemid
    receives
      ✓ optional querystring starting_after (string)
      ✓ optional querystring ending_before (string)
      ✓ optional querystring limit (integer)
    returns
      ✓ stripe list response
    configuration
      ✓ environment PAGE_SIZE


  966 passing (2h)

