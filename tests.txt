

  index
    STRIPE_JS
      Use client-side stripe.js in browser
        ✓ default unset
        ✓ Integer
    MAXIMUM_STRIPE_RETRIES
      Retry Stripe web requests
        ✓ default 0
        ✓ Integer
    SUBSCRIPTION_WEBHOOK_ENDPOINT_SECRET
      Secret provided by Stripe to sign webhooks
        ✓ String
    STRIPE_KEY
      The `sk_test_xxx` key from Stripe
        ✓ String
    STRIPE_PUBLISHABLE_KEY
      The `pk_test_xxx` key from Stripe
        ✓ String
    REQUIRE_SUBSCRIPTION
      Users must create subscription to access application
        ✓ default unset
        ✓ Boolean
    REQUIRE_PAYMENT
      Users must resolve unpaid invoices to access application
        ✓ default unset
        ✓ Boolean
    REQUIRE_PAYMENT_CONFIRMATION
      Users must resolve payment confirmations to access application
        ✓ default unset
        ✓ Boolean
    OVERDUE_INVOICE_THRESHOLD
      Duration in days to allow open invoices before enforcing payment
        ✓ default 1
        ✓ Integer
    START_SUBSCRIPTION_PATH
      Alternate URL path to your start subscription flow
        ✓ default /account/subscriptions/start-subscription
        ✓ String

  server/bind-stripekey
    after
      ✓ should bind data to req (58ms)

  server/require-payment-confirmation
    after
      ✓ should ignore guests
      ✓ should ignore user with pending confirmations requesting account pages (6330ms)
      ✓ should ignore administrators with pending confirmations requesting administration pages (6416ms)
      ✓ should ignore user without pending confirmation (7467ms)
      ✓ should require user confirm payment (5915ms)

  server/require-payment
    after
      ✓ should ignore guests
      ✓ should ignore user with amount owed requesting account pages (2691ms)
      ✓ should ignore administrator with amount owed requesting administration pages (2107ms)
      ✓ should ignore user without amount owed
      ✓ should ignore user with open but not overdue invoice (4784ms)
      ✓ should require user pay overdue invoice (6044ms)

  server/require-subscription
    after
      ✓ should ignore guests
      ✓ should ignore user without subscription requesting account pages
      ✓ should ignore administrator without subscription requesting administration pages
      ✓ should ignore user with active subscription (49754ms)
      ✓ should require user create subscription (38ms)

  /account/subscriptions/add-payment-method
    view
      ✓ should present the form for no stripe.js (978ms)
      ✓ should present the form for stripe.js v3 (1580ms)
    submit
      ✓ should require name for no stripe.js (6090ms)
      ✓ should require CVC for no stripe.js (6173ms)
      ✓ should require card number for no stripe.js (5844ms)
      ✓ should require expiration month for no stripe.js (6131ms)
      ✓ should require expiration year for no stripe.js (6254ms)
      ✓ should add payment information no stripe.js (screenshots) (69571ms)
      ✓ should add payment information stripe.js v3 (20799ms)

  /account/subscriptions/billing-profile
    before
      ✓ should reject invalid customer (245ms)
      ✓ should reject other account's customer (227ms)
      ✓ should bind data to req (221ms)
    view
      ✓ should have row for customer (screenshots) (20546ms)

  /account/subscriptions/billing-profiles
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /account/subscriptions/cancel-subscription
    exceptions
      ✓ should reject missing subscription
      ✓ should reject invalid subscription
      ✓ should reject canceled subscription
      ✓ should reject other account's subscription
    before
      ✓ should bind data to req
    view
      ✓ should present the form
      ✓ should show fields for free plan cancelations
      ✓ should show fields for free trial cancelations
      ✓ should show fields for cancelation with credit or refund
    submit
      ✓ should cancel free subscription immediately (screenshots)
      ✓ should cancel free subscription at period end
      ✓ should cancel free trial immediately
      ✓ should cancel free trial at period end
      ✓ should cancel paid subscription and credit account
      ✓ should cancel paid subscription and show refund

  /account/subscriptions/change-plan
    before
      ✓ should bind data to req
    view
      ✓ should present the form
      ✓ should remove the form if there are no plans
    submit
      ✓ should apply plan update (screenshots)
    errors
      ✓ should reject paid plan without payment information

  /account/subscriptions/confirm-payment
    before
      ✓ should bind data to req (6835ms)
    view
      ✓ should display stripe.js confirmation

  /account/subscriptions/confirm-subscription
    exceptions
      ✓ invalid-planid (179ms)
      ✓ invalid-plan
    before
      ✓ should bind data to req
    view
      ✓ should present the form
    submit
      ✓ should start subscription (screenshots)
    errors
      ✓ invalid-paymentmethodid

  /account/subscriptions/create-billing-profile
    view
      ✓ should present the form for no stripe.js (596ms)
      ✓ should present the form for stripe.js v3 (1374ms)
    submit
      ✓ should require description for no stripe.js (6794ms)
      ✓ should require email for no stripe.js (6465ms)
      ✓ should require name for no stripe.js (6752ms)
      ✓ should require CVC for no stripe.js (7396ms)
      ✓ should require card number for no stripe.js (6645ms)
      ✓ should require expiration month for no stripe.js (7271ms)
      ✓ should require expiration year for no stripe.js (7150ms)
      ✓ should require description for stripe.js v3 (18437ms)
      ✓ should require email for stripe.js v3 (18603ms)
      ✓ should create billing profile for no stripe.js (8607ms)
      ✓ should create billing profile for stripe.js v3 (screenshots) (109804ms)

  /account/subscriptions/delete-billing-profile
    exceptions
      ✓ invalid-customerid
      ✓ invalid-account
    before
      ✓ should bind data to req
    view
      ✓ should present the form
    submit
      ✓ should delete billing profile (screenshots)

  /account/subscriptions
    before
      ✓ should bind data to req
    view
      ✓ should have row for each invoice
      ✓ should have row for each customer
      ✓ should have row for each subscription

  /account/subscriptions/invoice
    exceptions
      ✓ invalid-invoiceid
      ✓ invalid-account
    before
      ✓ should bind data to req
    view
      ✓ should have row for invoice (screenshots)

  /account/subscriptions/invoices
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /account/subscriptions/pay-invoice
    exceptions
      ✓ should reject invalid invoice
      ✓ invalid-account
      ✓ should reject paid invoice
    before
      ✓ should bind data to req
    view
      ✓ should present the form
    submit
      ✓ should pay invoice (screenshots)

  /account/subscriptions/plan
    before
      ✓ should reject invalid plan (152ms)
      ✓ should reject never published plan (649ms)
      ✓ should reject unpublished plan (847ms)
      ✓ should bind data to req (683ms)
    view
      ✓ should have row for plan (screenshots) (19601ms)

  /account/subscriptions/plans
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /account/subscriptions/refund-invoice
    exceptions
      ✓ invalid-invoiceid
      ✓ invalid-account
    before
      ✓ should bind data to req
    view
      ✓ should present the form
    submit
      ✓ should cancel subscription (screenshots)

  /account/subscriptions/refunds
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /account/subscriptions/request-refund
    exceptions
      ✓ invalid-invoice
      ✓ invalid-account
    before
      ✓ should bind data to req
    view
      ✓ should present the form
    submit
      ✓ should create refund request (screenshots)

  /account/subscriptions/subscription
    exceptions
      ✓ invalid-subscriptionid (509ms)
      ✓ invalid-account
    before
      ✓ should bind data to req
    view
      ✓ should present the subscription table (screenshots)

  /account/subscriptions/subscriptions
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /administrator/subscriptions/apply-customer-coupon
    exceptions
      ✓ should reject invalid customer (182ms)
      ✓ should reject customer with coupon (2030ms)
    before
      ✓ should bind data to req (817ms)
    view
      ✓ should present the form (1331ms)
    submit
      ✓ should apply coupon (screenshots) (36858ms)

  /administrator/subscriptions/apply-subscription-coupon
    exceptions
      ✓ should reject invalid subscription (152ms)
      ✓ should reject canceling subscription (7964ms)
      ✓ should reject free subscription (9525ms)
      ✓ should reject subscription with coupon (8680ms)
    before
      ✓ should bind data to req (7104ms)
    view
      ✓ should present the form (7654ms)
    submit
      ✓ should apply coupon (screenshots) (43882ms)

  /administrator/subscriptions/charge
    before
      ✓ should reject invalid charge (804ms)
      ✓ should bind data to req (7294ms)
    view
      ✓ should present the charge table (screenshots) (31157ms)

  /administrator/subscriptions/charges
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /administrator/subscriptions/coupon
    before
      ✓ should reject invalid coupon (146ms)
      ✓ should bind data to req (295ms)
    view
      ✓ should present the coupon table (screenshots) (23385ms)

  /administrator/subscriptions/coupons
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /administrator/subscriptions/create-coupon
    view
      ✓ should present the form (576ms)
    submit
      ✓ should reject missing couponid (1336ms)
      ✓ should enforce couponid length (2163ms)
      ✓ should reject duplicate couponid (2014ms)
      ✓ should reject missing duration (1757ms)
      ✓ should enforce invalid duration (1728ms)
      ✓ should require valid amount off (1825ms)
      ✓ should require valid percent off (1709ms)
      ✓ should require valid max redemptions (1783ms)
      ✓ should require amount or percent off (1634ms)
      ✓ should require valid duration in months if repeating (1876ms)
      ✓ should require valid redeem_by if provided (2039ms)
      ✓ should create coupon (screenshots) (30917ms)

  /administrator/subscriptions/create-plan
    view
      ✓ should present the form (789ms)
    submit
      ✓ should reject missing planid (1737ms)
      ✓ should enforce planid length (2615ms)
      ✓ should reject missing productid (1644ms)
      ✓ should reject never published product (2090ms)
      ✓ should reject unpublished product (2297ms)
      ✓ should reject missing currency (2060ms)
      ✓ should reject invalid currency (2179ms)
      ✓ should reject missing usage_type (2090ms)
      ✓ should reject missing amount (2043ms)
      ✓ should reject invalid amount (2100ms)
      ✓ should reject missing interval (2113ms)
      ✓ should reject invalid interval (2126ms)
      ✓ should reject invalid interval_count (2055ms)
      ✓ should reject invalid trial_period_days (2197ms)
      ✓ should create plan (screenshots) (31354ms)

  /administrator/subscriptions/create-product
    view
      ✓ should present the form (476ms)
    submit
      ✓ should reject missing name (1325ms)
      ✓ should enforce name length (2230ms)
      ✓ should reject missing statement_descriptor (1271ms)
      ✓ should create product (screenshots) (30539ms)

  /administrator/subscriptions/customer
    before
      ✓ should reject invalid customer (372ms)
      ✓ should bind data to req (218ms)
    view
      ✓ should present the customer table (screenshots) (20107ms)

  /administrator/subscriptions/customers
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /administrator/subscriptions/delete-coupon
    exceptions
      ✓ should reject invalid couponid (149ms)
    before
      ✓ should bind data to req (310ms)
    view
      ✓ should present the form (769ms)
    submit
      ✓ should delete coupon (screenshots) (35761ms)

  /administrator/subscriptions/delete-plan
    exceptions
      ✓ should reject invalid planid (153ms)
    before
      ✓ should bind data to req (628ms)
    view
      ✓ should present the form (1110ms)
    submit
      ✓ should delete plan (screenshots) (35724ms)

  /administrator/subscriptions/delete-product
    exceptions
      ✓ should reject invalid productid (140ms)
    before
      ✓ should bind data to req (301ms)
    view
      ✓ should present the form (739ms)
    submit
      ✓ should delete product (screenshots) (34270ms)

  /administrator/subscriptions/delete-subscription
    exceptions
      ✓ should reject missing subscription
      ✓ should reject invalid subscription
      ✓ should reject canceled subscription
    before
      ✓ should bind data to req
    view
      ✓ should present the form
      ✓ should show fields for free plan cancelations
      ✓ should show fields for free trial cancelations
      ✓ should show fields for cancelation with credit or refund
    submit
      ✓ should cancel free subscription immediately (screenshots) (5202ms)
      ✓ should cancel free subscription at period end
      ✓ should cancel free trial immediately
      ✓ should cancel free trial at period end
      ✓ should cancel paid subscription and credit account
      ✓ should cancel paid subscription and show refund

  /administrator/subscriptions/deny-refund
    exceptions
      ✓ should reject invalid chargeid (154ms)
      ✓ should reject charge without refund request (7825ms)
      ✓ should reject denied refund (8340ms)
    before
      ✓ should bind data to req (8044ms)
    view
      ✓ should present the form (10133ms)
    submit
      ✓ should deny refund (screenshots) (48399ms)

  /administrator/subscriptions/edit-coupon
    before
      ✓ should reject invalid couponid
      ✓ should reject unpublished coupon (468ms)
      ✓ should bind data to req (307ms)
    view
      ✓ should present the form (734ms)
    submit
      ✓ should reject missing name (1358ms)
      ✓ should update coupon (screenshots) (36277ms)

  /administrator/subscriptions/edit-plan
    before
      ✓ should reject invalid planid (161ms)
      ✓ should reject unpublished plan (834ms)
      ✓ should bind data to req (731ms)
    view
      ✓ should present the form (1269ms)
    submit
      ✓ should reject missing productid (1912ms)
      ✓ should reject invalid trial period (2438ms)
      ✓ should update plan (screenshots) (38590ms)

  /administrator/subscriptions/edit-product
    before
      ✓ should reject invalid productid (146ms)
      ✓ should reject unpublished product (536ms)
      ✓ should bind data to req (292ms)
    view
      ✓ should present the form (779ms)
    submit
      ✓ should reject missing name (1527ms)
      ✓ should enforce name length (2402ms)
      ✓ should reject missing statement_descriptor (1533ms)
      ✓ should reject invalid unit_label (1815ms)
      ✓ should update product (screenshots) (38502ms)

  /administrator/subscriptions/flag-charge
    exceptions
      ✓ should reject invalid chargeid (146ms)
      ✓ should reject flagged charge
    before
      ✓ should bind data to req
    view
      ✓ should present the form
    submit
      ✓ should flag charge (screenshots)

  /administrator/subscriptions/forgive-invoice
    exceptions
      ✓ should reject invalid invoiceid (141ms)
      ✓ should reject paid invoice (7042ms)
      ✓ should reject uncollectible invoice (2485ms)
    before
      ✓ should bind data to req (2178ms)
    view
      ✓ should present the form (2820ms)
    submit
      ✓ should forgive invoice (screenshots) (35980ms)

  /administrator/subscriptions
    before
      ✓ should bind data to req (7823ms)
    view
      ✓ should have row for each plan (1589ms)
      ✓ should have row for each coupon (1047ms)
      ✓ should have row for each subscription (screenshots) (24133ms)

  /administrator/subscriptions/invoice
    before
      ✓ should reject invalid invoiceid (145ms)
      ✓ should bind data to req (6774ms)
    view
      ✓ should present the invoice table (screenshots) (29926ms)

  /administrator/subscriptions/invoices
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /administrator/subscriptions/payment-intent
    before
      ✓ should reject invalid paymentintentid
      ✓ should bind data to req (1660ms)
    view
      ✓ should have row for payment intent (screenshots) (25248ms)

  /administrator/subscriptions/payment-intents
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /administrator/subscriptions/payment-method
    before
      ✓ should reject invalid paymentmethodid
      ✓ should bind data to req (1782ms)
    view
      ✓ should have row for payment method (screenshots) (24651ms)

  /administrator/subscriptions/payment-methods
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /administrator/subscriptions/payout
    before
      ✓ should reject invalid payoutid (154ms)

  /administrator/subscriptions/plan
    before
      ✓ should reject invalid planid (162ms)
      ✓ should bind data to req (617ms)
    view
      ✓ should present the plan table (screenshots) (23595ms)

  /administrator/subscriptions/plans
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /administrator/subscriptions/product
    before
      ✓ should reject invalid productid (144ms)
      ✓ should bind data to req (283ms)
    view
      ✓ should have row for product (screenshots) (22157ms)

  /administrator/subscriptions/products
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /administrator/subscriptions/publish-coupon
    exceptions
      ✓ should reject invalid couponid (151ms)
      ✓ should reject published coupon (457ms)
    before
      ✓ should bind data to req (317ms)
    view
      ✓ should present the form (761ms)
    submit
      ✓ should publish coupon (screenshots) (35076ms)

  /administrator/subscriptions/publish-plan
    exceptions
      ✓ should reject invalid planid (155ms)
      ✓ should reject published plan (627ms)
    before
      ✓ should bind data to req (639ms)
    view
      ✓ should present the form (1255ms)
    submit
      ✓ should publish plan (screenshots) (36115ms)

  /administrator/subscriptions/publish-product
    exceptions
      ✓ should reject invalid productid (148ms)
      ✓ should reject published product (323ms)
    before
      ✓ should bind data to req (285ms)
    view
      ✓ should present the form (765ms)
    submit
      ✓ should publish product (screenshots) (34277ms)

  /administrator/subscriptions/refund-charge
    exceptions
      ✓ should reject invalid chargeid (281ms)
      ✓ should reject refunded charge
    before
      ✓ should bind data to req
    view
      ✓ should present the form
    submit
      ✓ should refund charge (screenshots)

  /administrator/subscriptions/refund-requests
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /administrator/subscriptions/refund
    before
      ✓ should reject invalid refundid (149ms)
      ✓ should bind data to req (9926ms)
    view
      ✓ should have row for refund (screenshots) (33942ms)

  /administrator/subscriptions/refunds
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /administrator/subscriptions/revoke-customer-coupon
    exceptions
      ✓ should reject invalid customer (142ms)
      ✓ should reject customer without discount (875ms)
    before
      ✓ should bind data to req (1344ms)
    view
      ✓ should present the form (1846ms)
    submit
      ✓ should remove coupon (screenshots) (34014ms)

  /administrator/subscriptions/revoke-subscription-coupon
    exceptions
      ✓ should reject invalid subscription (142ms)
      ✓ should reject subscription without discount (19737ms)
    before
      ✓ should bind data to req (13757ms)
    view
      ✓ should present the form (10312ms)
    submit
      ✓ should remove coupon (screenshots) (45423ms)

  /administrator/subscriptions/setup-intent
    before
      ✓ should reject invalid setupintentid
      ✓ should bind data to req (3143ms)
    view
      ✓ should have row for setup intent (screenshots) (25990ms)

  /administrator/subscriptions/setup-intents
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /administrator/subscriptions/subscription
    before
      ✓ should reject invalid subscriptionid (150ms)
      ✓ should bind data to req (7629ms)
    view
      ✓ should present the subscription table (screenshots) (29411ms)

  /administrator/subscriptions/subscriptions
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /administrator/subscriptions/unpublish-coupon
    exceptions
      ✓ should reject invalid couponid (141ms)
      ✓ should reject never published coupon (292ms)
      ✓ should reject unpublished coupon (511ms)
    before
      ✓ should bind data to req (301ms)
    view
      ✓ should present the form (754ms)
    submit
      ✓ should unpublish coupon (screenshots) (35899ms)

  /administrator/subscriptions/unpublish-plan
    exceptions
      ✓ should reject invalid planid (178ms)
      ✓ should never published plan (649ms)
      ✓ should reject unpublished plan (974ms)
    before
      ✓ should bind data to req (667ms)
    view
      ✓ should present the form (1170ms)
    submit
      ✓ should unpublish plan (screenshots) (36158ms)

  /administrator/subscriptions/unpublish-product
    exceptions
      ✓ should reject invalid productid (171ms)
      ✓ should never published product (434ms)
      ✓ should reject unpublished product (441ms)
    before
      ✓ should bind data to req (283ms)
    view
      ✓ should present the form (788ms)
    submit
      ✓ should unpublish product (screenshots) (34000ms)

  /api/administrator/subscriptions/charge
    exceptions
      invalid-chargeid
        ✓ missing querystring chargeid
        ✓ invalid querystring chargeid (147ms)
    returns
      ✓ object (7078ms)

  /api/administrator/subscriptions/charges-count
    returns
      ✓ integer (23891ms)

  /api/administrator/subscriptions/charges
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/administrator/subscriptions/coupon
    exceptions
      invalid-couponid
        ✓ missing querystring couponid
        ✓ invalid querystring couponid (143ms)
    returns
      ✓ object (299ms)

  /api/administrator/subscriptions/coupons-count
    returns
      ✓ integer (533ms)

  /api/administrator/subscriptions/coupons
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/administrator/subscriptions/create-cancelation-refund
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid (156ms)
      invalid-subscription
        ✓ ineligible querystring subscription is not active (8030ms)
    returns
      ✓ object (7962ms)

  /api/administrator/subscriptions/create-coupon
    exceptions
      invalid-couponid
        ✓ missing posted couponid
        ✓ invalid posted couponid is not alphanumeric_
      invalid-amount_off
        ✓ missing posted amount_off
        ✓ invalid posted amount_off
      invalid-currency
        ✓ missing posted currency
        ✓ invalid posted currency
      invalid-percent_off
        ✓ invalid posted percent_off
      invalid-duration
        ✓ invalid posted duration
      invalid-duration_in_months
        ✓ missing posted duration_in_months
        ✓ invalid posted duration_in_months
      invalid-redeem_by_meridiem
        ✓ invalid posted redeem_by_meridiem
      invalid-redeem_by
        ✓ invalid posted redeem_by
    receives
      ✓ required posted duration
      ✓ optionally-required posted amount_off (integer, or percent_off)
      ✓ optionally-required posted currency (string, if amount_off)
      ✓ optionally-required posted percent_off (integer, or amount_off)
      ✓ optionally-required posted expire date 
      ✓ optionally-required posted duration_in_months
    returns
      ✓ object (176ms)

  /api/administrator/subscriptions/create-plan
    exceptions
      invalid-planid
        ✓ invalid posted planid is not alphanumeric_ (166ms)
      invalid-planid-length
        ✓ posted planid is too short (190ms)
        ✓ posted planid is too long (164ms)
      invalid-productid
        ✓ missing posted productid (198ms)
        ✓ invalid posted productid (321ms)
      invalid-product
        ✓ ineligible posted product is not published (296ms)
      invalid-amount
        ✓ missing posted amount (286ms)
        ✓ invalid posted amount (277ms)
      invalid-currency
        ✓ missing posted currency (199ms)
        ✓ invalid posted currency (173ms)
      invalid-interval
        ✓ missing posted interval (295ms)
        ✓ invalid posted interval (292ms)
      invalid-interval-count
        ✓ missing posted interval_count (306ms)
        ✓ invalid posted interval_count (291ms)
      invalid-trial_period
        ✓ invalid posted trial_period (289ms)
      invalid-usage_type
        ✓ invalid posted usage_type (305ms)
    receives
      ✓ optional posted published (boolean) (495ms)
      ✓ optional posted trial_period_days (integer) (517ms)
      ✓ optional posted usage_type (licensed|metered) (483ms)
    returns
      ✓ object (465ms)
    configuration
      ✓ environment MINIMUM_PLANID_LENGTH (163ms)
      ✓ environment MAXIMUM_PLANID_LENGTH (166ms)

  /api/administrator/subscriptions/create-product
    exceptions
      invalid-name
        ✓ missing posted name
      invalid-product-name-length
        ✓ posted name too short
        ✓ posted name too long
      invalid-statement_descriptor
        ✓ missing posted statement_descriptor
    receives
      ✓ optional posted published (boolean) (337ms)
    returns
      ✓ object (310ms)
    configuration
      ✓ environment MINIMUM_PRODUCT_NAME_LENGTH
      ✓ environment MAXIMUM_PRODUCT_NAME_LENGTH

  /api/administrator/subscriptions/create-refund
    exceptions
      invalid-chargeid
        ✓ missing querystring chargeid
        ✓ invalid querystring chargeid (147ms)
      invalid-amount
        ✓ missing posted amount
        ✓ invalid posted amount
        ✓ invalid posted amount is negative
        ✓ invalid posted amount exceeds charge
    returns
      ✓ object

  /api/administrator/subscriptions/customer
    exceptions
      invalid-customerid
        ✓ missing querystring customerid
        ✓ invalid querystring customerid (165ms)
    returns
      ✓ object (2678ms)

  /api/administrator/subscriptions/customers-count
    returns
      ✓ integer (408ms)

  /api/administrator/subscriptions/customers
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/administrator/subscriptions/delete-coupon
    exceptions
      invalid-couponid
        ✓ missing querystring couponid
        ✓ invalid querystring couponid (142ms)
    returns
      ✓ boolean (454ms)

  /api/administrator/subscriptions/delete-plan
    exceptions
      invalid-planid
        ✓ missing querystring planid
        ✓ invalid querystring planid (153ms)
    returns
      ✓ boolean (1010ms)

  /api/administrator/subscriptions/delete-product
    exceptions
      invalid-productid
        ✓ missing querystring productid
        ✓ invalid querystring productid (147ms)
    returns
      ✓ boolean (500ms)

  /api/administrator/subscriptions/delete-subscription
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid (143ms)
      invalid-subscription
        ✓ ineligible querystring subscription is not active (9606ms)
    returns
      ✓ boolean (7848ms)

  /api/administrator/subscriptions/invoice
    exceptions
      invalid-invoiceid
        ✓ missing querystring invoiceid
        ✓ invalid querystring invoiceid (131ms)
    returns
      ✓ object (6929ms)

  /api/administrator/subscriptions/invoices-count
    returns
      ✓ integer (30824ms)

  /api/administrator/subscriptions/invoices
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/administrator/subscriptions/payment-intent
    exceptions
      invalid-paymentintentid
        ✓ missing querystring paymentintentid
        ✓ invalid querystring paymentintentid
    returns
      ✓ object (2030ms)

  /api/administrator/subscriptions/payment-intents-count
    returns
      ✓ integer (5100ms)

  /api/administrator/subscriptions/payment-intents
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/administrator/subscriptions/payment-method
    exceptions
      invalid-paymentmethodid
        ✓ missing querystring paymentmethodid
        ✓ invalid querystring paymentmethodid
    returns
      ✓ object (1439ms)

  /api/administrator/subscriptions/payment-methods-count
    returns
      ✓ integer (4243ms)

  /api/administrator/subscriptions/payment-methods
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/administrator/subscriptions/plan
    exceptions
      invalid-planid
        ✓ missing querystring planid
        ✓ invalid querystring planid (149ms)
    returns
      ✓ object (684ms)

  /api/administrator/subscriptions/plans-count
    returns
      ✓ integer (1146ms)

  /api/administrator/subscriptions/plans
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/administrator/subscriptions/product
    exceptions
      invalid-productid
        ✓ missing querystring productid
        ✓ invalid querystring productid (449ms)
    returns
      ✓ object (308ms)

  /api/administrator/subscriptions/products-count
    returns
      ✓ integer (617ms)

  /api/administrator/subscriptions/products
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/administrator/subscriptions/refund-requests-count
    returns
      ✓ integer (23395ms)

  /api/administrator/subscriptions/refund-requests
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/administrator/subscriptions/refund
    exceptions
      ✓ invalid querystring refundid
      ✓ missing querystring refundid (150ms)
    returns
      ✓ object (8878ms)

  /api/administrator/subscriptions/refunds-count
    returns
      ✓ integer (25534ms)

  /api/administrator/subscriptions/refunds
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/administrator/subscriptions/reset-customer-coupon
    exceptions
      invalid-customerid
        ✓ missing querystring customerid
        ✓ invalid querystring customerid (132ms)
      invalid-customeir
        ✓ invalid querystring customer has no discount (223ms)
    receives
      ✓ object (925ms)

  /api/administrator/subscriptions/reset-subscription-coupon
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid (136ms)
      invalid-subscription
        ✓ ineligible querystring subscription has no discount (8119ms)
    returns
      ✓ object (9102ms)

  /api/administrator/subscriptions/set-charge-flagged
    exceptions
      invalid-chargeid
        ✓ missing querystring charge
        ✓ invalid querystring charge (155ms)
      invalid-charge
        ✓ ineligible querystring charge is already flagged (8416ms)
    returns
      ✓ object (7438ms)

  /api/administrator/subscriptions/set-coupon-published
    exceptions
      invalid-couponid
        ✓ missing querystring couponid
        ✓ invalid querystring couponid (140ms)
      invalid-coupon
        ✓ ineligible querystring coupon is published (314ms)
        ✓ ineligible querystring coupon is unpublished (287ms)
    returns
      ✓ object (485ms)

  /api/administrator/subscriptions/set-coupon-unpublished
    exceptions
      invalid-couponid
        ✓ missing querystring couponid
        ✓ invalid querystring couponid (144ms)
      invalid-coupon
        ✓ ineligible querystring coupon is not published (345ms)
        ✓ ineligible querystring coupon is already unpublished (514ms)
    returns
      ✓ object (477ms)

  /api/administrator/subscriptions/set-invoice-uncollectible
    exceptions
      invalid-invoiceid
        ✓ missing querystring invoiceid (138ms)
        ✓ invalid querystring invoiceid (147ms)
      invalid-invoice
        ✓ invalid querystring invoice is paid (8999ms)
        ✓ invalid querystring invoice is marked uncollectable (4529ms)
    returns
      ✓ object (4813ms)

  /api/administrator/subscriptions/set-plan-published
    exceptions
      invalid-planid
        ✓ missing querystring planid
        ✓ invalid querystring planid (147ms)
      invalid-plan
        ✓ ineligible querystring plan is published (623ms)
    returns
      ✓ object (808ms)

  /api/administrator/subscriptions/set-plan-unpublished
    exceptions
      invalid-planid
        ✓ missing querystring planid
        ✓ invalid querystring planid (141ms)
      invalid-plan
        ✓ ineligible querystring plan is not published (630ms)
        ✓ ineligible querystring plan is already unpublished (858ms)
    returns
      ✓ object (1138ms)

  /api/administrator/subscriptions/set-product-published
    exceptions
      invalid-productid
        ✓ missing querystring productid (300ms)
        ✓ invalid querystring productid (298ms)
      invalid-product
        ✓ invalid querystring product is already published (319ms)
    returns
      ✓ object (472ms)

  /api/administrator/subscriptions/set-product-unpublished
    exceptions
      invalid-productid
        ✓ missing querystring productid (185ms)
        ✓ invalid querystring productid (292ms)
      invalid-product
        ✓ ineligible querystring product is not published (300ms)
        ✓ ineligible querystring product is already unpublished (496ms)
    returns
      ✓ object (487ms)

  /api/administrator/subscriptions/set-refund-request-denied
    exceptions
      invalid-chargeid
        ✓ missing querystring chargeid
        ✓ invalid querystring chargeid (152ms)
      invalid-charge
        ✓ ineligible querystring charge has no refund request (6903ms)
        ✓ ineligible querystring charge has denied request already (8585ms)
    returns
      ✓ object (7405ms)

  /api/administrator/subscriptions/set-subscription-canceled
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid (137ms)
      invalid-subscription
        ✓ ineligible querystring subscription is not active (8150ms)
    returns
      ✓ object (7825ms)

  /api/administrator/subscriptions/set-subscription-coupon
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid
      invalid-subscription
        ✓ ineligible subscription is canceling (8247ms)
        ✓ ineligible subscription has coupon (9130ms)
      invalid-couponid
        ✓ missing posted couponid (6392ms)
        ✓ invalid posted couponid (6731ms)
      invalid-coupon
        ✓ ineligible posted coupon is not published (7403ms)
        ✓ ineligible posted coupon is unpublished (8429ms)
    returns
      ✓ object (8152ms)

  /api/administrator/subscriptions/setup-intent
    exceptions
      invalid-setupintentid
        ✓ missing querystring setupintentid
        ✓ invalid querystring setupintentid
    returns
      ✓ object (2742ms)

  /api/administrator/subscriptions/setup-intents-count
    returns
      ✓ integer (3717ms)

  /api/administrator/subscriptions/setup-intents
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/administrator/subscriptions/subscription
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid (140ms)
    returns
      ✓ object (7895ms)

  /api/administrator/subscriptions/subscriptions-count
    returns
      ✓ integer (23104ms)

  /api/administrator/subscriptions/subscriptions
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/administrator/subscriptions/update-coupon
    exceptions
      invalid-couponid
        ✓ missing querystring couponid
        ✓ invalid querystring couponid (137ms)
      invalid-coupon
        ✓ ineligible querystring coupon is unpublished (471ms)
      invalid-name
        ✓ missing posted name (333ms)
        ✓ invalid posted name (299ms)
    receives
      ✓ required posted name (443ms)
    returns
      ✓ object (617ms)

  /api/administrator/subscriptions/update-plan
    exceptions
      invalid-planid
        ✓ missing querystring planid
        ✓ invalid querystring planid (149ms)
      invalid-plan
        ✓ ineligible querystring plan is unpublished (1005ms)
      invalid-productid
        ✓ invalid posted productid (750ms)
      invalid-product
        ✓ ineligible posted product is not published (871ms)
        ✓ ineligible posted product is unpublished (1048ms)
      invalid-trial_period_days
        ✓ invalid posted trial_period_days (935ms)
        ✓ ineligible posted trial_period_days is negative (1059ms)
        ✓ ineligible posted trial_period_days greater than 365 (1010ms)
    receives
      ✓ optional posted trial_period_days (integer) (862ms)
    returns
      ✓ object (1207ms)

  /api/administrator/subscriptions/update-product
    exceptions
      invalid-productid
        ✓ missing querystring productid (169ms)
        ✓ invalid querystring productid (303ms)
      invalid-product
        ✓ ineligible querystring product is unpublished (463ms)
      invalid-name
        ✓ invalid posted name (280ms)
      invalid-name-length
        ✓ posted name too short (324ms)
        ✓ posted name too long (294ms)
      invalid-statement_descriptor
        ✓ invalid posted statement_descriptor (290ms)
      invalid-statement_descriptor-length
        ✓ posted statement_descriptor too short (299ms)
        ✓ posted statement_descriptor too long (302ms)
      invalid-unit_label
        ✓ missing posted unit_label (335ms)
    receives
      ✓ optional posted name (452ms)
      ✓ optional posted statement_descriptor (451ms)
      ✓ optional posted unit_label (470ms)
    returns
      ✓ object (487ms)
    configuration
      ✓ environment MINIMUM_PRODUCT_NAME_LENGTH (302ms)
      ✓ environment MAXIMUM_PRODUCT_NAME_LENGTH (277ms)

  /api/administrator/subscriptions/usage-record-summaries
    exceptions
      invalid-subscriptionitemid
        ✓ missing querystring subscriptionitemid
        ✓ invalid querystring subscriptionitemid
    receives
      ✓ optional querystring starting_after (string)
      ✓ optional querystring ending_before (string)
      ✓ optional querystring limit (integer)
    returns
      ✓ stripe list response
    configuration
      ✓ environment PAGE_SIZE

  /api/user/subscriptions/charge
    exceptions
      invalid-chargeid
        ✓ missing querystring chargeid
        ✓ invalid querystring chargeid
      invalid-account
        ✓ ineligible accessing account (10842ms)
    returns
      ✓ object (6524ms)

  /api/user/subscriptions/charges-count
    returns
      ✓ integer (16821ms)

  /api/user/subscriptions/charges
    exceptions
      invalid-accountid
        ✓ missing querystring accountid
        ✓ invalid querystring accountid
      invalid-account
        ✓ ineligible accessing account
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/user/subscriptions/create-cancelation-refund
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid
      invalid-account
        ✓ ineligible accessing account (7114ms)
      invalid-subscription
        ✓ ineligible querystring subscription is not active (8554ms)
        ✓ ineligible querystring subscription is free (6491ms)
        ✓ ineligible querystring subscription is in free trial (7821ms)
    returns
      ✓ object (10039ms)

  /api/user/subscriptions/create-customer
    exceptions
      invalid-accountid
        ✓ missing querystring accountid
        ✓ invalid querystring accountid
      invalid-account
        ✓ ineligible accessing account
    returns
      ✓ object (229ms)

  /api/user/subscriptions/create-payment-intent
    exceptions
      invalid-customerid
        ✓ missing querystring customerid
        ✓ invalid querystring customerid
      invalid-account
        ✓ ineligible accessing account (1530ms)
        ✓ ineligible posted payment method (2067ms)
      invalid-paymentmethodid
        ✓ missing posted paymentmethodid (217ms)
        ✓ invalid posted paymentmethodid (214ms)
    object
      ✓ object (1844ms)

  /api/user/subscriptions/create-payment-method
    exceptions
      invalid-customerid
        ✓ missing querystring customerid
        ✓ invalid querystring customerid
      invalid-account
        ✓ ineligible accessing account (275ms)
    receives
      ✓ optionally-required posted name (229ms)
      ✓ optionally-required posted cvc (227ms)
      ✓ optionally-required posted number (244ms)
      ✓ optionally-required posted exp_month (223ms)
      ✓ optionally-required posted exp_year (192ms)
      ✓ optionally-required posted token (263ms)
    returns
      ✓ object (1427ms)
    configuration
      ✓ environment STRIPE_JS (256ms)

  /api/user/subscriptions/create-refund-request
    exceptions
      invalid-chargeid
        ✓ missing querystring chargeid
        ✓ invalid querystring chargeid
      invalid-charge
        ✓ ineligible querystring charge is refunded (8476ms)
        ✓ ineligible querystring charge has refund request (9373ms)
      invalid-account
        ✓ ineligible accessing account (9040ms)
    returns
      ✓ object (7160ms)

  /api/user/subscriptions/create-refund
    exceptions
      invalid-chargeid
        ✓ missing querystring chargeid
        ✓ invalid querystring chargeid
      invalid-charge
        ✓ ineligible querystring charge is refunded (9950ms)
        ✓ ineligible querystring charge is out of refund period (7160ms)
      invalid-account
        ✓ ineligible accessing account (7204ms)
    returns
      ✓ object (8562ms)
    configuration
      ✓ environment SUBSCRIPTION_REFUND_PERIOD (7431ms)

  /api/user/subscriptions/create-setup-intent
    exceptions
      invalid-customerid
        ✓ missing querystring customerid
        ✓ invalid querystring customerid
      invalid-account
        ✓ ineligible accessing account (1536ms)
      invalid-paymentmethodid
        ✓ missing posted paymentmethodid (217ms)
        ✓ invalid posted paymentmethodid (241ms)
    returns
      ✓ object (1685ms)

  /api/user/subscriptions/create-subscription
    exceptions
      invalid-customerid
        ✓ missing querystring customerid (558ms)
        ✓ invalid querystring customerid (647ms)
      invalid-customer
        ✓ ineligible querystring customer requires payment method (820ms)
      invalid-account
        ✓ ineligible accessing account (1084ms)
      invalid-planid
        ✓ missing posted planid (1591ms)
        ✓ invalid posted planid (1677ms)
      invalid-plan
        ✓ ineligible posted plan is not published (2069ms)
        ✓ ineligible posted plan is unpublished (2208ms)
    returns
      ✓ object (3971ms)

  /api/user/subscriptions/create-usage-record
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid
      invalid-subscription
        ✓ invalid querystring subscription is not "metered" (7989ms)
      invalid-account
        ✓ ineligible accessing account (4804ms)
      invalid-quantity
        ✓ invalid posted quantity is not integer (4521ms)
        ✓ invalid posted quantity is negative (5270ms)
      invalid-action
        ✓ missing posted action (5641ms)
        ✓ invalid posted action (5172ms)
      invalid-subscriptionitemid
        ✓ missing posted subscriptionitemid (5162ms)
        ✓ invalid posted subscriptionitemid (4796ms)
    receives
      ✓ required posted quantity (5199ms)
      ✓ required posted action (5601ms)
      ✓ required posted subscriptionitemid (5491ms)
    returns
      ✓ object (5176ms)

  /api/user/subscriptions/customer
    exceptions
      invalid-customerid
        ✓ missing querystring customerid
        ✓ invalid querystring customerid
      invalid-account
        ✓ ineligible accessing account (1374ms)
    returns
      ✓ object (1426ms)

  /api/user/subscriptions/customers
    exceptions
      invalid-accountid
        ✓ missing querystring accountid
        ✓ invalid querystring accountid
      invalid-account
        ✓ ineligible accessing account
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/user/subscriptions/delete-customer
    exceptions
      invalid-customerid
        ✓ missing querystring customerid
        ✓ invalid querystring customerid
      invalid-account
        ✓ ineligible accessing account (207ms)
    returns
      ✓ boolean (411ms)

  /api/user/subscriptions/delete-subscription
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid
      invalid-account
        ✓ ineligible accessing account (13869ms)
      invalid-subscription
        ✓ ineligible querystring subscription is not active (9279ms)
    returns
      ✓ boolean (7344ms)

  /api/user/subscriptions/invoice
    exceptions
      invalid-invoiceid
        ✓ missing querystring invoiceid
        ✓ invalid querystring invoiceid
      invalid-account
        ✓ ineligible accessing account (9858ms)
    returns
      ✓ object (7509ms)

  /api/user/subscriptions/invoices-count
    returns
      ✓ integer (17807ms)

  /api/user/subscriptions/invoices
    exceptions
      invalid-accountid
        ✓ missing querystring accountid
        ✓ invalid querystring accountid
      invalid-account
        ✓ ineligible accessing account (39ms)
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/user/subscriptions/payment-intent
    exceptions
      invalid-paymentintentid
        ✓ missing querystring invalid
        ✓ invalid querystring invalid
      invalid-account
        ✓ ineligible accessing account (1794ms)
    returns
      ✓ object (1753ms)

  /api/user/subscriptions/payment-intents-count
    returns
      ✓ integer (5411ms)

  /api/user/subscriptions/payment-intents
    exceptions
      invalid-accountid
        ✓ missing querystring accountid
        ✓ invalid querystring accountid
      invalid-account
        ✓ ineligible accessing account
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/user/subscriptions/payment-method
    exceptions
      invalid-paymentmethodid
        ✓ missing querystring paymentmethodid
        ✓ invalid querystring paymentmethodid
      invalid-account
        ✓ ineligible accessing account (1615ms)
    returns
      ✓ object (1442ms)

  /api/user/subscriptions/payment-methods-count
    returns
      ✓ integer (4278ms)

  /api/user/subscriptions/payment-methods
    exceptions
      invalid-accountid
        ✓ missing querystring accountid
        ✓ invalid querystring accountid
      invalid-account
        ✓ ineligible accessing account
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/user/subscriptions/published-plan
    exceptions
      invalid-planid
        ✓ missing querystring planid
        ✓ invalid querystring planid (311ms)
      invalid-plan
        ✓ ineligible querystring plan is not published (663ms)
    returns
      ✓ object (696ms)

  /api/user/subscriptions/published-plans-count
    returns
      ✓ integer (1126ms)

  /api/user/subscriptions/published-plans
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/user/subscriptions/published-product
    exceptions
      invalid-productid
        ✓ missing querystring productid
        ✓ invalid querystring productid (116ms)
      invalid-product
        ✓ ineligible querystring product is not published (334ms)
    returns
      ✓ object (329ms)

  /api/user/subscriptions/published-products-count
    returns
      ✓ integer (357ms)

  /api/user/subscriptions/published-products
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/user/subscriptions/refund
    exceptions
      invalid-refundid
        ✓ missing querystring refundid (542ms)
        ✓ invalid querystring refundid (944ms)
      invalid-account
        ✓ ineligible accessing account (8861ms)
    returns
      ✓ object (8969ms)

  /api/user/subscriptions/refunds-count
    returns
      ✓ integer (23482ms)

  /api/user/subscriptions/refunds
    exceptions
      invalid-accountid
        ✓ missing querystring accountid
        ✓ invalid querystring accountid
      invalid-account
        ✓ ineligible accessing account
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/user/subscriptions/reset-subscription-canceling
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid
      invalid-subscription
        ✓ invalid querystring subscription is active (6813ms)
      invalid-account
        ✓ ineligible accessing account (8671ms)
    returns
      ✓ object (8258ms)

  /api/user/subscriptions/set-customer-coupon
    exceptions
      invalid-customerid
        ✓ missing querystring customerid (216ms)
        ✓ invalid querystring customerid (191ms)
      invalid-customer
        ✓ invalid querystring customer has coupon (926ms)
      invalid-account
        ✓ ineligible account accessing (386ms)
      invalid-couponid
        ✓ missing posted couponid (202ms)
        ✓ invalid posted couponid (225ms)
      invalid-coupon
        ✓ invalid posted coupon is not published (519ms)
        ✓ invalid posted coupon is unpublished (700ms)
    returns
      ✓ object (950ms)

  /api/user/subscriptions/set-invoice-paid
    exceptions
      invalid-invoiceid
        ✓ missing querystring invoiceid
        ✓ invalid querystring invoiceid
      invalid-account
        ✓ ineligible accessing account (2097ms)
        ✓ ineligible posted payment method (6623ms)
      invalid-invoice
        ✓ invalid querystring invoice is paid (7419ms)
        ✓ invalid querystring invoice is marked uncollectable (5178ms)
      invalid-paymentmethodid
        ✓ missing posted paymentmethodid (2431ms)
        ✓ invalid posted paymentmethodid (2178ms)
    returns
      ✓ object (5312ms)

  /api/user/subscriptions/set-payment-intent-canceled
    exceptions
      invalid-paymentintentid
        ✓ missing querystring paymentintentid
        ✓ invalid querystring paymentintentid
      invalid-account
        ✓ ineligible accessing account (1662ms)
    returns
      ✓ object (1787ms)

  /api/user/subscriptions/set-payment-method-detached
    exceptions
      invalid-paymentmethodid
        ✓ missing querystring paymentmethodid
        ✓ invalid querystring paymentmethodid
      invalid-account
        ✓ ineligible accessing account (1379ms)
      invalid-paymentmethod
        ✓ invalid querystring payment method is default (1763ms)
    returns
      ✓ object (2907ms)

  /api/user/subscriptions/set-setup-intent-canceled
    exceptions
      invalid-setupintentid
        ✓ missing querystring setupintentid
        ✓ invalid querystring setupintentid
      invalid-account
        ✓ ineligible accessing account (2575ms)
    returns
      ✓ object (2865ms)

  /api/user/subscriptions/set-subscription-canceled
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid
      invalid-account
        ✓ ineligible accessing account (6833ms)
      invalid-subscription
        ✓ ineligible querystring subscription is not active (7783ms)
    returns
      ✓ object (7866ms)

  /api/user/subscriptions/set-subscription-coupon
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid
      invalid-subscription
        ✓ invalid querystring subscription has coupon (8124ms)
        ✓ invalid querystring subscription is canceling (8038ms)
      invalid-account
        ✓ ineligible accessing account (7453ms)
      invalid-couponid
        ✓ missing posted couponid (7523ms)
        ✓ invalid posted couponid (7386ms)
      invalid-coupon
        ✓ invalid posted coupon is not published (7474ms)
        ✓ invalid posted coupon is unpublished (7711ms)
        ✓ invalid posted coupon is other currency (7273ms)
    returns
      ✓ object (8000ms)

  /api/user/subscriptions/set-subscription-plan
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid
      invalid-account
        ✓ ineligible accessing account (14792ms)
      invalid-planid
        ✓ missing posted planid (6895ms)
        ✓ invalid posted planid (7175ms)
      invalid-plan
        ✓ invalid posted plan is not published (6802ms)
        ✓ invalid posted plan is unpublished (7414ms)
        ✓ invalid posted plan is unchanged (6103ms)
    invalid-paymentmethodid
      ✓ invalid customer requires payments method (6045ms)
    returns
      ✓ object (7774ms)

  /api/user/subscriptions/set-subscription-quantity
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid
      invalid-account
        ✓ ineligible accessing account (6796ms)
      invalid-quantity
        ✓ invalid posted quantity (8007ms)
        ✓ invalid posted quantity is unchanged (6187ms)
        ✓ invalid posted quantity is negative (8206ms)
        ✓ invalid posted quantity is zero (7231ms)
    returns
      ✓ object (7248ms)

  /api/user/subscriptions/set-subscription-tax-percent
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid
      invalid-account
        ✓ ineligible accessing account (6431ms)
      invalid-tax_percent
        ✓ invalid posted tax_percent (7691ms)
        ✓ invalid posted tax_percent is unchanged (6602ms)
        ✓ invalid posted tax_percent is negative (6649ms)
    returns
      ✓ object (7709ms)

  /api/user/subscriptions/setup-intent
    exceptions
      invalid-setupintentid
        ✓ missing querystring setupintentid
        ✓ invalid querystring setupintentid
      invalid-account
        ✓ ineligible accessing account (2950ms)
    returns
      ✓ object (2896ms)

  /api/user/subscriptions/setup-intents-count
    returns
      ✓ integer (4058ms)

  /api/user/subscriptions/setup-intents
    exceptions
      invalid-accountid
        ✓ missing querystring accountid
        ✓ invalid querystring accountid
      invalid-account
        ✓ ineligible accessing account
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    configuration
      ✓ environment PAGE_SIZE

  /api/user/subscriptions/subscription
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid
      invalid-account
        ✓ ineligible accessing account (12845ms)
    returns
      ✓ object (6744ms)

  /api/user/subscriptions/subscriptions-count
    exceptions
      invalid-accountid
        ✓ missing querystring accountid
        ✓ invalid querystring accountid
      invalid-account
        ✓ ineligible accessing account (42ms)
    returns
      ✓ integer (10831ms)

  /api/user/subscriptions/subscriptions
    exceptions
      invalid-accountid
        ✓ missing querystring accountid
        ✓ invalid querystring accountid
      invalid-account
        ✓ ineligible accessing account
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/user/subscriptions/upcoming-invoice
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid
      invalid-account
        ✓ ineligible accessing account (13802ms)
      invalid-subscription
        ✓ ineligible querystring subscription (13588ms)
    returns
      ✓ object (7394ms)

  /api/user/subscriptions/usage-record-summaries
    exceptions
      invalid-subscriptionitemid
        ✓ missing querystring subscriptionitemid
        ✓ invalid querystring subscriptionitemid
    receives
      ✓ optional querystring starting_after (string)
      ✓ optional querystring ending_before (string)
      ✓ optional querystring limit (integer)
    returns
      ✓ stripe list response
    configuration
      ✓ environment PAGE_SIZE


  966 passing (2h)

