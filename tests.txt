

  index
    STRIPE_JS
      Use client-side stripe.js in browser
        ✓ default unset
        ✓ Integer
    MAXIMUM_STRIPE_RETRIES
      Retry Stripe web requests
        ✓ default 0
        ✓ Integer
    SUBSCRIPTION_WEBHOOK_ENDPOINT_SECRET
      Secret provided by Stripe to sign webhooks
        ✓ String
    STRIPE_KEY
      The `sk_test_xxx` key from Stripe
        ✓ String
    STRIPE_PUBLISHABLE_KEY
      The `pk_test_xxx` key from Stripe
        ✓ String
    REQUIRE_SUBSCRIPTION
      Users must create subscription to access application
        ✓ default unset
        ✓ Boolean
    REQUIRE_PAYMENT
      Users must resolve unpaid invoices to access application
        ✓ default unset
        ✓ Boolean
    REQUIRE_PAYMENT_CONFIRMATION
      Users must resolve payment confirmations to access application
        ✓ default unset
        ✓ Boolean
    OVERDUE_INVOICE_THRESHOLD
      Duration in days to allow open invoices before enforcing payment
        ✓ default 1
        ✓ Integer
    START_SUBSCRIPTION_PATH
      Alternate URL path to your start subscription flow
        ✓ default /account/subscriptions/start-subscription
        ✓ String

  server/bind-stripekey
    after
      ✓ should bind data to req (59ms)

  server/require-payment-confirmation
    after
      ✓ should ignore guests
      ✓ should ignore user with pending confirmations requesting account pages (8349ms)
      ✓ should ignore administrators with pending confirmations requesting administration pages (6024ms)
      ✓ should ignore user without pending confirmation (6715ms)
      ✓ should require user confirm payment (6791ms)

  server/require-payment
    after
      ✓ should ignore guests
      ✓ should ignore user with amount owed requesting account pages (2286ms)
      ✓ should ignore administrator with amount owed requesting administration pages (2221ms)
      ✓ should ignore user without amount owed
      ✓ should ignore user with open but not overdue invoice (6292ms)
      ✓ should require user pay overdue invoice (5148ms)

  server/require-subscription
    after
      ✓ should ignore guests
      ✓ should ignore user without subscription requesting account pages
      ✓ should ignore administrator without subscription requesting administration pages
      ✓ should ignore user with active subscription (8501ms)
      ✓ should require user create subscription (54ms)

  /account/subscriptions/add-payment-method
    view
      ✓ should present the form for no stripe.js (1000ms)
      ✓ should present the form for stripe.js v3 (1830ms)
    submit
      ✓ should require name for no stripe.js (6127ms)
      ✓ should require CVC for no stripe.js (6213ms)
      ✓ should require card number for no stripe.js (5906ms)
      ✓ should require expiration month for no stripe.js (6188ms)
      ✓ should require expiration year for no stripe.js (6205ms)
      ✓ should add payment information no stripe.js (screenshots) (132361ms)
      ✓ should add payment information stripe.js v3 (21254ms)

  /account/subscriptions/billing-profile
    before
      ✓ should reject invalid customer (231ms)
      ✓ should reject other account's customer (264ms)
      ✓ should bind data to req (223ms)
    view
      ✓ should have row for customer (screenshots) (39164ms)

  /account/subscriptions/billing-profiles
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /account/subscriptions/cancel-subscription
    exceptions
      ✓ should reject missing subscription
      ✓ should reject invalid subscription
      ✓ should reject canceled subscription
      ✓ should reject other account's subscription
    before
      ✓ should bind data to req
    view
      ✓ should present the form
      ✓ should show fields for free plan cancelations
      ✓ should show fields for free trial cancelations
      ✓ should show fields for cancelation with credit or refund
    submit
      ✓ should cancel free subscription immediately (screenshots)
      ✓ should cancel free subscription at period end
      ✓ should cancel free trial immediately
      ✓ should cancel free trial at period end
      ✓ should cancel paid subscription and credit account
      ✓ should cancel paid subscription and show refund

  /account/subscriptions/change-plan
    before
      ✓ should bind data to req
    view
      ✓ should present the form
      ✓ should remove the form if there are no plans
    submit
      ✓ should apply plan update (screenshots)
    errors
      ✓ should reject paid plan without payment information

  /account/subscriptions/confirm-payment
    before
      ✓ should bind data to req (7282ms)
    view
      ✓ should display stripe.js confirmation

  /account/subscriptions/confirm-subscription
    exceptions
      ✓ invalid-planid (165ms)
      ✓ invalid-plan
    before
      ✓ should bind data to req
    view
      ✓ should present the form
    submit
      ✓ should start subscription (screenshots)
    errors
      ✓ invalid-paymentmethodid

  /account/subscriptions/create-billing-profile
    view
      ✓ should present the form for no stripe.js (668ms)
      ✓ should present the form for stripe.js v3 (1475ms)
    submit
      ✓ should require description for no stripe.js (6947ms)
      ✓ should require email for no stripe.js (6542ms)
      ✓ should require name for no stripe.js (6785ms)
      ✓ should require CVC for no stripe.js (7405ms)
      ✓ should require card number for no stripe.js (6420ms)
      ✓ should require expiration month for no stripe.js (6969ms)
      ✓ should require expiration year for no stripe.js (7075ms)
      ✓ should require description for stripe.js v3 (18684ms)
      ✓ should require email for stripe.js v3 (18422ms)
      ✓ should create billing profile for no stripe.js (8722ms)
      ✓ should create billing profile for stripe.js v3 (screenshots) (213697ms)

  /account/subscriptions/delete-billing-profile
    exceptions
      ✓ invalid-customerid
      ✓ invalid-account
    before
      ✓ should bind data to req
    view
      ✓ should present the form
    submit
      ✓ should delete billing profile (screenshots)

  /account/subscriptions
    before
      ✓ should bind data to req
    view
      ✓ should have row for each invoice
      ✓ should have row for each customer
      ✓ should have row for each subscription

  /account/subscriptions/invoice
    exceptions
      ✓ invalid-invoiceid
      ✓ invalid-account
    before
      ✓ should bind data to req
    view
      ✓ should have row for invoice (screenshots)

  /account/subscriptions/invoices
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /account/subscriptions/pay-invoice
    exceptions
      ✓ should reject invalid invoice
      ✓ invalid-account
      ✓ should reject paid invoice
    before
      ✓ should bind data to req
    view
      ✓ should present the form
    submit
      ✓ should pay invoice (screenshots)

  /account/subscriptions/plan
    before
      ✓ should reject invalid plan (178ms)
      ✓ should reject never published plan (682ms)
      ✓ should reject unpublished plan (953ms)
      ✓ should bind data to req (714ms)
    view
      ✓ should have row for plan (screenshots) (37932ms)

  /account/subscriptions/plans
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /account/subscriptions/refund-invoice
    exceptions
      ✓ invalid-invoiceid
      ✓ invalid-account
    before
      ✓ should bind data to req
    view
      ✓ should present the form
    submit
      ✓ should cancel subscription (screenshots)

  /account/subscriptions/refunds
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /account/subscriptions/request-refund
    exceptions
      ✓ invalid-invoice
      ✓ invalid-account
    before
      ✓ should bind data to req
    view
      ✓ should present the form
    submit
      ✓ should create refund request (screenshots)

  /account/subscriptions/subscription
    exceptions
      ✓ invalid-subscriptionid (1127ms)
      ✓ invalid-account
    before
      ✓ should bind data to req
    view
      ✓ should present the subscription table (screenshots)

  /account/subscriptions/subscriptions
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /administrator/subscriptions/apply-customer-coupon
    exceptions
      ✓ should reject invalid customer (152ms)
      ✓ should reject customer with coupon (1759ms)
    before
      ✓ should bind data to req (791ms)
    view
      ✓ should present the form (1480ms)
    submit
      ✓ should apply coupon (screenshots) (71642ms)

  /administrator/subscriptions/apply-subscription-coupon
    exceptions
      ✓ should reject invalid subscription (154ms)
      ✓ should reject canceling subscription (7996ms)
      ✓ should reject free subscription (5827ms)
      ✓ should reject subscription with coupon (8681ms)
    before
      ✓ should bind data to req (7533ms)
    view
      ✓ should present the form (8015ms)
    submit
      ✓ should apply coupon (screenshots) (78306ms)

  /administrator/subscriptions/charge
    before
      ✓ should reject invalid charge (868ms)
      ✓ should bind data to req (9756ms)
    view
      ✓ should present the charge table (screenshots) (53933ms)

  /administrator/subscriptions/charges
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /administrator/subscriptions/coupon
    before
      ✓ should reject invalid coupon (403ms)
      ✓ should bind data to req (489ms)
    view
      ✓ should present the coupon table (screenshots) (45921ms)

  /administrator/subscriptions/coupons
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /administrator/subscriptions/create-coupon
    view
      ✓ should present the form (588ms)
    submit
      ✓ should reject missing couponid (1337ms)
      ✓ should enforce couponid length (2257ms)
      ✓ should reject duplicate couponid (2150ms)
      ✓ should reject missing duration (1719ms)
      ✓ should enforce invalid duration (1794ms)
      ✓ should require valid amount off (1836ms)
      ✓ should require valid percent off (1730ms)
      ✓ should require valid max redemptions (1779ms)
      ✓ should require amount or percent off (1607ms)
      ✓ should require valid duration in months if repeating (1878ms)
      ✓ should require valid redeem_by if provided (2101ms)
      ✓ should create coupon (screenshots) (57926ms)

  /administrator/subscriptions/create-plan
    view
      ✓ should present the form (825ms)
    submit
      ✓ should reject missing planid (1727ms)
      ✓ should enforce planid length (2604ms)
      ✓ should reject missing productid (1711ms)
      ✓ should reject never published product (2132ms)
      ✓ should reject unpublished product (2228ms)
      ✓ should reject missing currency (2083ms)
      ✓ should reject invalid currency (2099ms)
      ✓ should reject missing usage_type (2034ms)
      ✓ should reject missing amount (2038ms)
      ✓ should reject invalid amount (2044ms)
      ✓ should reject missing interval (2094ms)
      ✓ should reject invalid interval (2081ms)
      ✓ should reject invalid interval_count (2055ms)
      ✓ should reject invalid trial_period_days (2200ms)
      ✓ should create plan (screenshots) (58293ms)

  /administrator/subscriptions/create-product
    view
      ✓ should present the form (481ms)
    submit
      ✓ should reject missing name (1319ms)
      ✓ should enforce name length (2218ms)
      ✓ should reject missing statement_descriptor (1215ms)
      ✓ should create product (screenshots) (57837ms)

  /administrator/subscriptions/customer
    before
      ✓ should reject invalid customer (365ms)
      ✓ should bind data to req (257ms)
    view
      ✓ should present the customer table (screenshots) (38342ms)

  /administrator/subscriptions/customers
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /administrator/subscriptions/delete-coupon
    exceptions
      ✓ should reject invalid couponid (154ms)
    before
      ✓ should bind data to req (323ms)
    view
      ✓ should present the form (813ms)
    submit
      ✓ should delete coupon (screenshots) (68440ms)

  /administrator/subscriptions/delete-plan
    exceptions
      ✓ should reject invalid planid (159ms)
    before
      ✓ should bind data to req (706ms)
    view
      ✓ should present the form (1194ms)
    submit
      ✓ should delete plan (screenshots) (69041ms)

  /administrator/subscriptions/delete-product
    exceptions
      ✓ should reject invalid productid (157ms)
    before
      ✓ should bind data to req (352ms)
    view
      ✓ should present the form (777ms)
    submit
      ✓ should delete product (screenshots) (65989ms)

  /administrator/subscriptions/delete-subscription
    exceptions
      ✓ should reject missing subscription
      ✓ should reject invalid subscription
      ✓ should reject canceled subscription
    before
      ✓ should bind data to req
    view
      ✓ should present the form
      ✓ should show fields for free plan cancelations
      ✓ should show fields for free trial cancelations
      ✓ should show fields for cancelation with credit or refund
    submit
      ✓ should cancel free subscription immediately (screenshots) (13054ms)
      ✓ should cancel free subscription at period end
      ✓ should cancel free trial immediately
      ✓ should cancel free trial at period end
      ✓ should cancel paid subscription and credit account
      ✓ should cancel paid subscription and show refund

  /administrator/subscriptions/deny-refund
    exceptions
      ✓ should reject invalid chargeid (155ms)
      ✓ should reject charge without refund request (8060ms)
      ✓ should reject denied refund (8592ms)
    before
      ✓ should bind data to req (9532ms)
    view
      ✓ should present the form (8939ms)
    submit
      ✓ should deny refund (screenshots) (86593ms)

  /administrator/subscriptions/edit-coupon
    before
      ✓ should reject invalid couponid
      ✓ should reject unpublished coupon (549ms)
      ✓ should bind data to req (321ms)
    view
      ✓ should present the form (798ms)
    submit
      ✓ should reject missing name (1611ms)
      ✓ should update coupon (screenshots) (69332ms)

  /administrator/subscriptions/edit-plan
    before
      ✓ should reject invalid planid (165ms)
      ✓ should reject unpublished plan (929ms)
      ✓ should bind data to req (809ms)
    view
      ✓ should present the form (1230ms)
    submit
      ✓ should reject missing productid (1973ms)
      ✓ should reject invalid trial period (2476ms)
      ✓ should update plan (screenshots) (71484ms)

  /administrator/subscriptions/edit-product
    before
      ✓ should reject invalid productid (146ms)
      ✓ should reject unpublished product (505ms)
      ✓ should bind data to req (308ms)
    view
      ✓ should present the form (767ms)
    submit
      ✓ should reject missing name (1557ms)
      ✓ should enforce name length (2445ms)
      ✓ should reject missing statement_descriptor (1468ms)
      ✓ should reject invalid unit_label (1853ms)
      ✓ should update product (screenshots) (74200ms)

  /administrator/subscriptions/flag-charge
    exceptions
      ✓ should reject invalid chargeid (153ms)
      ✓ should reject flagged charge
    before
      ✓ should bind data to req
    view
      ✓ should present the form
    submit
      ✓ should flag charge (screenshots)

  /administrator/subscriptions/forgive-invoice
    exceptions
      ✓ should reject invalid invoiceid (141ms)
      ✓ should reject paid invoice (7020ms)
      ✓ should reject uncollectible invoice (3335ms)
    before
      ✓ should bind data to req (2250ms)
    view
      ✓ should present the form (2875ms)
    submit
      ✓ should forgive invoice (screenshots) (65927ms)

  /administrator/subscriptions
    before
      ✓ should bind data to req (8722ms)
    view
      ✓ should have row for each plan (1845ms)
      ✓ should have row for each coupon (1144ms)
      ✓ should have row for each subscription (screenshots) (38277ms)

  /administrator/subscriptions/invoice
    before
      ✓ should reject invalid invoiceid (143ms)
      ✓ should bind data to req (7665ms)
    view
      ✓ should present the invoice table (screenshots) (53739ms)

  /administrator/subscriptions/invoices
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /administrator/subscriptions/payment-intent
    before
      ✓ should reject invalid paymentintentid
      ✓ should bind data to req (1853ms)
    view
      ✓ should have row for payment intent (screenshots) (45985ms)

  /administrator/subscriptions/payment-intents
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /administrator/subscriptions/payment-method
    before
      ✓ should reject invalid paymentmethodid
      ✓ should bind data to req (1569ms)
    view
      ✓ should have row for payment method (screenshots) (46536ms)

  /administrator/subscriptions/payment-methods
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /administrator/subscriptions/payout
    before
      ✓ should reject invalid payoutid (169ms)

  /administrator/subscriptions/plan
    before
      ✓ should reject invalid planid (158ms)
      ✓ should bind data to req (661ms)
    view
      ✓ should present the plan table (screenshots) (45119ms)

  /administrator/subscriptions/plans
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /administrator/subscriptions/product
    before
      ✓ should reject invalid productid (144ms)
      ✓ should bind data to req (322ms)
    view
      ✓ should have row for product (screenshots) (42946ms)

  /administrator/subscriptions/products
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /administrator/subscriptions/publish-coupon
    exceptions
      ✓ should reject invalid couponid (146ms)
      ✓ should reject published coupon (322ms)
    before
      ✓ should bind data to req (325ms)
    view
      ✓ should present the form (776ms)
    submit
      ✓ should publish coupon (screenshots) (68467ms)

  /administrator/subscriptions/publish-plan
    exceptions
      ✓ should reject invalid planid (153ms)
      ✓ should reject published plan (691ms)
    before
      ✓ should bind data to req (698ms)
    view
      ✓ should present the form (1228ms)
    submit
      ✓ should publish plan (screenshots) (68861ms)

  /administrator/subscriptions/publish-product
    exceptions
      ✓ should reject invalid productid (152ms)
      ✓ should reject published product (338ms)
    before
      ✓ should bind data to req (495ms)
    view
      ✓ should present the form (790ms)
    submit
      ✓ should publish product (screenshots) (65615ms)

  /administrator/subscriptions/refund-charge
    exceptions
      ✓ should reject invalid chargeid (156ms)
      ✓ should reject refunded charge
    before
      ✓ should bind data to req
    view
      ✓ should present the form
    submit
      ✓ should refund charge (screenshots)

  /administrator/subscriptions/refund-requests
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /administrator/subscriptions/refund
    before
      ✓ should reject invalid refundid (375ms)
      ✓ should bind data to req (9558ms)
    view
      ✓ should have row for refund (screenshots) (53758ms)

  /administrator/subscriptions/refunds
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /administrator/subscriptions/revoke-customer-coupon
    exceptions
      ✓ should reject invalid customer (154ms)
      ✓ should reject customer without discount (1063ms)
    before
      ✓ should bind data to req (1428ms)
    view
      ✓ should present the form (2010ms)
    submit
      ✓ should remove coupon (screenshots) (64209ms)

  /administrator/subscriptions/revoke-subscription-coupon
    exceptions
      ✓ should reject invalid subscription (158ms)
      ✓ should reject subscription without discount (8711ms)
    before
      ✓ should bind data to req (9870ms)
    view
      ✓ should present the form (9972ms)
    submit
      ✓ should remove coupon (screenshots) (78342ms)

  /administrator/subscriptions/setup-intent
    before
      ✓ should reject invalid setupintentid
      ✓ should bind data to req (8466ms)
    view
      ✓ should have row for setup intent (screenshots) (48191ms)

  /administrator/subscriptions/setup-intents
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /administrator/subscriptions/subscription
    before
      ✓ should reject invalid subscriptionid (155ms)
      ✓ should bind data to req (15187ms)
    view
      ✓ should present the subscription table (screenshots) (51175ms)

  /administrator/subscriptions/subscriptions
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /administrator/subscriptions/unpublish-coupon
    exceptions
      ✓ should reject invalid couponid (169ms)
      ✓ should reject never published coupon (343ms)
      ✓ should reject unpublished coupon (702ms)
    before
      ✓ should bind data to req (332ms)
    view
      ✓ should present the form (791ms)
    submit
      ✓ should unpublish coupon (screenshots) (68041ms)

  /administrator/subscriptions/unpublish-plan
    exceptions
      ✓ should reject invalid planid (159ms)
      ✓ should never published plan (675ms)
      ✓ should reject unpublished plan (928ms)
    before
      ✓ should bind data to req (632ms)
    view
      ✓ should present the form (1140ms)
    submit
      ✓ should unpublish plan (screenshots) (68291ms)

  /administrator/subscriptions/unpublish-product
    exceptions
      ✓ should reject invalid productid (207ms)
      ✓ should never published product (301ms)
      ✓ should reject unpublished product (526ms)
    before
      ✓ should bind data to req (310ms)
    view
      ✓ should present the form (804ms)
    submit
      ✓ should unpublish product (screenshots) (65722ms)

  /api/administrator/subscriptions/charge
    exceptions
      invalid-chargeid
        ✓ missing querystring chargeid
        ✓ invalid querystring chargeid (153ms)
    returns
      ✓ object (9932ms)

  /api/administrator/subscriptions/charges-count
    returns
      ✓ integer (29759ms)

  /api/administrator/subscriptions/charges
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/administrator/subscriptions/coupon
    exceptions
      invalid-couponid
        ✓ missing querystring couponid
        ✓ invalid querystring couponid (163ms)
    returns
      ✓ object (317ms)

  /api/administrator/subscriptions/coupons-count
    returns
      ✓ integer (544ms)

  /api/administrator/subscriptions/coupons
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/administrator/subscriptions/create-cancelation-refund
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid (152ms)
      invalid-subscription
        ✓ ineligible querystring subscription is not active (8584ms)
    returns
      ✓ object (8473ms)

  /api/administrator/subscriptions/create-coupon
    exceptions
      invalid-couponid
        ✓ missing posted couponid (71ms)
        ✓ invalid posted couponid is not alphanumeric_ (91ms)
      invalid-amount_off
        ✓ missing posted amount_off
        ✓ invalid posted amount_off
      invalid-currency
        ✓ missing posted currency
        ✓ invalid posted currency
      invalid-percent_off
        ✓ invalid posted percent_off
      invalid-duration
        ✓ invalid posted duration
      invalid-duration_in_months
        ✓ missing posted duration_in_months
        ✓ invalid posted duration_in_months
      invalid-redeem_by_meridiem
        ✓ invalid posted redeem_by_meridiem
      invalid-redeem_by
        ✓ invalid posted redeem_by
    receives
      ✓ required posted duration
      ✓ optionally-required posted amount_off (integer, or percent_off)
      ✓ optionally-required posted currency (string, if amount_off)
      ✓ optionally-required posted percent_off (integer, or amount_off)
      ✓ optionally-required posted expire date 
      ✓ optionally-required posted duration_in_months
    returns
      ✓ object (195ms)

  /api/administrator/subscriptions/create-plan
    exceptions
      invalid-planid
        ✓ invalid posted planid is not alphanumeric_ (325ms)
      invalid-planid-length
        ✓ posted planid is too short (219ms)
        ✓ posted planid is too long (206ms)
      invalid-productid
        ✓ missing posted productid (207ms)
        ✓ invalid posted productid (328ms)
      invalid-product
        ✓ ineligible posted product is not published (314ms)
      invalid-amount
        ✓ missing posted amount (312ms)
        ✓ invalid posted amount (352ms)
      invalid-currency
        ✓ missing posted currency (180ms)
        ✓ invalid posted currency (201ms)
      invalid-interval
        ✓ missing posted interval (301ms)
        ✓ invalid posted interval (331ms)
      invalid-interval-count
        ✓ missing posted interval_count (335ms)
        ✓ invalid posted interval_count (324ms)
      invalid-trial_period
        ✓ invalid posted trial_period (320ms)
      invalid-usage_type
        ✓ invalid posted usage_type (340ms)
    receives
      ✓ optional posted published (boolean) (521ms)
      ✓ optional posted trial_period_days (integer) (774ms)
      ✓ optional posted usage_type (licensed|metered) (634ms)
    returns
      ✓ object (553ms)
    configuration
      ✓ environment MINIMUM_PLANID_LENGTH (176ms)
      ✓ environment MAXIMUM_PLANID_LENGTH (224ms)

  /api/administrator/subscriptions/create-product
    exceptions
      invalid-name
        ✓ missing posted name
      invalid-product-name-length
        ✓ posted name too short
        ✓ posted name too long
      invalid-statement_descriptor
        ✓ missing posted statement_descriptor
    receives
      ✓ optional posted published (boolean) (376ms)
    returns
      ✓ object (375ms)
    configuration
      ✓ environment MINIMUM_PRODUCT_NAME_LENGTH
      ✓ environment MAXIMUM_PRODUCT_NAME_LENGTH

  /api/administrator/subscriptions/create-refund
    exceptions
      invalid-chargeid
        ✓ missing querystring chargeid
        ✓ invalid querystring chargeid (147ms)
      invalid-amount
        ✓ missing posted amount
        ✓ invalid posted amount
        ✓ invalid posted amount is negative
        ✓ invalid posted amount exceeds charge
    returns
      ✓ object

  /api/administrator/subscriptions/customer
    exceptions
      invalid-customerid
        ✓ missing querystring customerid
        ✓ invalid querystring customerid (154ms)
    returns
      ✓ object (3043ms)

  /api/administrator/subscriptions/customers-count
    returns
      ✓ integer (474ms)

  /api/administrator/subscriptions/customers
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/administrator/subscriptions/delete-coupon
    exceptions
      invalid-couponid
        ✓ missing querystring couponid
        ✓ invalid querystring couponid (142ms)
    returns
      ✓ boolean (547ms)

  /api/administrator/subscriptions/delete-plan
    exceptions
      invalid-planid
        ✓ missing querystring planid
        ✓ invalid querystring planid (157ms)
    returns
      ✓ boolean (915ms)

  /api/administrator/subscriptions/delete-product
    exceptions
      invalid-productid
        ✓ missing querystring productid
        ✓ invalid querystring productid (143ms)
    returns
      ✓ boolean (498ms)

  /api/administrator/subscriptions/delete-subscription
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid (166ms)
      invalid-subscription
        ✓ ineligible querystring subscription is not active (8845ms)
    returns
      ✓ boolean (7293ms)

  /api/administrator/subscriptions/invoice
    exceptions
      invalid-invoiceid
        ✓ missing querystring invoiceid
        ✓ invalid querystring invoiceid (142ms)
    returns
      ✓ object (7074ms)

  /api/administrator/subscriptions/invoices-count
    returns
      ✓ integer (30018ms)

  /api/administrator/subscriptions/invoices
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/administrator/subscriptions/payment-intent
    exceptions
      invalid-paymentintentid
        ✓ missing querystring paymentintentid
        ✓ invalid querystring paymentintentid
    returns
      ✓ object (1674ms)

  /api/administrator/subscriptions/payment-intents-count
    returns
      ✓ integer (5227ms)

  /api/administrator/subscriptions/payment-intents
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/administrator/subscriptions/payment-method
    exceptions
      invalid-paymentmethodid
        ✓ missing querystring paymentmethodid
        ✓ invalid querystring paymentmethodid
    returns
      ✓ object (1584ms)

  /api/administrator/subscriptions/payment-methods-count
    returns
      ✓ integer (4236ms)

  /api/administrator/subscriptions/payment-methods
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/administrator/subscriptions/plan
    exceptions
      invalid-planid
        ✓ missing querystring planid
        ✓ invalid querystring planid (149ms)
    returns
      ✓ object (705ms)

  /api/administrator/subscriptions/plans-count
    returns
      ✓ integer (1291ms)

  /api/administrator/subscriptions/plans
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/administrator/subscriptions/product
    exceptions
      invalid-productid
        ✓ missing querystring productid
        ✓ invalid querystring productid (159ms)
    returns
      ✓ object (309ms)

  /api/administrator/subscriptions/products-count
    returns
      ✓ integer (545ms)

  /api/administrator/subscriptions/products
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/administrator/subscriptions/refund-requests-count
    returns
      ✓ integer (22714ms)

  /api/administrator/subscriptions/refund-requests
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/administrator/subscriptions/refund
    exceptions
      ✓ invalid querystring refundid
      ✓ missing querystring refundid (163ms)
    returns
      ✓ object (8654ms)

  /api/administrator/subscriptions/refunds-count
    returns
      ✓ integer (29427ms)

  /api/administrator/subscriptions/refunds
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/administrator/subscriptions/reset-customer-coupon
    exceptions
      invalid-customerid
        ✓ missing querystring customerid
        ✓ invalid querystring customerid (205ms)
      invalid-customeir
        ✓ invalid querystring customer has no discount (242ms)
    receives
      ✓ object (1175ms)

  /api/administrator/subscriptions/reset-subscription-coupon
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid (166ms)
      invalid-subscription
        ✓ ineligible querystring subscription has no discount (6927ms)
    returns
      ✓ object (8428ms)

  /api/administrator/subscriptions/set-charge-flagged
    exceptions
      invalid-chargeid
        ✓ missing querystring charge
        ✓ invalid querystring charge (158ms)
      invalid-charge
        ✓ ineligible querystring charge is already flagged (7047ms)
    returns
      ✓ object (6996ms)

  /api/administrator/subscriptions/set-coupon-published
    exceptions
      invalid-couponid
        ✓ missing querystring couponid
        ✓ invalid querystring couponid (143ms)
      invalid-coupon
        ✓ ineligible querystring coupon is published (340ms)
        ✓ ineligible querystring coupon is unpublished (316ms)
    returns
      ✓ object (514ms)

  /api/administrator/subscriptions/set-coupon-unpublished
    exceptions
      invalid-couponid
        ✓ missing querystring couponid
        ✓ invalid querystring couponid (144ms)
      invalid-coupon
        ✓ ineligible querystring coupon is not published (336ms)
        ✓ ineligible querystring coupon is already unpublished (543ms)
    returns
      ✓ object (520ms)

  /api/administrator/subscriptions/set-invoice-uncollectible
    exceptions
      invalid-invoiceid
        ✓ missing querystring invoiceid (137ms)
        ✓ invalid querystring invoiceid (146ms)
      invalid-invoice
        ✓ invalid querystring invoice is paid (7980ms)
        ✓ invalid querystring invoice is marked uncollectable (5230ms)
    returns
      ✓ object (4375ms)

  /api/administrator/subscriptions/set-plan-published
    exceptions
      invalid-planid
        ✓ missing querystring planid
        ✓ invalid querystring planid (160ms)
      invalid-plan
        ✓ ineligible querystring plan is published (651ms)
    returns
      ✓ object (890ms)

  /api/administrator/subscriptions/set-plan-unpublished
    exceptions
      invalid-planid
        ✓ missing querystring planid
        ✓ invalid querystring planid (175ms)
      invalid-plan
        ✓ ineligible querystring plan is not published (632ms)
        ✓ ineligible querystring plan is already unpublished (897ms)
    returns
      ✓ object (914ms)

  /api/administrator/subscriptions/set-product-published
    exceptions
      invalid-productid
        ✓ missing querystring productid (555ms)
        ✓ invalid querystring productid (308ms)
      invalid-product
        ✓ invalid querystring product is already published (495ms)
    returns
      ✓ object (670ms)

  /api/administrator/subscriptions/set-product-unpublished
    exceptions
      invalid-productid
        ✓ missing querystring productid (207ms)
        ✓ invalid querystring productid (323ms)
      invalid-product
        ✓ ineligible querystring product is not published (471ms)
        ✓ ineligible querystring product is already unpublished (552ms)
    returns
      ✓ object (518ms)

  /api/administrator/subscriptions/set-refund-request-denied
    exceptions
      invalid-chargeid
        ✓ missing querystring chargeid
        ✓ invalid querystring chargeid (163ms)
      invalid-charge
        ✓ ineligible querystring charge has no refund request (7478ms)
        ✓ ineligible querystring charge has denied request already (8013ms)
    returns
      ✓ object (7648ms)

  /api/administrator/subscriptions/set-subscription-canceled
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid (143ms)
      invalid-subscription
        ✓ ineligible querystring subscription is not active (10799ms)
    returns
      ✓ object (9207ms)

  /api/administrator/subscriptions/set-subscription-coupon
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid
      invalid-subscription
        ✓ ineligible subscription is canceling (8275ms)
        ✓ ineligible subscription has coupon (8077ms)
      invalid-couponid
        ✓ missing posted couponid (7609ms)
        ✓ invalid posted couponid (6918ms)
      invalid-coupon
        ✓ ineligible posted coupon is not published (6873ms)
        ✓ ineligible posted coupon is unpublished (7555ms)
    returns
      ✓ object (8822ms)

  /api/administrator/subscriptions/setup-intent
    exceptions
      invalid-setupintentid
        ✓ missing querystring setupintentid
        ✓ invalid querystring setupintentid
    returns
      ✓ object (2636ms)

  /api/administrator/subscriptions/setup-intents-count
    returns
      ✓ integer (3872ms)

  /api/administrator/subscriptions/setup-intents
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/administrator/subscriptions/subscription
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid (162ms)
    returns
      ✓ object (7449ms)

  /api/administrator/subscriptions/subscriptions-count
    returns
      ✓ integer (23596ms)

  /api/administrator/subscriptions/subscriptions
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/administrator/subscriptions/update-coupon
    exceptions
      invalid-couponid
        ✓ missing querystring couponid
        ✓ invalid querystring couponid (149ms)
      invalid-coupon
        ✓ ineligible querystring coupon is unpublished (526ms)
      invalid-name
        ✓ missing posted name (342ms)
        ✓ invalid posted name (320ms)
    receives
      ✓ required posted name (502ms)
    returns
      ✓ object (556ms)

  /api/administrator/subscriptions/update-plan
    exceptions
      invalid-planid
        ✓ missing querystring planid
        ✓ invalid querystring planid (153ms)
      invalid-plan
        ✓ ineligible querystring plan is unpublished (1242ms)
      invalid-productid
        ✓ invalid posted productid (831ms)
      invalid-product
        ✓ ineligible posted product is not published (953ms)
        ✓ ineligible posted product is unpublished (1127ms)
      invalid-trial_period_days
        ✓ invalid posted trial_period_days (981ms)
        ✓ ineligible posted trial_period_days is negative (1146ms)
        ✓ ineligible posted trial_period_days greater than 365 (962ms)
    receives
      ✓ optional posted trial_period_days (integer) (898ms)
    returns
      ✓ object (1165ms)

  /api/administrator/subscriptions/update-product
    exceptions
      invalid-productid
        ✓ missing querystring productid (202ms)
        ✓ invalid querystring productid (316ms)
      invalid-product
        ✓ ineligible querystring product is unpublished (590ms)
      invalid-name
        ✓ invalid posted name (311ms)
      invalid-name-length
        ✓ posted name too short (305ms)
        ✓ posted name too long (328ms)
      invalid-statement_descriptor
        ✓ invalid posted statement_descriptor (324ms)
      invalid-statement_descriptor-length
        ✓ posted statement_descriptor too short (328ms)
        ✓ posted statement_descriptor too long (316ms)
      invalid-unit_label
        ✓ missing posted unit_label (324ms)
    receives
      ✓ optional posted name (499ms)
      ✓ optional posted statement_descriptor (658ms)
      ✓ optional posted unit_label (475ms)
    returns
      ✓ object (685ms)
    configuration
      ✓ environment MINIMUM_PRODUCT_NAME_LENGTH (304ms)
      ✓ environment MAXIMUM_PRODUCT_NAME_LENGTH (342ms)

  /api/administrator/subscriptions/usage-record-summaries
    exceptions
      invalid-subscriptionitemid
        ✓ missing querystring subscriptionitemid
        ✓ invalid querystring subscriptionitemid
    receives
      ✓ optional querystring starting_after (string)
      ✓ optional querystring ending_before (string)
      ✓ optional querystring limit (integer)
    returns
      ✓ stripe list response
    configuration
      ✓ environment PAGE_SIZE

  /api/user/subscriptions/charge
    exceptions
      invalid-chargeid
        ✓ missing querystring chargeid
        ✓ invalid querystring chargeid
      invalid-account
        ✓ ineligible accessing account (13891ms)
    returns
      ✓ object (8387ms)

  /api/user/subscriptions/charges-count
    returns
      ✓ integer (18739ms)

  /api/user/subscriptions/charges
    exceptions
      invalid-accountid
        ✓ missing querystring accountid
        ✓ invalid querystring accountid
      invalid-account
        ✓ ineligible accessing account (40ms)
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/user/subscriptions/create-cancelation-refund
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid
      invalid-account
        ✓ ineligible accessing account (7075ms)
      invalid-subscription
        ✓ ineligible querystring subscription is not active (8002ms)
        ✓ ineligible querystring subscription is free (6588ms)
        ✓ ineligible querystring subscription is in free trial (6164ms)
    returns
      ✓ object (10008ms)

  /api/user/subscriptions/create-customer
    exceptions
      invalid-accountid
        ✓ missing querystring accountid
        ✓ invalid querystring accountid
      invalid-account
        ✓ ineligible accessing account (42ms)
    returns
      ✓ object (231ms)

  /api/user/subscriptions/create-payment-intent
    exceptions
      invalid-customerid
        ✓ missing querystring customerid
        ✓ invalid querystring customerid
      invalid-account
        ✓ ineligible accessing account (1504ms)
        ✓ ineligible posted payment method (1682ms)
      invalid-paymentmethodid
        ✓ missing posted paymentmethodid (225ms)
        ✓ invalid posted paymentmethodid (253ms)
    object
      ✓ object (1656ms)

  /api/user/subscriptions/create-payment-method
    exceptions
      invalid-customerid
        ✓ missing querystring customerid
        ✓ invalid querystring customerid
      invalid-account
        ✓ ineligible accessing account (249ms)
    receives
      ✓ optionally-required posted name (236ms)
      ✓ optionally-required posted cvc (380ms)
      ✓ optionally-required posted number (217ms)
      ✓ optionally-required posted exp_month (240ms)
      ✓ optionally-required posted exp_year (213ms)
      ✓ optionally-required posted token (229ms)
    returns
      ✓ object (1615ms)
    configuration
      ✓ environment STRIPE_JS (262ms)

  /api/user/subscriptions/create-refund-request
    exceptions
      invalid-chargeid
        ✓ missing querystring chargeid
        ✓ invalid querystring chargeid
      invalid-charge
        ✓ ineligible querystring charge is refunded (13596ms)
        ✓ ineligible querystring charge has refund request (10405ms)
      invalid-account
        ✓ ineligible accessing account (7101ms)
    returns
      ✓ object (8130ms)

  /api/user/subscriptions/create-refund
    exceptions
      invalid-chargeid
        ✓ missing querystring chargeid
        ✓ invalid querystring chargeid
      invalid-charge
        ✓ ineligible querystring charge is refunded (10772ms)
        ✓ ineligible querystring charge is out of refund period (7772ms)
      invalid-account
        ✓ ineligible accessing account (8934ms)
    returns
      ✓ object (8715ms)
    configuration
      ✓ environment SUBSCRIPTION_REFUND_PERIOD (8701ms)

  /api/user/subscriptions/create-setup-intent
    exceptions
      invalid-customerid
        ✓ missing querystring customerid
        ✓ invalid querystring customerid
      invalid-account
        ✓ ineligible accessing account (1711ms)
      invalid-paymentmethodid
        ✓ missing posted paymentmethodid (210ms)
        ✓ invalid posted paymentmethodid (224ms)
    returns
      ✓ object (1611ms)

  /api/user/subscriptions/create-subscription
    exceptions
      invalid-customerid
        ✓ missing querystring customerid (663ms)
        ✓ invalid querystring customerid (651ms)
      invalid-customer
        ✓ ineligible querystring customer requires payment method (861ms)
      invalid-account
        ✓ ineligible accessing account (936ms)
      invalid-planid
        ✓ missing posted planid (1644ms)
        ✓ invalid posted planid (1682ms)
      invalid-plan
        ✓ ineligible posted plan is not published (2128ms)
        ✓ ineligible posted plan is unpublished (2498ms)
    returns
      ✓ object (3881ms)

  /api/user/subscriptions/create-usage-record
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid
      invalid-subscription
        ✓ invalid querystring subscription is not "metered" (17729ms)
      invalid-account
        ✓ ineligible accessing account (6350ms)
      invalid-quantity
        ✓ invalid posted quantity is not integer (5529ms)
        ✓ invalid posted quantity is negative (5589ms)
      invalid-action
        ✓ missing posted action (5668ms)
        ✓ invalid posted action (5910ms)
      invalid-subscriptionitemid
        ✓ missing posted subscriptionitemid (7501ms)
        ✓ invalid posted subscriptionitemid (6281ms)
    receives
      ✓ required posted quantity (5909ms)
      ✓ required posted action (5320ms)
      ✓ required posted subscriptionitemid (6182ms)
    returns
      ✓ object (6476ms)

  /api/user/subscriptions/customer
    exceptions
      invalid-customerid
        ✓ missing querystring customerid
        ✓ invalid querystring customerid
      invalid-account
        ✓ ineligible accessing account (1454ms)
    returns
      ✓ object (1604ms)

  /api/user/subscriptions/customers
    exceptions
      invalid-accountid
        ✓ missing querystring accountid
        ✓ invalid querystring accountid
      invalid-account
        ✓ ineligible accessing account (43ms)
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/user/subscriptions/delete-customer
    exceptions
      invalid-customerid
        ✓ missing querystring customerid
        ✓ invalid querystring customerid
      invalid-account
        ✓ ineligible accessing account (235ms)
    returns
      ✓ boolean (413ms)

  /api/user/subscriptions/delete-subscription
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid
      invalid-account
        ✓ ineligible accessing account (10226ms)
      invalid-subscription
        ✓ ineligible querystring subscription is not active (8625ms)
    returns
      ✓ boolean (8938ms)

  /api/user/subscriptions/invoice
    exceptions
      invalid-invoiceid
        ✓ missing querystring invoiceid
        ✓ invalid querystring invoiceid
      invalid-account
        ✓ ineligible accessing account (10162ms)
    returns
      ✓ object (7773ms)

  /api/user/subscriptions/invoices-count
    returns
      ✓ integer (19431ms)

  /api/user/subscriptions/invoices
    exceptions
      invalid-accountid
        ✓ missing querystring accountid
        ✓ invalid querystring accountid
      invalid-account
        ✓ ineligible accessing account (47ms)
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/user/subscriptions/payment-intent
    exceptions
      invalid-paymentintentid
        ✓ missing querystring invalid
        ✓ invalid querystring invalid
      invalid-account
        ✓ ineligible accessing account (1673ms)
    returns
      ✓ object (1918ms)

  /api/user/subscriptions/payment-intents-count
    returns
      ✓ integer (5358ms)

  /api/user/subscriptions/payment-intents
    exceptions
      invalid-accountid
        ✓ missing querystring accountid
        ✓ invalid querystring accountid
      invalid-account
        ✓ ineligible accessing account (42ms)
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/user/subscriptions/payment-method
    exceptions
      invalid-paymentmethodid
        ✓ missing querystring paymentmethodid
        ✓ invalid querystring paymentmethodid
      invalid-account
        ✓ ineligible accessing account (1686ms)
    returns
      ✓ object (1440ms)

  /api/user/subscriptions/payment-methods-count
    returns
      ✓ integer (3889ms)

  /api/user/subscriptions/payment-methods
    exceptions
      invalid-accountid
        ✓ missing querystring accountid
        ✓ invalid querystring accountid
      invalid-account
        ✓ ineligible accessing account (45ms)
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/user/subscriptions/published-plan
    exceptions
      invalid-planid
        ✓ missing querystring planid
        ✓ invalid querystring planid (136ms)
      invalid-plan
        ✓ ineligible querystring plan is not published (738ms)
    returns
      ✓ object (1033ms)

  /api/user/subscriptions/published-plans-count
    returns
      ✓ integer (1146ms)

  /api/user/subscriptions/published-plans
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/user/subscriptions/published-product
    exceptions
      invalid-productid
        ✓ missing querystring productid
        ✓ invalid querystring productid (125ms)
      invalid-product
        ✓ ineligible querystring product is not published (498ms)
    returns
      ✓ object (359ms)

  /api/user/subscriptions/published-products-count
    returns
      ✓ integer (446ms)

  /api/user/subscriptions/published-products
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/user/subscriptions/refund
    exceptions
      invalid-refundid
        ✓ missing querystring refundid (643ms)
        ✓ invalid querystring refundid (752ms)
      invalid-account
        ✓ ineligible accessing account (9122ms)
    returns
      ✓ object (8955ms)

  /api/user/subscriptions/refunds-count
    returns
      ✓ integer (23888ms)

  /api/user/subscriptions/refunds
    exceptions
      invalid-accountid
        ✓ missing querystring accountid
        ✓ invalid querystring accountid
      invalid-account
        ✓ ineligible accessing account (39ms)
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/user/subscriptions/reset-subscription-canceling
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid
      invalid-subscription
        ✓ invalid querystring subscription is active (8306ms)
      invalid-account
        ✓ ineligible accessing account (7455ms)
    returns
      ✓ object (11807ms)

  /api/user/subscriptions/set-customer-coupon
    exceptions
      invalid-customerid
        ✓ missing querystring customerid (235ms)
        ✓ invalid querystring customerid (248ms)
      invalid-customer
        ✓ invalid querystring customer has coupon (1030ms)
      invalid-account
        ✓ ineligible account accessing (463ms)
      invalid-couponid
        ✓ missing posted couponid (218ms)
        ✓ invalid posted couponid (218ms)
      invalid-coupon
        ✓ invalid posted coupon is not published (556ms)
        ✓ invalid posted coupon is unpublished (920ms)
    returns
      ✓ object (817ms)

  /api/user/subscriptions/set-invoice-paid
    exceptions
      invalid-invoiceid
        ✓ missing querystring invoiceid
        ✓ invalid querystring invoiceid
      invalid-account
        ✓ ineligible accessing account (2434ms)
        ✓ ineligible posted payment method (7450ms)
      invalid-invoice
        ✓ invalid querystring invoice is paid (7177ms)
        ✓ invalid querystring invoice is marked uncollectable (6973ms)
      invalid-paymentmethodid
        ✓ missing posted paymentmethodid (2976ms)
        ✓ invalid posted paymentmethodid (2488ms)
    returns
      ✓ object (6471ms)

  /api/user/subscriptions/set-payment-intent-canceled
    exceptions
      invalid-paymentintentid
        ✓ missing querystring paymentintentid
        ✓ invalid querystring paymentintentid
      invalid-account
        ✓ ineligible accessing account (1930ms)
    returns
      ✓ object (2137ms)

  /api/user/subscriptions/set-payment-method-detached
    exceptions
      invalid-paymentmethodid
        ✓ missing querystring paymentmethodid
        ✓ invalid querystring paymentmethodid
      invalid-account
        ✓ ineligible accessing account (1749ms)
      invalid-paymentmethod
        ✓ invalid querystring payment method is default (1646ms)
    returns
      ✓ object (3132ms)

  /api/user/subscriptions/set-setup-intent-canceled
    exceptions
      invalid-setupintentid
        ✓ missing querystring setupintentid
        ✓ invalid querystring setupintentid
      invalid-account
        ✓ ineligible accessing account (6055ms)
    returns
      ✓ object (5532ms)

  /api/user/subscriptions/set-subscription-canceled
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid
      invalid-account
        ✓ ineligible accessing account (8066ms)
      invalid-subscription
        ✓ ineligible querystring subscription is not active (8246ms)
    returns
      ✓ object (8737ms)

  /api/user/subscriptions/set-subscription-coupon
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid
      invalid-subscription
        ✓ invalid querystring subscription has coupon (10037ms)
        ✓ invalid querystring subscription is canceling (9122ms)
      invalid-account
        ✓ ineligible accessing account (7609ms)
      invalid-couponid
        ✓ missing posted couponid (9613ms)
        ✓ invalid posted couponid (9705ms)
      invalid-coupon
        ✓ invalid posted coupon is not published (8032ms)
        ✓ invalid posted coupon is unpublished (8107ms)
        ✓ invalid posted coupon is other currency (8952ms)
    returns
      ✓ object (9608ms)

  /api/user/subscriptions/set-subscription-plan
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid
      invalid-account
        ✓ ineligible accessing account (14700ms)
      invalid-planid
        ✓ missing posted planid (7293ms)
        ✓ invalid posted planid (8131ms)
      invalid-plan
        ✓ invalid posted plan is not published (9445ms)
        ✓ invalid posted plan is unpublished (8442ms)
        ✓ invalid posted plan is unchanged (7940ms)
    invalid-paymentmethodid
      ✓ invalid customer requires payments method (7227ms)
    returns
      ✓ object (9516ms)

  /api/user/subscriptions/set-subscription-quantity
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid
      invalid-account
        ✓ ineligible accessing account (7437ms)
      invalid-quantity
        ✓ invalid posted quantity (8383ms)
        ✓ invalid posted quantity is unchanged (10189ms)
        ✓ invalid posted quantity is negative (8188ms)
        ✓ invalid posted quantity is zero (7903ms)
    returns
      ✓ object (8293ms)

  /api/user/subscriptions/set-subscription-tax-percent
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid
      invalid-account
        ✓ ineligible accessing account (8491ms)
      invalid-tax_percent
        ✓ invalid posted tax_percent (7856ms)
        ✓ invalid posted tax_percent is unchanged (9341ms)
        ✓ invalid posted tax_percent is negative (6958ms)
    returns
      ✓ object (9500ms)

  /api/user/subscriptions/setup-intent
    exceptions
      invalid-setupintentid
        ✓ missing querystring setupintentid
        ✓ invalid querystring setupintentid
      invalid-account
        ✓ ineligible accessing account (3927ms)
    returns
      ✓ object (3208ms)

  /api/user/subscriptions/setup-intents-count
    returns
      ✓ integer (4181ms)

  /api/user/subscriptions/setup-intents
    exceptions
      invalid-accountid
        ✓ missing querystring accountid
        ✓ invalid querystring accountid
      invalid-account
        ✓ ineligible accessing account (42ms)
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    configuration
      ✓ environment PAGE_SIZE

  /api/user/subscriptions/subscription
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid
      invalid-account
        ✓ ineligible accessing account (14335ms)
    returns
      ✓ object (8114ms)

  /api/user/subscriptions/subscriptions-count
    exceptions
      invalid-accountid
        ✓ missing querystring accountid
        ✓ invalid querystring accountid
      invalid-account
        ✓ ineligible accessing account (43ms)
    returns
      ✓ integer (13576ms)

  /api/user/subscriptions/subscriptions
    exceptions
      invalid-accountid
        ✓ missing querystring accountid
        ✓ invalid querystring accountid
      invalid-account
        ✓ ineligible accessing account (42ms)
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/user/subscriptions/upcoming-invoice
    exceptions
      invalid-subscriptionid
        ✓ missing querystring subscriptionid
        ✓ invalid querystring subscriptionid
      invalid-account
        ✓ ineligible accessing account (14766ms)
      invalid-subscription
        ✓ ineligible querystring subscription (18347ms)
    returns
      ✓ object (7687ms)

  /api/user/subscriptions/usage-record-summaries
    exceptions
      invalid-subscriptionitemid
        ✓ missing querystring subscriptionitemid
        ✓ invalid querystring subscriptionitemid
    receives
      ✓ optional querystring starting_after (string)
      ✓ optional querystring ending_before (string)
      ✓ optional querystring limit (integer)
    returns
      ✓ stripe list response
    configuration
      ✓ environment PAGE_SIZE


  966 passing (2h)

